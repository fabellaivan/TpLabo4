"use strict";(self.webpackChunkappUTN=self.webpackChunkappUTN||[]).push([[879],{3879:(Do,oi,w)=>{w.d(oi,{I:()=>Nc});var P=w(5861),I=w(5879),p=w(8645),B=w(2096),an=w(5592),li=w(2459),Tt=w(3019),ae=w(3093),pe=w(4664),ge=w(7398),Rt=w(4552);class ai extends p.x{constructor(e=1/0,t=1/0,i=Rt.l){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=i,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:i,_infiniteTimeWindow:s,_timestampProvider:r,_windowTime:o}=this;t||(i.push(e),!s&&i.push(r.now()+o)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:i,_buffer:s}=this,r=s.slice();for(let o=0;o<r.length&&!e.closed;o+=i?1:2)e.next(r[o]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:i,_infiniteTimeWindow:s}=this,r=(s?1:2)*e;if(e<1/0&&r<i.length&&i.splice(0,i.length-r),!s){const o=t.now();let l=0;for(let a=1;a<i.length&&i[a]<=o;a+=2)l=a;l&&i.splice(0,l+1)}}}var ut=w(3020);function un(n,e,t){let i,s=!1;return n&&"object"==typeof n?({bufferSize:i=1/0,windowTime:e=1/0,refCount:s=!1,scheduler:t}=n):i=n??1/0,(0,ut.B)({connector:()=>new ai(i,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:s})}var ui=w(1374),bt=w(4674);function cn(n,e){return(0,bt.m)(e)?(0,pe.w)(()=>n,e):(0,pe.w)(()=>n)}var Nt=w(5137),At=w(2181),me=w(2793),ue=w(6304),ci=w(6814),hn=w(2194);w(120);const ct=new I.OlP("angularfire2.auth.use-emulator"),fn=new I.OlP("angularfire2.auth.settings"),_n=new I.OlP("angularfire2.auth.tenant-id"),ht=new I.OlP("angularfire2.auth.langugage-code"),dt=new I.OlP("angularfire2.auth.use-device-language"),pn=new I.OlP("angularfire.auth.persistence"),gn=(n,e,t,i,s,r,o,l)=>(0,ue.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const a=e.runOutsideAngular(()=>n.auth());if(t&&a.useEmulator(...t),i&&(a.tenantId=i),a.languageCode=s,r&&a.useDeviceLanguage(),o)for(const[c,f]of Object.entries(o))a.settings[c]=f;return l&&a.setPersistence(l),a},[t,i,s,r,o,l]);let De=(()=>{class n{constructor(t,i,s,r,o,l,a,c,f,g,m,C){const E=new p.x,N=(0,B.of)(void 0).pipe((0,ae.Q)(o.outsideAngular),(0,pe.w)(()=>r.runOutsideAngular(()=>Promise.resolve().then(w.bind(w,8661)))),(0,ge.U)(()=>(0,ue.on)(t,r,i)),(0,ge.U)(G=>gn(G,r,l,c,f,g,a,m)),un({bufferSize:1,refCount:!1}));if((0,ci.PM)(s))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,B.of)(null);else{N.pipe((0,ui.P)()).subscribe();const ee=N.pipe((0,pe.w)(j=>j.getRedirectResult().then(xe=>xe,()=>null)),me.iC,un({bufferSize:1,refCount:!1})),le=N.pipe((0,pe.w)(j=>new an.y(xe=>({unsubscribe:r.runOutsideAngular(()=>j.onAuthStateChanged(at=>xe.next(at),at=>xe.error(at),()=>xe.complete()))})))),Ne=N.pipe((0,pe.w)(j=>new an.y(xe=>({unsubscribe:r.runOutsideAngular(()=>j.onIdTokenChanged(at=>xe.next(at),at=>xe.error(at),()=>xe.complete()))}))));this.authState=ee.pipe(cn(le),(0,Nt.R)(o.outsideAngular),(0,ae.Q)(o.insideAngular)),this.user=ee.pipe(cn(Ne),(0,Nt.R)(o.outsideAngular),(0,ae.Q)(o.insideAngular)),this.idToken=this.user.pipe((0,pe.w)(j=>j?(0,li.D)(j.getIdToken()):(0,B.of)(null))),this.idTokenResult=this.user.pipe((0,pe.w)(j=>j?(0,li.D)(j.getIdTokenResult()):(0,B.of)(null))),this.credential=(0,Tt.T)(ee,E,this.authState.pipe((0,At.h)(j=>!j))).pipe((0,ge.U)(j=>j?.user?j:null),(0,Nt.R)(o.outsideAngular),(0,ae.Q)(o.insideAngular))}return(0,ue.pX)(this,N,r,{spy:{apply:(G,ee,le)=>{(G.startsWith("signIn")||G.startsWith("createUser"))&&le.then(Ne=>E.next(Ne))}}})}}return n.\u0275fac=function(t){return new(t||n)(I.LFG(ue.Dh),I.LFG(ue.xv,8),I.LFG(I.Lbi),I.LFG(I.R0b),I.LFG(me.HU),I.LFG(ct,8),I.LFG(fn,8),I.LFG(_n,8),I.LFG(ht,8),I.LFG(dt,8),I.LFG(pn,8),I.LFG(hn.nm,8))},n.\u0275prov=I.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();var hi=w(6321),mn=w(6699),vn=w(3997),yn=w(9360),Pt=w(8251),di=w(4829),fi=w(2737),Qe=w(2420),_i=w(4564);w(8661);var gi=w(3399),Ke=w(4537),Ye=w(7592),u=w(9058),je=w(7879);const kt="@firebase/database";let ze="";function wn(n){ze=n}class X{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,u.Wl)(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,u.cI)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class $e{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return(0,u.r3)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const xt=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new X(e)}}catch{}return new $e},Ae=xt("localStorage"),Ze=xt("sessionStorage"),Ie=new je.Yd("@firebase/database"),In=function(){let n=1;return function(){return n++}}(),Dt=function(n){const e=(0,u.dS)(n),t=new u.gQ;t.update(e);const i=t.digest();return u.US.encodeByteArray(i)},qe=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?e+=qe.apply(null,i):e+="object"==typeof i?(0,u.Wl)(i):i,e+=" "}return e};let q=null,Ot=!0;const Sn=function(n,e){(0,u.hu)(!e||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(Ie.logLevel=je.in.VERBOSE,q=Ie.log.bind(Ie),e&&Ze.set("logging_enabled",!0)):"function"==typeof n?q=n:(q=null,Ze.remove("logging_enabled"))},Q=function(...n){if(!0===Ot&&(Ot=!1,null===q&&!0===Ze.get("logging_enabled")&&Sn(!0)),q){const e=qe.apply(null,n);q(e)}},Xe=function(n){return function(...e){Q(n,...e)}},ft=function(...n){const e="FIREBASE INTERNAL ERROR: "+qe(...n);Ie.error(e)},U=function(...n){const e=`FIREBASE FATAL ERROR: ${qe(...n)}`;throw Ie.error(e),new Error(e)},K=function(...n){const e="FIREBASE WARNING: "+qe(...n);Ie.warn(e)},_t=function(n){return"number"==typeof n&&(n!=n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},te="[MIN_NAME]",ce="[MAX_NAME]",Se=function(n,e){if(n===e)return 0;if(n===te||e===ce)return-1;if(e===te||n===ce)return 1;{const t=k(n),i=k(e);return null!==t?null!==i?t-i==0?n.length-e.length:t-i:-1:null!==i?1:n<e?-1:1}},mi=function(n,e){return n===e?0:n<e?-1:1},Pe=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+(0,u.Wl)(e))},Ft=function(n){if("object"!=typeof n||null===n)return(0,u.Wl)(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)0!==i&&(t+=","),t+=(0,u.Wl)(e[i]),t+=":",t+=Ft(n[e[i]]);return t+="}",t},Tn=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let s=0;s<t;s+=e)i.push(n.substring(s,s+e>t?t:s+e));return i};function Y(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Rn=function(n){(0,u.hu)(!_t(n),"Invalid JSON number");const i=1023;let s,r,o,l,a;0===n?(r=0,o=0,s=1/n==-1/0?1:0):(s=n<0,(n=Math.abs(n))>=Math.pow(2,1-i)?(l=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=l+i,o=Math.round(n*Math.pow(2,52-l)-Math.pow(2,52))):(r=0,o=Math.round(n/Math.pow(2,-1074))));const c=[];for(a=52;a;a-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(a=11;a;a-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(s?1:0),c.reverse();const f=c.join("");let g="";for(a=0;a<64;a+=8){let m=parseInt(f.substr(a,8),2).toString(16);1===m.length&&(m="0"+m),g+=m}return g.toLowerCase()},v=new RegExp("^-?(0*)\\d{1,10}$"),k=function(n){if(v.test(n)){const e=Number(n);if(e>=-2147483648&&e<=2147483647)return e}return null},x=function(n){try{n()}catch(e){setTimeout(()=>{throw K("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},$=function(n,e){const t=setTimeout(n,e);return"number"==typeof t&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):"object"==typeof t&&t.unref&&t.unref(),t};class he{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){K(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class D{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&"auth/token-not-initialized"===t.code?(Q("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';e+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',K(e)}}let ne=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}return n.OWNER="owner",n})();const As=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,xs="websocket",Ds="long_polling";class yi{constructor(e,t,i,s,r=!1,o="",l=!1,a=!1){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ae.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ae.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function Os(n,e,t){let i;if((0,u.hu)("string"==typeof e,"typeof type must == string"),(0,u.hu)("object"==typeof t,"typeof params must == object"),e===xs)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else{if(e!==Ds)throw new Error("Unknown connection type: "+e);i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?"}(function Oo(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams})(n)&&(t.ns=n.namespace);const s=[];return Y(t,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}class Lo{constructor(){this.counters_={}}incrementCounter(e,t=1){(0,u.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return(0,u.p$)(this.counters_)}}const Ci={},Ei={};function wi(n){const e=n.toString();return Ci[e]||(Ci[e]=new Lo),Ci[e]}class Mo{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&x(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Oe{constructor(e,t,i,s,r,o,l){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Xe(e),this.stats_=wi(t),this.urlFn=a=>(this.appCheckToken&&(a.ac=this.appCheckToken),Os(t,Ds,a))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Mo(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(n){if((0,u.Yr)()||"complete"===document.readyState)n();else{let e=!1;const t=function(){document.body?e||(e=!0,n()):setTimeout(t,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&t()}),window.attachEvent("onload",t))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ii((...r)=>{const[o,l,a,c,f]=r;if(this.incrementIncomingBytes_(r),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===o)this.id=l,this.password=a;else{if("close"!==o)throw new Error("Unrecognized command received: "+o);l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_()}},(...r)=>{const[o,l]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const i={start:"t"};i.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(i.cb=this.scriptTagHolder.uniqueCallbackIdentifier),i.v="5",this.transportSessionId&&(i.s=this.transportSessionId),this.lastSessionId&&(i.ls=this.lastSessionId),this.applicationId&&(i.p=this.applicationId),this.appCheckToken&&(i.ac=this.appCheckToken),typeof location<"u"&&location.hostname&&As.test(location.hostname)&&(i.r="f");const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Oe.forceAllow_=!0}static forceDisallow(){Oe.forceDisallow_=!0}static isAvailable(){return!((0,u.Yr)()||!Oe.forceAllow_&&(Oe.forceDisallow_||!(typeof document<"u")||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=(0,u.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=(0,u.h$)(t),s=Tn(i,1840);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if((0,u.Yr)())return;this.myDisconnFrame=document.createElement("iframe");const i={dframe:"t"};i.id=e,i.pw=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=(0,u.Wl)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Ii{constructor(e,t,i,s){if(this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,u.Yr)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=In(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Ii.createIFrame_();let r="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){Q("frame writing exception"),l.stack&&Q(l.stack),Q(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Q("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+i.length<=1870;){const o=this.pendingSegs.shift();i=i+"&seg"+s+"="+o.seg+"&ts"+s+"="+o.ts+"&d"+s+"="+o.d,s++}return t+=i,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(s),i()})}addTag(e,t){(0,u.Yr)()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||"loaded"===s||"complete"===s)&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{Q("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}let bn=null;typeof MozWebSocket<"u"?bn=MozWebSocket:typeof WebSocket<"u"&&(bn=WebSocket);let pt=(()=>{class n{constructor(t,i,s,r,o,l,a){this.connId=t,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Xe(this.connId),this.stats_=wi(i),this.connURL=n.connectionURL_(i,l,a,r,s),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,s,r,o){const l={v:"5"};return!(0,u.Yr)()&&typeof location<"u"&&location.hostname&&As.test(location.hostname)&&(l.r="f"),i&&(l.s=i),s&&(l.ls=s),r&&(l.ac=r),o&&(l.p=o),Os(t,xs,l)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ae.set("previous_websocket_failure",!0);try{let s;if((0,u.Yr)()){s={headers:{"User-Agent":`Firebase/5/${ze}/${process.platform}/${this.nodeAdmin?"AdminNode":"Node"}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);const o=process.env,l=0===this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;l&&(s.proxy={origin:l})}this.mySock=new bn(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const r=s.message||s.data;return r&&this.log_(r),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){const s=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);s&&s.length>1&&parseFloat(s[1])<4.4&&(t=!0)}return!t&&null!==bn&&!n.forceDisallow_}static previouslyFailed(){return Ae.isInMemoryStorage||!0===Ae.get("previous_websocket_failure")}markConnectionHealthy(){Ae.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const i=this.frames.join("");this.frames=null;const s=(0,u.cI)(i);this.onMessage(s)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if((0,u.hu)(null===this.frames,"We already have a frame buffer"),t.length<=6){const i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(i);else{const s=this.extractFrameCount_(i);null!==s&&this.appendFrame_(s)}}send(t){this.resetKeepAlive();const i=(0,u.Wl)(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);const s=Tn(i,16384);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),Vs=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Oe,pt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){const i=pt&&pt.isAvailable();let s=i&&!pt.previouslyFailed();if(t.webSocketOnly&&(i||K("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[pt];else{const r=this.transports_=[];for(const o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}return n.globalTransportInitialized_=!1,n})();class zs{constructor(e,t,i,s,r,o,l,a,c,f){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=f,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Xe("c:"+this.id+":"),this.transportManager_=new Vs(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=$(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Pe("t",e),i=Pe("d",e);if("c"===t)this.onSecondaryControl_(i);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(i)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Pe("t",e),i=Pe("d",e);"c"===t?this.onControl_(i):"d"===t&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Pe("t",e);if("d"in e){const i=e.d;if("h"===t){const s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(i):"r"===t?this.onReset_(i):"e"===t?ft("Server Error: "+i):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ft("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==i&&K("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),$(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):$(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ae.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class $s{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}class Zs{constructor(e){this.allowedEvents_=e,this.listeners_={},(0,u.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!i||i===s[r].context))return void s.splice(r,1)}validateEventType_(e){(0,u.hu)(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Nn extends Zs{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!(0,u.uI)()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Nn}getInitialEvent(e){return(0,u.hu)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class L{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function O(){return new L("")}function R(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Le(n){return n.pieces_.length-n.pieceNum_}function F(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new L(n.pieces_,e)}function Ti(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Mt(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Js(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new L(e,0)}function V(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof L)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new L(t,0)}function b(n){return n.pieceNum_>=n.pieces_.length}function J(n,e){const t=R(n),i=R(e);if(null===t)return e;if(t===i)return J(F(n),F(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function rl(n,e){const t=Mt(n,0),i=Mt(e,0);for(let s=0;s<t.length&&s<i.length;s++){const r=Se(t[s],i[s]);if(0!==r)return r}return t.length===i.length?0:t.length<i.length?-1:1}function Ri(n,e){if(Le(n)!==Le(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function de(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(Le(n)>Le(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class ol{constructor(e,t){this.errorPrefix_=t,this.parts_=Mt(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=(0,u.ug)(this.parts_[i]);er(this)}}function er(n){if(n.byteLength_>768)throw new Error(n.errorPrefix_+"has a key path longer than 768 bytes ("+n.byteLength_+").");if(n.parts_.length>32)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+et(n))}function et(n){return 0===n.parts_.length?"":"in property '"+n.parts_.join(".")+"'"}class bi extends Zs{constructor(){let e,t;super(["visible"]),typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new bi}getInitialEvent(e){return(0,u.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]}}const Wt=1e3;let Pn,tt=(()=>{class n extends $s{constructor(t,i,s,r,o,l,a,c){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=l,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=Xe("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Wt,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!(0,u.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");bi.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Nn.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,s){const r=++this.requestNumber_,o={r,a:t,b:i};this.log_((0,u.Wl)(o)),(0,u.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(t){this.initConnection_();const i=new u.BH,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:l=>{const a=l.d;"ok"===l.s?i.resolve(a):i.reject(a)}};return this.outstandingGets_.push(r),this.outstandingGetCount_++,this.connected_&&this.sendGet_(this.outstandingGets_.length-1),i.promise}listen(t,i,s,r){this.initConnection_();const o=t._queryIdentifier,l=t._path.toString();this.log_("Listen called for "+l+" "+o),this.listens.has(l)||this.listens.set(l,new Map),(0,u.hu)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,u.hu)(!this.listens.get(l).has(o),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:i,query:t,tag:s};this.listens.get(l).set(o,a),this.connected_&&this.sendListen_(a)}sendGet_(t){const i=this.outstandingGets_[t];this.sendRequest("g",i.request,s=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(s)})}sendListen_(t){const i=t.query,s=i._path.toString(),r=i._queryIdentifier;this.log_("Listen on "+s+" for "+r);const o={p:s};t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest("q",o,a=>{const c=a.d,f=a.s;n.warnOnListenWarnings_(c,i),(this.listens.get(s)&&this.listens.get(s).get(r))===t&&(this.log_("listen response",a),"ok"!==f&&this.removeListen_(s,r),t.onComplete&&t.onComplete(f,c))})}static warnOnListenWarnings_(t,i){if(t&&"object"==typeof t&&(0,u.r3)(t,"w")){const s=(0,u.DV)(t,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const r='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();K(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||(0,u.GJ)(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,i=(0,u.w9)(t)?"auth":"gauth",s={cred:t};null===this.authOverride_?s.noauth=!0:"object"==typeof this.authOverride_&&(s.authvar=this.authOverride_),this.sendRequest(i,s,r=>{const o=r.s,l=r.d||"error";this.authToken_===t&&("ok"===o?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,l))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const i=t.s,s=t.d||"error";"ok"===i?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,s)})}unlisten(t,i){const s=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),(0,u.hu)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,t._queryObject,i)}sendUnlisten_(t,i,s,r){this.log_("Unlisten on "+t+" for "+i);const o={p:t};r&&(o.q=s,o.t=r),this.sendRequest("n",o)}onDisconnectPut(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:s})}onDisconnectMerge(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:s})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,s,r){const o={p:i,d:s};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,l=>{r&&setTimeout(()=>{r(l.s,l.d)},Math.floor(0))})}put(t,i,s,r){this.putInternal("p",t,i,s,r)}merge(t,i,s,r){this.putInternal("m",t,i,s,r)}putInternal(t,i,s,r,o){this.initConnection_();const l={p:i,d:s};void 0!==o&&(l.h=o),this.outstandingPuts_.push({action:t,request:l,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+i)}sendPut_(t){const i=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,s,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){const i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,s=>{"ok"!==s.s&&this.log_("reportStats","Error sending stats: "+s.d)})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+(0,u.Wl)(t));const i=t.r,s=this.requestCBHash_[i];s&&(delete this.requestCBHash_[i],s(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),"d"===t?this.onDataUpdate_(i.p,i.d,!1,i.t):"m"===t?this.onDataUpdate_(i.p,i.d,!0,i.t):"c"===t?this.onListenRevoked_(i.p,i.q):"ac"===t?this.onAuthRevoked_(i.s,i.d):"apc"===t?this.onAppCheckRevoked_(i.s,i.d):"sd"===t?this.onSecurityDebugPacket_(i):ft("Unrecognized action received from server: "+(0,u.Wl)(t)+"\nAre you using the latest client?")}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){(0,u.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Wt,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Wt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Wt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const t=(new Date).getTime()-this.lastConnectionAttemptTime_;let i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var t=this;return(0,P.Z)(function*(){if(t.shouldReconnect_()){t.log_("Making a connection attempt"),t.lastConnectionAttemptTime_=(new Date).getTime(),t.lastConnectionEstablishedTime_=null;const i=t.onDataMessage_.bind(t),s=t.onReady_.bind(t),r=t.onRealtimeDisconnect_.bind(t),o=t.id+":"+n.nextConnectionId_++,l=t.lastSessionId;let a=!1,c=null;const f=function(){c?c.close():(a=!0,r())};t.realtime_={close:f,sendRequest:function(C){(0,u.hu)(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(C)}};const m=t.forceTokenRefresh_;t.forceTokenRefresh_=!1;try{const[C,E]=yield Promise.all([t.authTokenProvider_.getToken(m),t.appCheckTokenProvider_.getToken(m)]);a?Q("getToken() completed but was canceled"):(Q("getToken() completed. Creating connection."),t.authToken_=C&&C.accessToken,t.appCheckToken_=E&&E.token,c=new zs(o,t.repoInfo_,t.applicationId_,t.appCheckToken_,t.authToken_,i,s,r,N=>{K(N+" ("+t.repoInfo_.toString()+")"),t.interrupt("server_kill")},l))}catch(C){t.log_("Failed to get token: "+C),a||(t.repoInfo_.nodeAdmin&&K(C),f())}}})()}interrupt(t){Q("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Q("Resuming connection for reason: "+t),delete this.interruptReasons_[t],(0,u.xb)(this.interruptReasons_)&&(this.reconnectDelay_=Wt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const i=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let s;s=i?i.map(o=>Ft(o)).join("$"):"default";const r=this.removeListen_(t,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,i){const s=new L(t).toString();let r;if(this.listens.has(s)){const o=this.listens.get(s);r=o.get(i),o.delete(i),0===o.size&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(t,i){Q("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===t||"permission_denied"===t)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){Q("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===t||"permission_denied"===t)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let i="js";(0,u.Yr)()&&(i=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+i+"."+ze.replace(/\./g,"-")]=1,(0,u.uI)()?t["framework.cordova"]=1:(0,u.b$)()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Nn.getInstance().currentlyOnline();return(0,u.xb)(this.interruptReasons_)&&t}}return n.nextPersistentConnectionId_=0,n.nextConnectionId_=0,n})();class A{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new A(e,t)}}class An{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new A(te,e),s=new A(te,t);return 0!==this.compare(i,s)}minPost(){return A.MIN}}class ir extends An{static get __EMPTY_NODE(){return Pn}static set __EMPTY_NODE(e){Pn=e}compare(e,t){return Se(e.name,t.name)}isDefinedOn(e){throw(0,u.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return A.MIN}maxPost(){return new A(ce,Pn)}makePost(e,t){return(0,u.hu)("string"==typeof e,"KeyIndex indexValue must always be a string."),new A(e,Pn)}toString(){return".key"}}const Te=new ir;class kn{constructor(e,t,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(o=t?i(e.key,t):1,s&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}let Ai,ye=(()=>{class n{constructor(t,i,s,r,o){this.key=t,this.value=i,this.color=s??n.RED,this.left=r??ie.EMPTY_NODE,this.right=o??ie.EMPTY_NODE}copy(t,i,s,r,o){return new n(t??this.key,i??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,s){let r=this;const o=s(t,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(t,i,s),null):0===o?r.copy(null,i,null,null,null):r.copy(null,null,null,null,r.right.insert(t,i,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return ie.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let s,r;if(s=this,i(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),0===i(t,s.key)){if(s.right.isEmpty())return ie.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})();class ie{constructor(e,t=ie.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new ie(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,ye.BLACK,null,null))}remove(e){return new ie(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ye.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),0===t)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),0===t){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}t<0?i=i.left:t>0&&(s=i,i=i.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new kn(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new kn(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new kn(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new kn(this.root_,null,this.comparator_,!0,e)}}function _l(n,e){return Se(n.name,e.name)}function Ni(n,e){return Se(n,e)}ie.EMPTY_NODE=new class fl{copy(e,t,i,s,r){return this}insert(e,t,i){return new ye(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const sr=function(n){return"number"==typeof n?"number:"+Rn(n):"string:"+n},rr=function(n){if(n.isLeafNode()){const e=n.val();(0,u.hu)("string"==typeof e||"number"==typeof e||"object"==typeof e&&(0,u.r3)(e,".sv"),"Priority must be a string or number.")}else(0,u.hu)(n===Ai||n.isEmpty(),"priority of unexpected type.");(0,u.hu)(n===Ai||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let or,lr,ar,gt=(()=>{class n{constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,(0,u.hu)(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),rr(this.priorityNode_)}static set __childrenNodeConstructor(t){or=t}static get __childrenNodeConstructor(){return or}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return b(t)?this:".priority"===R(t)?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return".priority"===t?this.updatePriority(i):i.isEmpty()&&".priority"!==t?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){const s=R(t);return null===s?i:i.isEmpty()&&".priority"!==s?this:((0,u.hu)(".priority"!==s||1===Le(t),".priority must be the last token in a path"),this.updateImmediateChild(s,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(F(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+sr(this.priorityNode_.val())+":");const i=typeof this.value_;t+=i+":",t+="number"===i?Rn(this.value_):this.value_,this.lazyHash_=Dt(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:((0,u.hu)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const i=typeof t.value_,s=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(s);return(0,u.hu)(r>=0,"Unknown leaf type: "+i),(0,u.hu)(o>=0,"Unknown leaf type: "+s),r===o?"object"===s?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){return t===this||!!t.isLeafNode()&&(this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_))}}return n.VALUE_TYPE_ORDER=["object","boolean","number","string"],n})();const M=new class vl extends An{compare(e,t){const i=e.node.getPriority(),s=t.node.getPriority(),r=i.compareTo(s);return 0===r?Se(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return A.MIN}maxPost(){return new A(ce,new gt("[PRIORITY-POST]",ar))}makePost(e,t){const i=lr(e);return new A(t,new gt("[PRIORITY-POST]",i))}toString(){return".priority"}},yl=Math.log(2);class Cl{constructor(e){this.count=parseInt(Math.log(e+1)/yl,10),this.current_=this.count-1;const s=(r=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const xn=function(n,e,t,i){n.sort(e);const s=function(a,c){const f=c-a;let g,m;if(0===f)return null;if(1===f)return g=n[a],m=t?t(g):g,new ye(m,g.node,ye.BLACK,null,null);{const C=parseInt(f/2,10)+a,E=s(a,C),N=s(C+1,c);return g=n[C],m=t?t(g):g,new ye(m,g.node,ye.BLACK,E,N)}},l=function(a){let c=null,f=null,g=n.length;const m=function(E,N){const G=g-E,ee=g;g-=E;const le=s(G+1,ee),Ne=n[G],j=t?t(Ne):Ne;C(new ye(j,Ne.node,N,null,le))},C=function(E){c?(c.left=E,c=E):(f=E,c=E)};for(let E=0;E<a.count;++E){const N=a.nextBitIsOne(),G=Math.pow(2,a.count-(E+1));N?m(G,ye.BLACK):(m(G,ye.BLACK),m(G,ye.RED))}return f}(new Cl(n.length));return new ie(i||e,l)};let Pi;const mt={};class ke{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return(0,u.hu)(mt&&M,"ChildrenNode.ts has not been loaded"),Pi=Pi||new ke({".priority":mt},{".priority":M}),Pi}get(e){const t=(0,u.DV)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ie?t:null}hasIndex(e){return(0,u.r3)(this.indexSet_,e.toString())}addIndex(e,t){(0,u.hu)(e!==Te,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=t.getIterator(A.Wrap);let l,o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();l=s?xn(i,e.getCompare()):mt;const a=e.toString(),c=Object.assign({},this.indexSet_);c[a]=e;const f=Object.assign({},this.indexes_);return f[a]=l,new ke(f,c)}addToIndexes(e,t){const i=(0,u.UI)(this.indexes_,(s,r)=>{const o=(0,u.DV)(this.indexSet_,r);if((0,u.hu)(o,"Missing index implementation for "+r),s===mt){if(o.isDefinedOn(e.node)){const l=[],a=t.getIterator(A.Wrap);let c=a.getNext();for(;c;)c.name!==e.name&&l.push(c),c=a.getNext();return l.push(e),xn(l,o.getCompare())}return mt}{const l=t.get(e.name);let a=s;return l&&(a=a.remove(new A(e.name,l))),a.insert(e,e.node)}});return new ke(i,this.indexSet_)}removeFromIndexes(e,t){const i=(0,u.UI)(this.indexes_,s=>{if(s===mt)return s;{const r=t.get(e.name);return r?s.remove(new A(e.name,r)):s}});return new ke(i,this.indexSet_)}}let Ut,S=(()=>{class n{constructor(t,i,s){this.children_=t,this.priorityNode_=i,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&rr(this.priorityNode_),this.children_.isEmpty()&&(0,u.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Ut||(Ut=new n(new ie(Ni),null,ke.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ut}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const i=this.children_.get(t);return null===i?Ut:i}}getChild(t){const i=R(t);return null===i?this:this.getImmediateChild(i).getChild(F(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,i){if((0,u.hu)(i,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(i);{const s=new A(t,i);let r,o;i.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(s,this.children_));const l=r.isEmpty()?Ut:this.priorityNode_;return new n(r,l,o)}}updateChild(t,i){const s=R(t);if(null===s)return i;{(0,u.hu)(".priority"!==R(t)||1===Le(t),".priority must be the last token in a path");const r=this.getImmediateChild(s).updateChild(F(t),i);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const i={};let s=0,r=0,o=!0;if(this.forEachChild(M,(l,a)=>{i[l]=a.val(t),s++,o&&n.INTEGER_REGEXP_.test(l)?r=Math.max(r,Number(l)):o=!1}),!t&&o&&r<2*s){const l=[];for(const a in i)l[a]=i[a];return l}return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+sr(this.getPriority().val())+":"),this.forEachChild(M,(i,s)=>{const r=s.hash();""!==r&&(t+=":"+i+":"+r)}),this.lazyHash_=""===t?"":Dt(t)}return this.lazyHash_}getPredecessorChildName(t,i,s){const r=this.resolveIndex_(s);if(r){const o=r.getPredecessorKey(new A(t,i));return o?o.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const i=this.resolveIndex_(t);if(i){const s=i.minKey();return s&&s.name}return this.children_.minKey()}getFirstChild(t){const i=this.getFirstChildName(t);return i?new A(i,this.children_.get(i)):null}getLastChildName(t){const i=this.resolveIndex_(t);if(i){const s=i.maxKey();return s&&s.name}return this.children_.maxKey()}getLastChild(t){const i=this.getLastChildName(t);return i?new A(i,this.children_.get(i)):null}forEachChild(t,i){const s=this.resolveIndex_(t);return s?s.inorderTraversal(r=>i(r.name,r.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){const s=this.resolveIndex_(i);if(s)return s.getIteratorFrom(t,r=>r);{const r=this.children_.getIteratorFrom(t.name,A.Wrap);let o=r.peek();for(;null!=o&&i.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){const s=this.resolveIndex_(i);if(s)return s.getReverseIteratorFrom(t,r=>r);{const r=this.children_.getReverseIteratorFrom(t.name,A.Wrap);let o=r.peek();for(;null!=o&&i.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Bt?-1:0}withIndex(t){if(t===Te||this.indexMap_.hasIndex(t))return this;{const i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===Te||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const i=t;if(this.getPriority().equals(i.getPriority())){if(this.children_.count()===i.children_.count()){const s=this.getIterator(M),r=i.getIterator(M);let o=s.getNext(),l=r.getNext();for(;o&&l;){if(o.name!==l.name||!o.node.equals(l.node))return!1;o=s.getNext(),l=r.getNext()}return null===o&&null===l}return!1}return!1}}resolveIndex_(t){return t===Te?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})();const Bt=new class El extends S{constructor(){super(new ie(Ni),S.EMPTY_NODE,ke.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return S.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(A,{MIN:{value:new A(te,S.EMPTY_NODE)},MAX:{value:new A(ce,Bt)}}),ir.__EMPTY_NODE=S.EMPTY_NODE,gt.__childrenNodeConstructor=S,function pl(n){Ai=n}(Bt),function ml(n){ar=n}(Bt);const wl=!0;function H(n,e=null){if(null===n)return S.EMPTY_NODE;if("object"==typeof n&&".priority"in n&&(e=n[".priority"]),(0,u.hu)(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof n&&".value"in n&&null!==n[".value"]&&(n=n[".value"]),"object"!=typeof n||".sv"in n)return new gt(n,H(e));if(n instanceof Array||!wl){let t=S.EMPTY_NODE;return Y(n,(i,s)=>{if((0,u.r3)(n,i)&&"."!==i.substring(0,1)){const r=H(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(i,r))}}),t.updatePriority(H(e))}{const t=[];let i=!1;if(Y(n,(o,l)=>{if("."!==o.substring(0,1)){const a=H(l);a.isEmpty()||(i=i||!a.getPriority().isEmpty(),t.push(new A(o,a)))}}),0===t.length)return S.EMPTY_NODE;const r=xn(t,_l,o=>o.name,Ni);if(i){const o=xn(t,M.getCompare());return new S(r,H(e),new ke({".priority":o},{".priority":M}))}return new S(r,H(e),ke.Default)}}!function gl(n){lr=n}(H);class ki extends An{constructor(e){super(),this.indexPath_=e,(0,u.hu)(!b(e)&&".priority"!==R(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),s=this.extractChild(t.node),r=i.compareTo(s);return 0===r?Se(e.name,t.name):r}makePost(e,t){const i=H(e),s=S.EMPTY_NODE.updateChild(this.indexPath_,i);return new A(t,s)}maxPost(){const e=S.EMPTY_NODE.updateChild(this.indexPath_,Bt);return new A(ce,e)}toString(){return Mt(this.indexPath_,0).join("/")}}const xi=new class Il extends An{compare(e,t){const i=e.node.compareTo(t.node);return 0===i?Se(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return A.MIN}maxPost(){return A.MAX}makePost(e,t){const i=H(e);return new A(t,i)}toString(){return".value"}};function ur(n){return{type:"value",snapshotNode:n}}function vt(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Vt(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Gt(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}class Di{constructor(e){this.index_=e}updateChild(e,t,i,s,r,o){(0,u.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(t);return l.getChild(s).equals(i.getChild(s))&&l.isEmpty()===i.isEmpty()||(null!=o&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(Vt(t,l)):(0,u.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(vt(t,i)):o.trackChildChange(Gt(t,i,l))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return null!=i&&(e.isLeafNode()||e.forEachChild(M,(s,r)=>{t.hasChild(s)||i.trackChildChange(Vt(s,r))}),t.isLeafNode()||t.forEachChild(M,(s,r)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(Gt(s,r,o))}else i.trackChildChange(vt(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?S.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Ht{constructor(e){this.indexedFilter_=new Di(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Ht.getStartPost_(e),this.endPost_=Ht.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,s,r,o){return this.matches(new A(t,i))||(i=S.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,r,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=S.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(S.EMPTY_NODE);const r=this;return t.forEachChild(M,(o,l)=>{r.matches(new A(o,l))||(s=s.updateImmediateChild(o,S.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class Tl{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{const i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Ht(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,s,r,o){return this.rangedFilter_.matches(new A(t,i))||(i=S.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,r,o):this.fullLimitUpdateChild_(e,t,i,r,o)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=S.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let r;s=S.EMPTY_NODE.withIndex(this.index_),r=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const l=r.getNext();if(this.withinDirectionalStart(l)){if(!this.withinDirectionalEnd(l))break;s=s.updateImmediateChild(l.name,l.node),o++}}}else{let r;s=t.withIndex(this.index_),s=s.updatePriority(S.EMPTY_NODE),r=this.reverse_?s.getReverseIterator(this.index_):s.getIterator(this.index_);let o=0;for(;r.hasNext();){const l=r.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:s=s.updateImmediateChild(l.name,S.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,r){let o;if(this.reverse_){const g=this.index_.getCompare();o=(m,C)=>g(C,m)}else o=this.index_.getCompare();const l=e;(0,u.hu)(l.numChildren()===this.limit_,"");const a=new A(t,i),c=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),f=this.rangedFilter_.matches(a);if(l.hasChild(t)){const g=l.getImmediateChild(t);let m=s.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=m&&(m.name===t||l.hasChild(m.name));)m=s.getChildAfterChild(this.index_,m,this.reverse_);const C=null==m?1:o(m,a);if(f&&!i.isEmpty()&&C>=0)return r?.trackChildChange(Gt(t,i,g)),l.updateImmediateChild(t,i);{r?.trackChildChange(Vt(t,g));const N=l.updateImmediateChild(t,S.EMPTY_NODE);return null!=m&&this.rangedFilter_.matches(m)?(r?.trackChildChange(vt(m.name,m.node)),N.updateImmediateChild(m.name,m.node)):N}}return i.isEmpty()?e:f&&o(c,a)>=0?(null!=r&&(r.trackChildChange(Vt(c.name,c.node)),r.trackChildChange(vt(t,i))),l.updateImmediateChild(t,i).updateImmediateChild(c.name,S.EMPTY_NODE)):e}}class Dn{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=M}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,u.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(0,u.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:te}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,u.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(0,u.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ce}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,u.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===M}copy(){const e=new Dn;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Oi(n,e,t){const i=n.copy();return i.startSet_=!0,void 0===e&&(e=null),i.indexStartValue_=e,null!=t?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function Li(n,e,t){const i=n.copy();return i.endSet_=!0,void 0===e&&(e=null),i.indexEndValue_=e,void 0!==t?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function On(n,e){const t=n.copy();return t.index_=e,t}function cr(n){const e={};if(n.isDefault())return e;let t;if(n.index_===M?t="$priority":n.index_===xi?t="$value":n.index_===Te?t="$key":((0,u.hu)(n.index_ instanceof ki,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=(0,u.Wl)(t),n.startSet_){const i=n.startAfterSet_?"startAfter":"startAt";e[i]=(0,u.Wl)(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+(0,u.Wl)(n.indexStartName_))}if(n.endSet_){const i=n.endBeforeSet_?"endBefore":"endAt";e[i]=(0,u.Wl)(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+(0,u.Wl)(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function hr(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;""===t&&(t=n.isViewFromLeft()?"l":"r"),e.vf=t}return n.index_!==M&&(e.i=n.index_.toString()),e}class Ln extends $s{constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=Xe("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:((0,u.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,s){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=Ln.getListenId_(e,i),l={};this.listens_[o]=l;const a=cr(e._queryParams);this.restRequest_(r+".json",a,(c,f)=>{let g=f;if(404===c&&(g=null,c=null),null===c&&this.onDataUpdate_(r,g,!1,i),(0,u.DV)(this.listens_,o)===l){let m;m=c?401===c?"permission_denied":"rest_error:"+c:"ok",s(m,null)}})}unlisten(e,t){const i=Ln.getListenId_(e,t);delete this.listens_[i]}get(e){const t=cr(e._queryParams),i=e._path.toString(),s=new u.BH;return this.restRequest_(i+".json",t,(r,o)=>{let l=o;404===r&&(l=null,r=null),null===r?(this.onDataUpdate_(i,l,!1,null),s.resolve(l)):s.reject(new Error(l))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+(0,u.xO)(t);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(i&&4===l.readyState){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let a=null;if(l.status>=200&&l.status<300){try{a=(0,u.cI)(l.responseText)}catch{K("Failed to parse JSON response for "+o+": "+l.responseText)}i(null,a)}else 401!==l.status&&404!==l.status&&K("Got unsuccessful REST response for "+o+" Status: "+l.status),i(l.status);i=null}},l.open("GET",o,!0),l.send()})}}class kl{constructor(){this.rootNode_=S.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Fn(){return{value:null,children:new Map}}function yt(n,e,t){if(b(e))n.value=t,n.children.clear();else if(null!==n.value)n.value=n.value.updateChild(e,t);else{const i=R(e);n.children.has(i)||n.children.set(i,Fn()),yt(n.children.get(i),e=F(e),t)}}function Fi(n,e){if(b(e))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(M,(i,s)=>{yt(n,new L(i),s)}),Fi(n,e)}}if(n.children.size>0){const t=R(e);return e=F(e),n.children.has(t)&&Fi(n.children.get(t),e)&&n.children.delete(t),0===n.children.size}return!0}function Mi(n,e,t){null!==n.value?t(e,n.value):function xl(n,e){n.children.forEach((t,i)=>{e(i,t)})}(n,(i,s)=>{Mi(s,new L(e.toString()+"/"+i),t)})}class Dl{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Y(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}}class Fl{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Dl(e);const i=1e4+2e4*Math.random();$(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;Y(e,(s,r)=>{r>0&&(0,u.r3)(this.statsToReport_,s)&&(t[s]=r,i=!0)}),i&&this.server_.reportStats(t),$(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Re=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Re||{});function Bi(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class Mn{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Re.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(b(this.path)){if(null!=this.affectedTree.value)return(0,u.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new L(e));return new Mn(O(),t,this.revert)}}return(0,u.hu)(R(this.path)===e,"operationForChild called for unrelated child."),new Mn(F(this.path),this.affectedTree,this.revert)}}class Qt{constructor(e,t){this.source=e,this.path=t,this.type=Re.LISTEN_COMPLETE}operationForChild(e){return b(this.path)?new Qt(this.source,O()):new Qt(this.source,F(this.path))}}class nt{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Re.OVERWRITE}operationForChild(e){return b(this.path)?new nt(this.source,O(),this.snap.getImmediateChild(e)):new nt(this.source,F(this.path),this.snap)}}class Ct{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Re.MERGE}operationForChild(e){if(b(this.path)){const t=this.children.subtree(new L(e));return t.isEmpty()?null:t.value?new nt(this.source,O(),t.value):new Ct(this.source,O(),t)}return(0,u.hu)(R(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Ct(this.source,F(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Fe{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(b(e))return this.isFullyInitialized()&&!this.filtered_;const t=R(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Ml{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Kt(n,e,t,i,s,r){const o=i.filter(l=>l.type===t);o.sort((l,a)=>function Bl(n,e,t){if(null==e.childName||null==t.childName)throw(0,u.g5)("Should only compare child_ events.");const i=new A(e.childName,e.snapshotNode),s=new A(t.childName,t.snapshotNode);return n.index_.compare(i,s)}(n,l,a)),o.forEach(l=>{const a=function Ul(n,e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}(n,l,r);s.forEach(c=>{c.respondsTo(l.type)&&e.push(c.createEvent(a,n.query_))})})}function Wn(n,e){return{eventCache:n,serverCache:e}}function Yt(n,e,t,i){return Wn(new Fe(e,t,i),n.serverCache)}function fr(n,e,t,i){return Wn(n.eventCache,new Fe(e,t,i))}function Un(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function it(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Vi;class W{constructor(e,t=(()=>(Vi||(Vi=new ie(mi)),Vi))()){this.value=e,this.children=t}static fromObject(e){let t=new W(null);return Y(e,(i,s)=>{t=t.set(new L(i),s)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:O(),value:this.value};if(b(e))return null;{const i=R(e),s=this.children.get(i);if(null!==s){const r=s.findRootMostMatchingPathAndValue(F(e),t);return null!=r?{path:V(new L(i),r.path),value:r.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(b(e))return this;{const t=R(e),i=this.children.get(t);return null!==i?i.subtree(F(e)):new W(null)}}set(e,t){if(b(e))return new W(t,this.children);{const i=R(e),r=(this.children.get(i)||new W(null)).set(F(e),t),o=this.children.insert(i,r);return new W(this.value,o)}}remove(e){if(b(e))return this.children.isEmpty()?new W(null):new W(null,this.children);{const t=R(e),i=this.children.get(t);if(i){const s=i.remove(F(e));let r;return r=s.isEmpty()?this.children.remove(t):this.children.insert(t,s),null===this.value&&r.isEmpty()?new W(null):new W(this.value,r)}return this}}get(e){if(b(e))return this.value;{const t=R(e),i=this.children.get(t);return i?i.get(F(e)):null}}setTree(e,t){if(b(e))return t;{const i=R(e),r=(this.children.get(i)||new W(null)).setTree(F(e),t);let o;return o=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new W(this.value,o)}}fold(e){return this.fold_(O(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(V(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,O(),t)}findOnPath_(e,t,i){const s=!!this.value&&i(t,this.value);if(s)return s;if(b(e))return null;{const r=R(e),o=this.children.get(r);return o?o.findOnPath_(F(e),V(t,r),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,O(),t)}foreachOnPath_(e,t,i){if(b(e))return this;{this.value&&i(t,this.value);const s=R(e),r=this.children.get(s);return r?r.foreachOnPath_(F(e),V(t,s),i):new W(null)}}foreach(e){this.foreach_(O(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(V(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}class Ce{constructor(e){this.writeTree_=e}static empty(){return new Ce(new W(null))}}function jt(n,e,t){if(b(e))return new Ce(new W(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(null!=i){const s=i.path;let r=i.value;const o=J(s,e);return r=r.updateChild(o,t),new Ce(n.writeTree_.set(s,r))}{const s=new W(t),r=n.writeTree_.setTree(e,s);return new Ce(r)}}}function Gi(n,e,t){let i=n;return Y(t,(s,r)=>{i=jt(i,V(e,s),r)}),i}function _r(n,e){if(b(e))return Ce.empty();{const t=n.writeTree_.setTree(e,new W(null));return new Ce(t)}}function Hi(n,e){return null!=st(n,e)}function st(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return null!=t?n.writeTree_.get(t.path).getChild(J(t.path,e)):null}function pr(n){const e=[],t=n.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(M,(i,s)=>{e.push(new A(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{null!=s.value&&e.push(new A(i,s.value))}),e}function Me(n,e){if(b(e))return n;{const t=st(n,e);return new Ce(null!=t?new W(t):n.writeTree_.subtree(e))}}function Qi(n){return n.writeTree_.isEmpty()}function Et(n,e){return gr(O(),n.writeTree_,e)}function gr(n,e,t){if(null!=e.value)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{".priority"===s?((0,u.hu)(null!==r.value,"Priority writes must always be leaf nodes"),i=r.value):t=gr(V(n,s),r,t)}),!t.getChild(n).isEmpty()&&null!==i&&(t=t.updateChild(V(n,".priority"),i)),t}}function Bn(n,e){return Er(e,n)}function Yl(n,e){if(n.snap)return de(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&de(V(n.path,t),e))return!0;return!1}function zl(n){return n.visible}function mr(n,e,t){let i=Ce.empty();for(let s=0;s<n.length;++s){const r=n[s];if(e(r)){const o=r.path;let l;if(r.snap)de(t,o)?(l=J(t,o),i=jt(i,l,r.snap)):de(o,t)&&(l=J(o,t),i=jt(i,O(),r.snap.getChild(l)));else{if(!r.children)throw(0,u.g5)("WriteRecord should have .snap or .children");if(de(t,o))l=J(t,o),i=Gi(i,l,r.children);else if(de(o,t))if(l=J(o,t),b(l))i=Gi(i,O(),r.children);else{const a=(0,u.DV)(r.children,R(l));if(a){const c=a.getChild(F(l));i=jt(i,O(),c)}}}}}return i}function vr(n,e,t,i,s){if(i||s){const r=Me(n.visibleWrites,e);return!s&&Qi(r)?t:s||null!=t||Hi(r,O())?Et(mr(n.allWrites,function(c){return(c.visible||s)&&(!i||!~i.indexOf(c.writeId))&&(de(c.path,e)||de(e,c.path))},e),t||S.EMPTY_NODE):null}{const r=st(n.visibleWrites,e);if(null!=r)return r;{const o=Me(n.visibleWrites,e);return Qi(o)?t:null!=t||Hi(o,O())?Et(o,t||S.EMPTY_NODE):null}}}function Vn(n,e,t,i){return vr(n.writeTree,n.treePath,e,t,i)}function Ki(n,e){return function $l(n,e,t){let i=S.EMPTY_NODE;const s=st(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(M,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(t){const r=Me(n.visibleWrites,e);return t.forEachChild(M,(o,l)=>{const a=Et(Me(r,new L(o)),l);i=i.updateImmediateChild(o,a)}),pr(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}return pr(Me(n.visibleWrites,e)).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}(n.writeTree,n.treePath,e)}function yr(n,e,t,i){return function Zl(n,e,t,i,s){(0,u.hu)(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=V(e,t);if(Hi(n.visibleWrites,r))return null;{const o=Me(n.visibleWrites,r);return Qi(o)?s.getChild(t):Et(o,s.getChild(t))}}(n.writeTree,n.treePath,e,t,i)}function Gn(n,e){return function Xl(n,e){return st(n.visibleWrites,e)}(n.writeTree,V(n.treePath,e))}function Yi(n,e,t){return function ql(n,e,t,i){const s=V(e,t),r=st(n.visibleWrites,s);return null!=r?r:i.isCompleteForChild(t)?Et(Me(n.visibleWrites,s),i.getNode().getImmediateChild(t)):null}(n.writeTree,n.treePath,e,t)}function Cr(n,e){return Er(V(n.treePath,e),n.writeTree)}function Er(n,e){return{treePath:n,writeTree:e}}class na{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;(0,u.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,u.hu)(".priority"!==i,"Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const r=s.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(i,Gt(i,e.snapshotNode,s.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(i);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(i,Vt(i,s.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(i,vt(i,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==r)throw(0,u.g5)("Illegal combination of changes: "+e+" occurred after "+s);this.changeMap.set(i,Gt(i,e.snapshotNode,s.oldSnap))}}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}const wr=new class ia{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}};class ji{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=null!=this.optCompleteServerCache_?new Fe(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Yi(this.writes_,e,i)}}getChildAfterChild(e,t,i){const s=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:it(this.viewCache_),r=function ta(n,e,t,i,s,r){return function Jl(n,e,t,i,s,r,o){let l;const a=Me(n.visibleWrites,e),c=st(a,O());if(null!=c)l=c;else{if(null==t)return[];l=Et(a,t)}if(l=l.withIndex(o),l.isEmpty()||l.isLeafNode())return[];{const f=[],g=o.getCompare(),m=r?l.getReverseIteratorFrom(i,o):l.getIteratorFrom(i,o);let C=m.getNext();for(;C&&f.length<s;)0!==g(C,i)&&f.push(C),C=m.getNext();return f}}(n.writeTree,n.treePath,e,t,i,s,r)}(this.writes_,s,t,1,i,e);return 0===r.length?null:r[0]}}function Ir(n,e,t,i,s,r){const o=e.eventCache;if(null!=Gn(i,t))return e;{let l,a;if(b(t))if((0,u.hu)(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=it(e),g=Ki(i,c instanceof S?c:S.EMPTY_NODE);l=n.filter.updateFullNode(e.eventCache.getNode(),g,r)}else{const c=Vn(i,it(e));l=n.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{const c=R(t);if(".priority"===c){(0,u.hu)(1===Le(t),"Can't have a priority with additional path components");const f=o.getNode();a=e.serverCache.getNode();const g=yr(i,t,f,a);l=null!=g?n.filter.updatePriority(f,g):o.getNode()}else{const f=F(t);let g;if(o.isCompleteForChild(c)){a=e.serverCache.getNode();const m=yr(i,t,o.getNode(),a);g=null!=m?o.getNode().getImmediateChild(c).updateChild(f,m):o.getNode().getImmediateChild(c)}else g=Yi(i,c,e.serverCache);l=null!=g?n.filter.updateChild(o.getNode(),c,g,f,s,r):o.getNode()}}return Yt(e,l,o.isFullyInitialized()||b(t),n.filter.filtersNodes())}}function Hn(n,e,t,i,s,r,o,l){const a=e.serverCache;let c;const f=o?n.filter:n.filter.getIndexedFilter();if(b(t))c=f.updateFullNode(a.getNode(),i,null);else if(f.filtersNodes()&&!a.isFiltered()){const C=a.getNode().updateChild(t,i);c=f.updateFullNode(a.getNode(),C,null)}else{const C=R(t);if(!a.isCompleteForPath(t)&&Le(t)>1)return e;const E=F(t),G=a.getNode().getImmediateChild(C).updateChild(E,i);c=".priority"===C?f.updatePriority(a.getNode(),G):f.updateChild(a.getNode(),C,G,E,wr,null)}const g=fr(e,c,a.isFullyInitialized()||b(t),f.filtersNodes());return Ir(n,g,t,s,new ji(s,g,r),l)}function zi(n,e,t,i,s,r,o){const l=e.eventCache;let a,c;const f=new ji(s,e,r);if(b(t))c=n.filter.updateFullNode(e.eventCache.getNode(),i,o),a=Yt(e,c,!0,n.filter.filtersNodes());else{const g=R(t);if(".priority"===g)c=n.filter.updatePriority(e.eventCache.getNode(),i),a=Yt(e,c,l.isFullyInitialized(),l.isFiltered());else{const m=F(t),C=l.getNode().getImmediateChild(g);let E;if(b(m))E=i;else{const N=f.getCompleteChild(g);E=null!=N?".priority"===Ti(m)&&N.getChild(Js(m)).isEmpty()?N:N.updateChild(m,i):S.EMPTY_NODE}a=C.equals(E)?e:Yt(e,n.filter.updateChild(l.getNode(),g,E,m,f,o),l.isFullyInitialized(),n.filter.filtersNodes())}}return a}function Sr(n,e){return n.eventCache.isCompleteForChild(e)}function Tr(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function $i(n,e,t,i,s,r,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c,a=e;c=b(t)?i:new W(null).setTree(t,i);const f=e.serverCache.getNode();return c.children.inorderTraversal((g,m)=>{if(f.hasChild(g)){const E=Tr(0,e.serverCache.getNode().getImmediateChild(g),m);a=Hn(n,a,new L(g),E,s,r,o,l)}}),c.children.inorderTraversal((g,m)=>{const C=!e.serverCache.isCompleteForChild(g)&&null===m.value;if(!f.hasChild(g)&&!C){const N=Tr(0,e.serverCache.getNode().getImmediateChild(g),m);a=Hn(n,a,new L(g),N,s,r,o,l)}}),a}class da{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new Di(i.getIndex()),r=function Rl(n){return n.loadsAllData()?new Di(n.getIndex()):n.hasLimit()?new Tl(n):new Ht(n)}(i);this.processor_=function sa(n){return{filter:n}}(r);const o=t.serverCache,l=t.eventCache,a=s.updateFullNode(S.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(S.EMPTY_NODE,l.getNode(),null),f=new Fe(a,o.isFullyInitialized(),s.filtersNodes()),g=new Fe(c,l.isFullyInitialized(),r.filtersNodes());this.viewCache_=Wn(g,f),this.eventGenerator_=new Ml(this.query_)}get query(){return this.query_}}function pa(n,e){const t=it(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!b(e)&&!t.getImmediateChild(R(e)).isEmpty())?t.getChild(e):null}function Rr(n){return 0===n.eventRegistrations_.length}function br(n,e,t){const i=[];if(t){(0,u.hu)(null==e,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(o.matches(e)){if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}else s.push(o)}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function Nr(n,e,t,i){e.type===Re.MERGE&&null!==e.source.queryId&&((0,u.hu)(it(n.viewCache_),"We should always have a full cache before handling merges"),(0,u.hu)(Un(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,r=function oa(n,e,t,i,s){const r=new na;let o,l;if(t.type===Re.OVERWRITE){const c=t;c.source.fromUser?o=zi(n,e,c.path,c.snap,i,s,r):((0,u.hu)(c.source.fromServer,"Unknown source."),l=c.source.tagged||e.serverCache.isFiltered()&&!b(c.path),o=Hn(n,e,c.path,c.snap,i,s,l,r))}else if(t.type===Re.MERGE){const c=t;c.source.fromUser?o=function aa(n,e,t,i,s,r,o){let l=e;return i.foreach((a,c)=>{const f=V(t,a);Sr(e,R(f))&&(l=zi(n,l,f,c,s,r,o))}),i.foreach((a,c)=>{const f=V(t,a);Sr(e,R(f))||(l=zi(n,l,f,c,s,r,o))}),l}(n,e,c.path,c.children,i,s,r):((0,u.hu)(c.source.fromServer,"Unknown source."),l=c.source.tagged||e.serverCache.isFiltered(),o=$i(n,e,c.path,c.children,i,s,l,r))}else if(t.type===Re.ACK_USER_WRITE){const c=t;o=c.revert?function ha(n,e,t,i,s,r){let o;if(null!=Gn(i,t))return e;{const l=new ji(i,e,s),a=e.eventCache.getNode();let c;if(b(t)||".priority"===R(t)){let f;if(e.serverCache.isFullyInitialized())f=Vn(i,it(e));else{const g=e.serverCache.getNode();(0,u.hu)(g instanceof S,"serverChildren would be complete if leaf node"),f=Ki(i,g)}c=n.filter.updateFullNode(a,f,r)}else{const f=R(t);let g=Yi(i,f,e.serverCache);null==g&&e.serverCache.isCompleteForChild(f)&&(g=a.getImmediateChild(f)),c=null!=g?n.filter.updateChild(a,f,g,F(t),l,r):e.eventCache.getNode().hasChild(f)?n.filter.updateChild(a,f,S.EMPTY_NODE,F(t),l,r):a,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Vn(i,it(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||null!=Gn(i,O()),Yt(e,c,o,n.filter.filtersNodes())}}(n,e,c.path,i,s,r):function ua(n,e,t,i,s,r,o){if(null!=Gn(s,t))return e;const l=e.serverCache.isFiltered(),a=e.serverCache;if(null!=i.value){if(b(t)&&a.isFullyInitialized()||a.isCompleteForPath(t))return Hn(n,e,t,a.getNode().getChild(t),s,r,l,o);if(b(t)){let c=new W(null);return a.getNode().forEachChild(Te,(f,g)=>{c=c.set(new L(f),g)}),$i(n,e,t,c,s,r,l,o)}return e}{let c=new W(null);return i.foreach((f,g)=>{const m=V(t,f);a.isCompleteForPath(m)&&(c=c.set(f,a.getNode().getChild(m)))}),$i(n,e,t,c,s,r,l,o)}}(n,e,c.path,c.affectedTree,i,s,r)}else{if(t.type!==Re.LISTEN_COMPLETE)throw(0,u.g5)("Unknown operation type: "+t.type);o=function ca(n,e,t,i,s){const r=e.serverCache;return Ir(n,fr(e,r.getNode(),r.isFullyInitialized()||b(t),r.isFiltered()),t,i,wr,s)}(n,e,t.path,i,r)}const a=r.getChanges();return function la(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Un(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&t.push(ur(Un(e)))}}(e,o,a),{viewCache:o,changes:a}}(n.processor_,s,e,t,i);return function ra(n,e){(0,u.hu)(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),(0,u.hu)(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}(n.processor_,r.viewCache),(0,u.hu)(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,Ar(n,r.changes,r.viewCache.eventCache.getNode(),null)}function Ar(n,e,t,i){return function Wl(n,e,t,i){const s=[],r=[];return e.forEach(o=>{"child_changed"===o.type&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(function Sl(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}(o.childName,o.snapshotNode))}),Kt(n,s,"child_removed",e,i,t),Kt(n,s,"child_added",e,i,t),Kt(n,s,"child_moved",r,i,t),Kt(n,s,"child_changed",e,i,t),Kt(n,s,"value",e,i,t),s}(n.eventGenerator_,e,t,i?[i]:n.eventRegistrations_)}let Qn,Yn;class Pr{constructor(){this.views=new Map}}function Zi(n,e,t,i){const s=e.source.queryId;if(null!==s){const r=n.views.get(s);return(0,u.hu)(null!=r,"SyncTree gave us an op for an invalid query."),Nr(r,e,t,i)}{let r=[];for(const o of n.views.values())r=r.concat(Nr(o,e,t,i));return r}}function kr(n,e,t,i,s){const o=n.views.get(e._queryIdentifier);if(!o){let l=Vn(t,s?i:null),a=!1;l?a=!0:i instanceof S?(l=Ki(t,i),a=!1):(l=S.EMPTY_NODE,a=!1);const c=Wn(new Fe(l,a,!1),new Fe(i,s,!1));return new da(e,c)}return o}function xr(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function We(n,e){let t=null;for(const i of n.views.values())t=t||pa(i,e);return t}function Dr(n,e){return e._queryParams.loadsAllData()?Kn(n):n.views.get(e._queryIdentifier)}function Or(n,e){return null!=Dr(n,e)}function Ue(n){return null!=Kn(n)}function Kn(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Ta=1;class Lr{constructor(e){this.listenProvider_=e,this.syncPointTree_=new W(null),this.pendingWriteTree_=function ea(){return{visibleWrites:Ce.empty(),allWrites:[],lastWriteId:-1}}(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function qi(n,e,t,i,s){return function Gl(n,e,t,i,s){(0,u.hu)(i>n.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=jt(n.visibleWrites,e,t)),n.lastWriteId=i}(n.pendingWriteTree_,e,t,i,s),s?wt(n,new nt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,t)):[]}function Be(n,e,t=!1){const i=function Ql(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}(n.pendingWriteTree_,e);if(function Kl(n,e){const t=n.allWrites.findIndex(l=>l.writeId===e);(0,u.hu)(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const l=n.allWrites[o];l.visible&&(o>=t&&Yl(l,i.path)?s=!1:de(i.path,l.path)&&(r=!0)),o--}return!!s&&(r?(function jl(n){n.visibleWrites=mr(n.allWrites,zl,O()),n.lastWriteId=n.allWrites.length>0?n.allWrites[n.allWrites.length-1].writeId:-1}(n),!0):(i.snap?n.visibleWrites=_r(n.visibleWrites,i.path):Y(i.children,a=>{n.visibleWrites=_r(n.visibleWrites,V(i.path,a))}),!0))}(n.pendingWriteTree_,e)){let r=new W(null);return null!=i.snap?r=r.set(O(),!0):Y(i.children,o=>{r=r.set(new L(o),!0)}),wt(n,new Mn(i.path,r,t))}return[]}function zt(n,e,t){return wt(n,new nt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,t))}function jn(n,e,t,i,s=!1){const r=e._path,o=n.syncPointTree_.get(r);let l=[];if(o&&("default"===e._queryIdentifier||Or(o,e))){const a=function wa(n,e,t,i){const s=e._queryIdentifier,r=[];let o=[];const l=Ue(n);if("default"===s)for(const[a,c]of n.views.entries())o=o.concat(br(c,t,i)),Rr(c)&&(n.views.delete(a),c.query._queryParams.loadsAllData()||r.push(c.query));else{const a=n.views.get(s);a&&(o=o.concat(br(a,t,i)),Rr(a)&&(n.views.delete(s),a.query._queryParams.loadsAllData()||r.push(a.query)))}return l&&!Ue(n)&&r.push(new(function ya(){return(0,u.hu)(Qn,"Reference.ts has not been loaded"),Qn}())(e._repo,e._path)),{removed:r,events:o}}(o,e,t,i);(function Ca(n){return 0===n.views.size})(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const c=a.removed;if(l=a.events,!s){const f=-1!==c.findIndex(m=>m._queryParams.loadsAllData()),g=n.syncPointTree_.findOnPath(r,(m,C)=>Ue(C));if(f&&!g){const m=n.syncPointTree_.subtree(r);if(!m.isEmpty()){const C=function xa(n){return n.fold((e,t,i)=>{if(t&&Ue(t))return[Kn(t)];{let s=[];return t&&(s=xr(t)),Y(i,(r,o)=>{s=s.concat(o)}),s}})}(m);for(let E=0;E<C.length;++E){const N=C[E],G=N.query,ee=Ur(n,N);n.listenProvider_.startListening(Zt(G),$t(n,G),ee.hashFn,ee.onComplete)}}}!g&&c.length>0&&!i&&(f?n.listenProvider_.stopListening(Zt(e),null):c.forEach(m=>{const C=n.queryToTagMap.get($n(m));n.listenProvider_.stopListening(Zt(m),C)}))}!function Da(n,e){for(let t=0;t<e.length;++t){const i=e[t];if(!i._queryParams.loadsAllData()){const s=$n(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}(n,c)}return l}function Fr(n,e,t,i){const s=Ji(n,i);if(null!=s){const r=es(s),o=r.path,l=r.queryId,a=J(o,e);return ts(n,o,new nt(Bi(l),a,t))}return[]}function Xi(n,e,t,i=!1){const s=e._path;let r=null,o=!1;n.syncPointTree_.foreachOnPath(s,(m,C)=>{const E=J(m,s);r=r||We(C,E),o=o||Ue(C)});let a,l=n.syncPointTree_.get(s);l?(o=o||Ue(l),r=r||We(l,O())):(l=new Pr,n.syncPointTree_=n.syncPointTree_.set(s,l)),null!=r?a=!0:(a=!1,r=S.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((C,E)=>{const N=We(E,O());N&&(r=r.updateImmediateChild(C,N))}));const c=Or(l,e);if(!c&&!e._queryParams.loadsAllData()){const m=$n(e);(0,u.hu)(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");const C=function Oa(){return Ta++}();n.queryToTagMap.set(m,C),n.tagToQueryMap.set(C,m)}let g=function Ea(n,e,t,i,s,r){const o=kr(n,e,i,s,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),function ga(n,e){n.eventRegistrations_.push(e)}(o,t),function ma(n,e){const t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(M,(r,o)=>{i.push(vt(r,o))}),t.isFullyInitialized()&&i.push(ur(t.getNode())),Ar(n,i,t.getNode(),e)}(o,t)}(l,e,t,Bn(n.pendingWriteTree_,s),r,a);if(!c&&!o&&!i){const m=Dr(l,e);g=g.concat(function La(n,e,t){const i=e._path,s=$t(n,e),r=Ur(n,t),o=n.listenProvider_.startListening(Zt(e),s,r.hashFn,r.onComplete),l=n.syncPointTree_.subtree(i);if(s)(0,u.hu)(!Ue(l.value),"If we're adding a query, it shouldn't be shadowed");else{const a=l.fold((c,f,g)=>{if(!b(c)&&f&&Ue(f))return[Kn(f).query];{let m=[];return f&&(m=m.concat(xr(f).map(C=>C.query))),Y(g,(C,E)=>{m=m.concat(E)}),m}});for(let c=0;c<a.length;++c){const f=a[c];n.listenProvider_.stopListening(Zt(f),$t(n,f))}}return o}(n,e,m))}return g}function zn(n,e,t){const s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,l)=>{const c=We(l,J(o,e));if(c)return c});return vr(s,e,r,t,!0)}function wt(n,e){return Mr(e,n.syncPointTree_,null,Bn(n.pendingWriteTree_,O()))}function Mr(n,e,t,i){if(b(n.path))return Wr(n,e,t,i);{const s=e.get(O());null==t&&null!=s&&(t=We(s,O()));let r=[];const o=R(n.path),l=n.operationForChild(o),a=e.children.get(o);if(a&&l){const c=t?t.getImmediateChild(o):null,f=Cr(i,o);r=r.concat(Mr(l,a,c,f))}return s&&(r=r.concat(Zi(s,n,i,t))),r}}function Wr(n,e,t,i){const s=e.get(O());null==t&&null!=s&&(t=We(s,O()));let r=[];return e.children.inorderTraversal((o,l)=>{const a=t?t.getImmediateChild(o):null,c=Cr(i,o),f=n.operationForChild(o);f&&(r=r.concat(Wr(f,l,a,c)))}),s&&(r=r.concat(Zi(s,n,i,t))),r}function Ur(n,e){const t=e.query,i=$t(n,t);return{hashFn:()=>(function fa(n){return n.viewCache_.serverCache.getNode()}(e)||S.EMPTY_NODE).hash(),onComplete:s=>{if("ok"===s)return i?function Aa(n,e,t){const i=Ji(n,t);if(i){const s=es(i),r=s.path,o=s.queryId,l=J(r,e);return ts(n,r,new Qt(Bi(o),l))}return[]}(n,t._path,i):function Na(n,e){return wt(n,new Qt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e))}(n,t._path);{const r=function h(n,e){let t="Unknown Error";"too_big"===n?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===n?t="Client doesn't have permission to access the desired data.":"unavailable"===n&&(t="The service is unavailable");const i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}(s,t);return jn(n,t,null,r)}}}}function $t(n,e){const t=$n(e);return n.queryToTagMap.get(t)}function $n(n){return n._path.toString()+"$"+n._queryIdentifier}function Ji(n,e){return n.tagToQueryMap.get(e)}function es(n){const e=n.indexOf("$");return(0,u.hu)(-1!==e&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new L(n.substr(0,e))}}function ts(n,e,t){const i=n.syncPointTree_.get(e);return(0,u.hu)(i,"Missing sync point for query tag that we're tracking"),Zi(i,t,Bn(n.pendingWriteTree_,e),null)}function Zt(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(function Sa(){return(0,u.hu)(Yn,"Reference.ts has not been loaded"),Yn}())(n._repo,n._path):n}class ns{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new ns(t)}node(){return this.node_}}class is{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=V(this.path_,e);return new is(this.syncTree_,t)}node(){return zn(this.syncTree_,this.path_)}}const Fa=function(n){return(n=n||{}).timestamp=n.timestamp||(new Date).getTime(),n},Br=function(n,e,t){return n&&"object"==typeof n?((0,u.hu)(".sv"in n,"Unexpected leaf node or priority contents"),"string"==typeof n[".sv"]?Ma(n[".sv"],e,t):"object"==typeof n[".sv"]?Wa(n[".sv"],e):void(0,u.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2))):n},Ma=function(n,e,t){if("timestamp"===n)return t.timestamp;(0,u.hu)(!1,"Unexpected server value: "+n)},Wa=function(n,e,t){n.hasOwnProperty("increment")||(0,u.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;"number"!=typeof i&&(0,u.hu)(!1,"Unexpected increment value: "+i);const s=e.node();if((0,u.hu)(null!==s&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return"number"!=typeof o?i:o+i},Vr=function(n,e,t,i){return rs(e,new is(t,n),i)},ss=function(n,e,t){return rs(n,new ns(e),t)};function rs(n,e,t){const i=n.getPriority().val(),s=Br(i,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,l=Br(o.getValue(),e,t);return l!==o.getValue()||s!==o.getPriority().val()?new gt(l,H(s)):n}{const o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new gt(s))),o.forEachChild(M,(l,a)=>{const c=rs(a,e.getImmediateChild(l),t);c!==a&&(r=r.updateImmediateChild(l,c))}),r}}class os{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function Zn(n,e){let t=e instanceof L?e:new L(e),i=n,s=R(t);for(;null!==s;){const r=(0,u.DV)(i.node.children,s)||{children:{},childCount:0};i=new os(s,i,r),t=F(t),s=R(t)}return i}function rt(n){return n.node.value}function ls(n,e){n.node.value=e,as(n)}function Gr(n){return n.node.childCount>0}function qn(n,e){Y(n.node.children,(t,i)=>{e(new os(t,n,i))})}function Hr(n,e,t,i){t&&!i&&e(n),qn(n,s=>{Hr(s,e,!0,i)}),t&&i&&e(n)}function qt(n){return new L(null===n.parent?n.name:qt(n.parent)+"/"+n.name)}function as(n){null!==n.parent&&function Va(n,e,t){const i=function Ua(n){return void 0===rt(n)&&!Gr(n)}(t),s=(0,u.r3)(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,as(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,as(n))}(n.parent,n.name,n)}const Ga=/[\[\].#$\/\u0000-\u001F\u007F]/,Ha=/[\[\].#$\u0000-\u001F\u007F]/,us=10485760,Xn=function(n){return"string"==typeof n&&0!==n.length&&!Ga.test(n)},Qr=function(n){return"string"==typeof n&&0!==n.length&&!Ha.test(n)},Xt=function(n){return null===n||"string"==typeof n||"number"==typeof n&&!_t(n)||n&&"object"==typeof n&&(0,u.r3)(n,".sv")},be=function(n,e,t,i){i&&void 0===e||Jt((0,u.gK)(n,"value"),e,t)},Jt=function(n,e,t){const i=t instanceof L?new ol(t,n):t;if(void 0===e)throw new Error(n+"contains undefined "+et(i));if("function"==typeof e)throw new Error(n+"contains a function "+et(i)+" with contents = "+e.toString());if(_t(e))throw new Error(n+"contains "+e.toString()+" "+et(i));if("string"==typeof e&&e.length>us/3&&(0,u.ug)(e)>us)throw new Error(n+"contains a string greater than "+us+" utf8 bytes "+et(i)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let s=!1,r=!1;if(Y(e,(o,l)=>{if(".value"===o)s=!0;else if(".priority"!==o&&".sv"!==o&&(r=!0,!Xn(o)))throw new Error(n+" contains an invalid key ("+o+") "+et(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function ll(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=(0,u.ug)(e),er(n)})(i,o),Jt(n,l,i),function al(n){const e=n.parts_.pop();n.byteLength_-=(0,u.ug)(e),n.parts_.length>0&&(n.byteLength_-=1)}(i)}),s&&r)throw new Error(n+' contains ".value" child '+et(i)+" in addition to actual children.")}},Kr=function(n,e,t,i){if(i&&void 0===e)return;const s=(0,u.gK)(n,"values");if(!e||"object"!=typeof e||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const r=[];Y(e,(o,l)=>{const a=new L(o);if(Jt(s,l,V(t,a)),".priority"===Ti(a)&&!Xt(l))throw new Error(s+"contains an invalid value for '"+a.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(a)}),function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];const r=Mt(i);for(let o=0;o<r.length;o++)if((".priority"!==r[o]||o!==r.length-1)&&!Xn(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}e.sort(rl);let s=null;for(t=0;t<e.length;t++){if(i=e[t],null!==s&&de(s,i))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}}(s,r)},cs=function(n,e,t){if(!t||void 0!==e){if(_t(e))throw new Error((0,u.gK)(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Xt(e))throw new Error((0,u.gK)(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},en=function(n,e,t,i){if(!(i&&void 0===t||Xn(t)))throw new Error((0,u.gK)(n,e)+'was an invalid key = "'+t+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},tn=function(n,e,t,i){if(!(i&&void 0===t||Qr(t)))throw new Error((0,u.gK)(n,e)+'was an invalid path = "'+t+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Ya=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),tn(n,e,t,i)},fe=function(n,e){if(".info"===R(e))throw new Error(n+" failed = Can't modify data under /.info/")},Yr=function(n,e){const t=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!Xn(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==t.length&&!function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Qr(n)}(t))throw new Error((0,u.gK)(n,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class ja{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Jn(n,e){let t=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();null!==t&&!Ri(r,t.path)&&(n.eventLists_.push(t),t=null),null===t&&(t={events:[],path:r}),t.events.push(s)}t&&n.eventLists_.push(t)}function jr(n,e,t){Jn(n,t),zr(n,i=>Ri(i,e))}function re(n,e,t){Jn(n,t),zr(n,i=>de(i,e)||de(e,i))}function zr(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const s=n.eventLists_[i];s&&(e(s.path)?(za(n.eventLists_[i]),n.eventLists_[i]=null):t=!1)}t&&(n.eventLists_=[]),n.recursionDepth_--}function za(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(null!==t){n.events[e]=null;const i=t.getEventRunner();q&&Q("event: "+t.toString()),x(i)}}}const $r="repo_interrupt",$a=25;class Za{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ja,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Fn(),this.transactionQueueTree_=new os,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Zr(n){const t=n.infoData_.getNode(new L(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function nn(n){return Fa({timestamp:Zr(n)})}function qr(n,e,t,i,s){n.dataUpdateCount++;const r=new L(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(i){const a=(0,u.UI)(t,c=>H(c));o=function Pa(n,e,t,i){const s=Ji(n,i);if(s){const r=es(s),o=r.path,l=r.queryId,a=J(o,e),c=W.fromObject(t);return ts(n,o,new Ct(Bi(l),a,c))}return[]}(n.serverSyncTree_,r,a,s)}else{const a=H(t);o=Fr(n.serverSyncTree_,r,a,s)}else if(i){const a=(0,u.UI)(t,c=>H(c));o=function ba(n,e,t){const i=W.fromObject(t);return wt(n,new Ct({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,i))}(n.serverSyncTree_,r,a)}else{const a=H(t);o=zt(n.serverSyncTree_,r,a)}let l=r;o.length>0&&(l=St(n,r)),re(n.eventQueue_,l,o)}function Xr(n,e){hs(n,"connected",e),!1===e&&function tu(n){It(n,"onDisconnectEvents");const e=nn(n),t=Fn();Mi(n.onDisconnect_,O(),(s,r)=>{const o=Vr(s,r,n.serverSyncTree_,e);yt(t,s,o)});let i=[];Mi(t,O(),(s,r)=>{i=i.concat(zt(n.serverSyncTree_,s,r));const o=ps(n,s);St(n,o)}),n.onDisconnect_=Fn(),re(n.eventQueue_,O(),i)}(n)}function hs(n,e,t){const i=new L("/.info/"+e),s=H(t);n.infoData_.updateSnapshot(i,s);const r=zt(n.infoSyncTree_,i,s);re(n.eventQueue_,i,r)}function ei(n){return n.nextWriteId_++}function ds(n,e,t,i,s){It(n,"set",{path:e.toString(),value:t,priority:i});const r=nn(n),o=H(t,i),l=zn(n.serverSyncTree_,e),a=ss(o,l,r),c=ei(n),f=qi(n.serverSyncTree_,e,a,c,!0);Jn(n.eventQueue_,f),n.server_.put(e.toString(),o.val(!0),(m,C)=>{const E="ok"===m;E||K("set at "+e+" failed: "+m);const N=Be(n.serverSyncTree_,c,!E);re(n.eventQueue_,e,N),Ve(0,s,m,C)});const g=ps(n,e);St(n,g),re(n.eventQueue_,g,[])}function nu(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,s)=>{"ok"===i&&Fi(n.onDisconnect_,e),Ve(0,t,i,s)})}function Jr(n,e,t,i){const s=H(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(r,o)=>{"ok"===r&&yt(n.onDisconnect_,e,s),Ve(0,i,r,o)})}function fs(n,e,t){let i;i=".info"===R(e._path)?jn(n.infoSyncTree_,e,t):jn(n.serverSyncTree_,e,t),jr(n.eventQueue_,e._path,i)}function eo(n){n.persistentConnection_&&n.persistentConnection_.interrupt($r)}function It(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Q(t,...e)}function Ve(n,e,t,i){e&&x(()=>{if("ok"===t)e(null);else{const s=(t||"error").toUpperCase();let r=s;i&&(r+=": "+i);const o=new Error(r);o.code=s,e(o)}})}function _s(n,e,t){return zn(n.serverSyncTree_,e,t)||S.EMPTY_NODE}function ti(n,e=n.transactionQueueTree_){if(e||ni(n,e),rt(e)){const t=no(n,e);(0,u.hu)(t.length>0,"Sending zero length transaction queue"),t.every(s=>0===s.status)&&function au(n,e,t){const i=t.map(c=>c.currentWriteId),s=_s(n,e,i);let r=s;const o=s.hash();for(let c=0;c<t.length;c++){const f=t[c];(0,u.hu)(0===f.status,"tryToSendTransactionQueue_: items in queue should all be run."),f.status=1,f.retryCount++;const g=J(e,f.path);r=r.updateChild(g,f.currentOutputSnapshotRaw)}const l=r.val(!0),a=e;n.server_.put(a.toString(),l,c=>{It(n,"transaction put response",{path:a.toString(),status:c});let f=[];if("ok"===c){const g=[];for(let m=0;m<t.length;m++)t[m].status=2,f=f.concat(Be(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&g.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();ni(n,Zn(n.transactionQueueTree_,e)),ti(n,n.transactionQueueTree_),re(n.eventQueue_,e,f);for(let m=0;m<g.length;m++)x(g[m])}else{if("datastale"===c)for(let g=0;g<t.length;g++)t[g].status=3===t[g].status?4:0;else{K("transaction at "+a.toString()+" failed: "+c);for(let g=0;g<t.length;g++)t[g].status=4,t[g].abortReason=c}St(n,e)}},o)}(n,qt(e),t)}else Gr(e)&&qn(e,t=>{ti(n,t)})}function St(n,e){const t=to(n,e),i=qt(t);return function uu(n,e,t){if(0===e.length)return;const i=[];let s=[];const o=e.filter(l=>0===l.status).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const a=e[l],c=J(t,a.path);let g,f=!1;if((0,u.hu)(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)f=!0,g=a.abortReason,s=s.concat(Be(n.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=$a)f=!0,g="maxretry",s=s.concat(Be(n.serverSyncTree_,a.currentWriteId,!0));else{const m=_s(n,a.path,o);a.currentInputSnapshot=m;const C=e[l].update(m.val());if(void 0!==C){Jt("transaction failed: Data returned ",C,a.path);let E=H(C);"object"==typeof C&&null!=C&&(0,u.r3)(C,".priority")||(E=E.updatePriority(m.getPriority()));const G=a.currentWriteId,ee=nn(n),le=ss(E,m,ee);a.currentOutputSnapshotRaw=E,a.currentOutputSnapshotResolved=le,a.currentWriteId=ei(n),o.splice(o.indexOf(G),1),s=s.concat(qi(n.serverSyncTree_,a.path,le,a.currentWriteId,a.applyLocally)),s=s.concat(Be(n.serverSyncTree_,G,!0))}else f=!0,g="nodata",s=s.concat(Be(n.serverSyncTree_,a.currentWriteId,!0))}re(n.eventQueue_,t,s),s=[],f&&(e[l].status=2,setTimeout(e[l].unwatcher,Math.floor(0)),e[l].onComplete&&i.push("nodata"===g?()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot):()=>e[l].onComplete(new Error(g),!1,null)))}ni(n,n.transactionQueueTree_);for(let l=0;l<i.length;l++)x(i[l]);ti(n,n.transactionQueueTree_)}(n,no(n,t),i),i}function to(n,e){let t,i=n.transactionQueueTree_;for(t=R(e);null!==t&&void 0===rt(i);)i=Zn(i,t),t=R(e=F(e));return i}function no(n,e){const t=[];return io(n,e,t),t.sort((i,s)=>i.order-s.order),t}function io(n,e,t){const i=rt(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);qn(e,s=>{io(n,s,t)})}function ni(n,e){const t=rt(e);if(t){let i=0;for(let s=0;s<t.length;s++)2!==t[s].status&&(t[i]=t[s],i++);t.length=i,ls(e,t.length>0?t:void 0)}qn(e,i=>{ni(n,i)})}function ps(n,e){const t=qt(to(n,e)),i=Zn(n.transactionQueueTree_,e);return function Ba(n,e,t){let i=t?n:n.parent;for(;null!==i;){if(e(i))return!0;i=i.parent}}(i,s=>{gs(n,s)}),gs(n,i),Hr(i,s=>{gs(n,s)}),t}function gs(n,e){const t=rt(e);if(t){const i=[];let s=[],r=-1;for(let o=0;o<t.length;o++)3===t[o].status||(1===t[o].status?((0,u.hu)(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):((0,u.hu)(0===t[o].status,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(Be(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));-1===r?ls(e,void 0):t.length=r+1,re(n.eventQueue_,qt(e),s);for(let o=0;o<i.length;o++)x(i[o])}}const ms=function(n,e){const t=du(n),i=t.namespace;return"firebase.com"===t.domain&&U(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||"undefined"===i)&&"localhost"!==t.domain&&U("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||typeof window<"u"&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&K("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new yi(t.host,t.secure,i,"ws"===t.scheme||"wss"===t.scheme,e,"",i!==t.subdomain),path:new L(t.pathString)}},du=function(n){let e="",t="",i="",s="",r="",o=!0,l="https",a=443;if("string"==typeof n){let c=n.indexOf("//");c>=0&&(l=n.substring(0,c-1),n=n.substring(c+2));let f=n.indexOf("/");-1===f&&(f=n.length);let g=n.indexOf("?");-1===g&&(g=n.length),e=n.substring(0,Math.min(f,g)),f<g&&(s=function cu(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}(n.substring(f,g)));const m=function hu(n){const e={};"?"===n.charAt(0)&&(n=n.substring(1));for(const t of n.split("&")){if(0===t.length)continue;const i=t.split("=");2===i.length?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):K(`Invalid query segment '${t}' in query '${n}'`)}return e}(n.substring(Math.min(n.length,g)));c=e.indexOf(":"),c>=0?(o="https"===l||"wss"===l,a=parseInt(e.substring(c+1),10)):c=e.length;const C=e.slice(0,c);if("localhost"===C.toLowerCase())t="localhost";else if(C.split(".").length<=2)t=C;else{const E=e.indexOf(".");i=e.substring(0,E).toLowerCase(),t=e.substring(E+1),r=i}"ns"in m&&(r=m.ns)}return{host:e,port:a,domain:t,subdomain:i,secure:o,scheme:l,pathString:s,namespace:r}},so="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",fu=function(){let n=0;const e=[];return function(t){const i=t===n;let s;n=t;const r=new Array(8);for(s=7;s>=0;s--)r[s]=so.charAt(t%64),t=Math.floor(t/64);(0,u.hu)(0===t,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&63===e[s];s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(64*Math.random());for(s=0;s<12;s++)o+=so.charAt(e[s]);return(0,u.hu)(20===o.length,"nextPushId: Length should be 20."),o}}();class ro{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,u.Wl)(this.snapshot.exportVal())}}class oo{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class vs{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return(0,u.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class lo{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new u.BH;return nu(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){fe("OnDisconnect.remove",this._path);const e=new u.BH;return Jr(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){fe("OnDisconnect.set",this._path),be("OnDisconnect.set",e,this._path,!1);const t=new u.BH;return Jr(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){fe("OnDisconnect.setWithPriority",this._path),be("OnDisconnect.setWithPriority",e,this._path,!1),cs("OnDisconnect.setWithPriority",t,!1);const i=new u.BH;return function iu(n,e,t,i,s){const r=H(t,i);n.server_.onDisconnectPut(e.toString(),r.val(!0),(o,l)=>{"ok"===o&&yt(n.onDisconnect_,e,r),Ve(0,s,o,l)})}(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){fe("OnDisconnect.update",this._path),Kr("OnDisconnect.update",e,this._path,!1);const t=new u.BH;return function su(n,e,t,i){if((0,u.xb)(t))return Q("onDisconnect().update() called with empty data.  Don't do anything."),void Ve(0,i,"ok",void 0);n.server_.onDisconnectMerge(e.toString(),t,(s,r)=>{"ok"===s&&Y(t,(o,l)=>{const a=H(l);yt(n.onDisconnect_,V(e,o),a)}),Ve(0,i,s,r)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class se{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return b(this._path)?null:Ti(this._path)}get ref(){return new _e(this._repo,this._path)}get _queryIdentifier(){const e=hr(this._queryParams),t=Ft(e);return"{}"===t?"default":t}get _queryObject(){return hr(this._queryParams)}isEqual(e){if(!((e=(0,u.m9)(e))instanceof se))return!1;const t=this._repo===e._repo,i=Ri(this._path,e._path);return t&&i&&this._queryIdentifier===e._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function sl(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)""!==n.pieces_[t]&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}(this._path)}}function ii(n,e){if(!0===n._orderByCalled)throw new Error(e+": You can't combine multiple orderBy calls.")}function Ge(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Te){const i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==te)throw new Error(i);if("string"!=typeof e)throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==ce)throw new Error(i);if("string"!=typeof t)throw new Error(s)}}else if(n.getIndex()===M){if(null!=e&&!Xt(e)||null!=t&&!Xt(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,u.hu)(n.getIndex()instanceof ki||n.getIndex()===xi,"unknown index type."),null!=e&&"object"==typeof e||null!=t&&"object"==typeof t)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function si(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class _e extends se{constructor(e,t){super(e,t,new Dn,!1)}get parent(){const e=Js(this._path);return null===e?null:new _e(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ot{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new L(e),i=lt(this.ref,e);return new ot(this._node.getChild(t),i,M)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(i,s)=>e(new ot(s,lt(this.ref,i),M)))}hasChild(e){const t=new L(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ao(n,e){return(n=(0,u.m9)(n))._checkNotDeleted("ref"),void 0!==e?lt(n._root,e):n._root}function uo(n,e){(n=(0,u.m9)(n))._checkNotDeleted("refFromURL");const t=ms(e,n._repo.repoInfo_.nodeAdmin);Yr("refFromURL",t);const i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&U("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),ao(n,t.path.toString())}function lt(n,e){return null===R((n=(0,u.m9)(n))._path)?Ya("child","path",e,!1):tn("child","path",e,!1),new _e(n._repo,V(n._path,e))}function ys(n,e){n=(0,u.m9)(n),fe("set",n._path),be("set",e,n._path,!1);const t=new u.BH;return ds(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function vu(n,e){Kr("update",e,n._path,!1);const t=new u.BH;return function eu(n,e,t,i){It(n,"update",{path:e.toString(),value:t});let s=!0;const r=nn(n),o={};if(Y(t,(l,a)=>{s=!1,o[l]=Vr(V(e,l),H(a),n.serverSyncTree_,r)}),s)Q("update() called with empty data.  Don't do anything."),Ve(0,i,"ok",void 0);else{const l=ei(n),a=function Ra(n,e,t,i){!function Hl(n,e,t,i){(0,u.hu)(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=Gi(n.visibleWrites,e,t),n.lastWriteId=i}(n.pendingWriteTree_,e,t,i);const s=W.fromObject(t);return wt(n,new Ct({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,s))}(n.serverSyncTree_,e,o,l);Jn(n.eventQueue_,a),n.server_.merge(e.toString(),t,(c,f)=>{const g="ok"===c;g||K("update at "+e+" failed: "+c);const m=Be(n.serverSyncTree_,l,!g),C=m.length>0?St(n,e):e;re(n.eventQueue_,C,m),Ve(0,i,c,f)}),Y(t,c=>{const f=ps(n,V(e,c));St(n,f)}),re(n.eventQueue_,e,[])}}(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function yu(n){n=(0,u.m9)(n);const e=new vs(()=>{}),t=new sn(e);return function Ja(n,e,t){const i=function ka(n,e){const t=e._path;let i=null;n.syncPointTree_.foreachOnPath(t,(c,f)=>{const g=J(c,t);i=i||We(f,g)});let s=n.syncPointTree_.get(t);s?i=i||We(s,O()):(s=new Pr,n.syncPointTree_=n.syncPointTree_.set(t,s));const r=null!=i,o=r?new Fe(i,!0,!1):null;return function _a(n){return Un(n.viewCache_)}(kr(s,e,Bn(n.pendingWriteTree_,e._path),r?o.getNode():S.EMPTY_NODE,r))}(n.serverSyncTree_,e);return null!=i?Promise.resolve(i):n.server_.get(e).then(s=>{const r=H(s).withIndex(e._queryParams.getIndex());let o;if(Xi(n.serverSyncTree_,e,t,!0),e._queryParams.loadsAllData())o=zt(n.serverSyncTree_,e._path,r);else{const l=$t(n.serverSyncTree_,e);o=Fr(n.serverSyncTree_,e._path,r,l)}return re(n.eventQueue_,e._path,o),jn(n.serverSyncTree_,e,t,null,!0),r},s=>(It(n,"get for query "+(0,u.Wl)(e)+" failed: "+s),Promise.reject(new Error(s))))}(n._repo,n,t).then(i=>new ot(i,new _e(n._repo,n._path),n._queryParams.getIndex()))}class sn{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const i=t._queryParams.getIndex();return new ro("value",this,new ot(e.snapshotNode,new _e(t._repo,t._path),i))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new oo(this,e,t):null}matches(e){return e instanceof sn&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class ri{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new oo(this,e,t):null}createEvent(e,t){(0,u.hu)(null!=e.childName,"Child events should have a childName.");const i=lt(new _e(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new ro(e.type,this,new ot(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof ri&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function rn(n,e,t,i,s){let r;if("object"==typeof i&&(r=void 0,s=i),"function"==typeof i&&(r=i),s&&s.onlyOnce){const a=t,c=(f,g)=>{fs(n._repo,n,l),a(f,g)};c.userCallback=t.userCallback,c.context=t.context,t=c}const o=new vs(t,r||void 0),l="value"===e?new sn(o):new ri(e,o);return function ru(n,e,t){let i;i=".info"===R(e._path)?Xi(n.infoSyncTree_,e,t):Xi(n.serverSyncTree_,e,t),jr(n.eventQueue_,e._path,i)}(n._repo,n,l),()=>fs(n._repo,n,l)}function Cs(n,e,t,i){return rn(n,"value",e,t,i)}function co(n,e,t,i){return rn(n,"child_added",e,t,i)}function ho(n,e,t,i){return rn(n,"child_changed",e,t,i)}function fo(n,e,t,i){return rn(n,"child_moved",e,t,i)}function _o(n,e,t,i){return rn(n,"child_removed",e,t,i)}function po(n,e,t){let i=null;const s=t?new vs(t):null;"value"===e?i=new sn(s):e&&(i=new ri(e,s)),fs(n._repo,n,i)}class Ee{}class go extends Ee{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){be("endAt",this._value,e._path,!0);const t=Li(e._queryParams,this._value,this._key);if(si(t),Ge(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new se(e._repo,e._path,t,e._orderByCalled)}}class Eu extends Ee{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){be("endBefore",this._value,e._path,!1);const t=function Pl(n,e,t){let i;return i=Li(n,e,n.index_===Te||t?t:te),i.endBeforeSet_=!0,i}(e._queryParams,this._value,this._key);if(si(t),Ge(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new se(e._repo,e._path,t,e._orderByCalled)}}class mo extends Ee{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){be("startAt",this._value,e._path,!0);const t=Oi(e._queryParams,this._value,this._key);if(si(t),Ge(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new se(e._repo,e._path,t,e._orderByCalled)}}class Su extends Ee{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){be("startAfter",this._value,e._path,!1);const t=function Al(n,e,t){let i;return i=Oi(n,e,n.index_===Te||t?t:ce),i.startAfterSet_=!0,i}(e._queryParams,this._value,this._key);if(si(t),Ge(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new se(e._repo,e._path,t,e._orderByCalled)}}class Ru extends Ee{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new se(e._repo,e._path,function bl(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}(e._queryParams,this._limit),e._orderByCalled)}}class Nu extends Ee{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new se(e._repo,e._path,function Nl(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}(e._queryParams,this._limit),e._orderByCalled)}}class Pu extends Ee{constructor(e){super(),this._path=e}_apply(e){ii(e,"orderByChild");const t=new L(this._path);if(b(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const i=new ki(t),s=On(e._queryParams,i);return Ge(s),new se(e._repo,e._path,s,!0)}}class xu extends Ee{_apply(e){ii(e,"orderByKey");const t=On(e._queryParams,Te);return Ge(t),new se(e._repo,e._path,t,!0)}}class Ou extends Ee{_apply(e){ii(e,"orderByPriority");const t=On(e._queryParams,M);return Ge(t),new se(e._repo,e._path,t,!0)}}class Fu extends Ee{_apply(e){ii(e,"orderByValue");const t=On(e._queryParams,xi);return Ge(t),new se(e._repo,e._path,t,!0)}}class Wu extends Ee{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(be("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new go(this._value,this._key)._apply(new mo(this._value,this._key)._apply(e))}}function we(n,...e){let t=(0,u.m9)(n);for(const i of e)t=i._apply(t);return t}(function va(n){(0,u.hu)(!Qn,"__referenceConstructor has already been defined"),Qn=n})(_e),function Ia(n){(0,u.hu)(!Yn,"__referenceConstructor has already been defined"),Yn=n}(_e);const Es={};function yo(n,e,t,i,s){let r=i||n.options.databaseURL;void 0===r&&(n.options.projectId||U("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Q("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let a,c,o=ms(r,s),l=o.repoInfo;typeof process<"u"&&process.env&&(c=process.env.FIREBASE_DATABASE_EMULATOR_HOST),c?(a=!0,r=`http://${c}?ns=${l.namespace}`,o=ms(r,s),l=o.repoInfo):a=!o.repoInfo.secure;const f=s&&a?new ne(ne.OWNER):new D(n.name,n.options,e);Yr("Invalid Firebase Database URL",o),b(o.path)||U("Database URL must point to the root of a Firebase Database (not including a child path).");const g=function Hu(n,e,t,i){let s=Es[e.name];s||(s={},Es[e.name]=s);let r=s[n.toURLString()];return r&&U("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Za(n,false,t,i),s[n.toURLString()]=r,r}(l,n,f,new he(n.name,t));return new Ku(g,n)}class Ku{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function qa(n,e,t){if(n.stats_=wi(n.repoInfo_),n.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)n.server_=new Ln(n.repoInfo_,(i,s,r,o)=>{qr(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Xr(n,!0),0);else{if(typeof t<"u"&&null!==t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,u.Wl)(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new tt(n.repoInfo_,e,(i,s,r,o)=>{qr(n,i,s,r,o)},i=>{Xr(n,i)},i=>{!function Xa(n,e){Y(e,(t,i)=>{hs(n,t,i)})}(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=function Fo(n,e){const t=n.toString();return Ei[t]||(Ei[t]=e()),Ei[t]}(n.repoInfo_,()=>new Fl(n.stats_,n.server_)),n.infoData_=new kl,n.infoSyncTree_=new Lr({startListening:(i,s,r,o)=>{let l=[];const a=n.infoData_.getNode(i._path);return a.isEmpty()||(l=zt(n.infoSyncTree_,i._path,a),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),hs(n,"connected",!1),n.serverSyncTree_=new Lr({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(l,a)=>{const c=o(l,a);re(n.eventQueue_,i._path,c)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new _e(this._repo,O())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function Gu(n,e){const t=Es[e];(!t||t[n.key]!==n)&&U(`Database ${e}(${n.repoInfo_}) has already been deleted.`),eo(n),delete t[n.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&U("Cannot call "+e+" on a deleted database.")}}function Co(){Vs.IS_TRANSPORT_INITIALIZED&&K("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Yu(){Co(),Oe.forceDisallow()}function ju(){Co(),pt.forceDisallow(),Oe.forceAllow()}function Zu(n,e){Sn(n,e)}const Xu={".sv":"timestamp"};class tc{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}tt.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)},tt.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)},function qu(n){wn(Ye.SDK_VERSION),(0,Ye._registerComponent)(new Ke.wA("database",(e,{instanceIdentifier:t})=>yo(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),(0,Ye.registerVersion)(kt,"0.14.4",n),(0,Ye.registerVersion)(kt,"0.14.4","esm2017")}();const rc=new je.Yd("@firebase/database-compat"),wo=function(n){rc.warn("FIREBASE WARNING: "+n)};class ac{constructor(e){this._delegate=e}cancel(e){(0,u.Dv)("OnDisconnect.cancel",0,1,arguments.length),(0,u.Wj)("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){(0,u.Dv)("OnDisconnect.remove",0,1,arguments.length),(0,u.Wj)("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){(0,u.Dv)("OnDisconnect.set",1,2,arguments.length),(0,u.Wj)("OnDisconnect.set","onComplete",t,!0);const i=this._delegate.set(e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){(0,u.Dv)("OnDisconnect.setWithPriority",2,3,arguments.length),(0,u.Wj)("OnDisconnect.setWithPriority","onComplete",i,!0);const s=this._delegate.setWithPriority(e,t);return i&&s.then(()=>i(null),r=>i(r)),s}update(e,t){if((0,u.Dv)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,wo("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}(0,u.Wj)("OnDisconnect.update","onComplete",t,!0);const i=this._delegate.update(e);return t&&i.then(()=>t(null),s=>t(s)),i}}class uc{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return(0,u.Dv)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class He{constructor(e,t){this._database=e,this._delegate=t}val(){return(0,u.Dv)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return(0,u.Dv)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return(0,u.Dv)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return(0,u.Dv)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return(0,u.Dv)("DataSnapshot.child",0,1,arguments.length),e=String(e),tn("DataSnapshot.child","path",e,!1),new He(this._database,this._delegate.child(e))}hasChild(e){return(0,u.Dv)("DataSnapshot.hasChild",1,1,arguments.length),tn("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return(0,u.Dv)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return(0,u.Dv)("DataSnapshot.forEach",1,1,arguments.length),(0,u.Wj)("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new He(this._database,t)))}hasChildren(){return(0,u.Dv)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return(0,u.Dv)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return(0,u.Dv)("DataSnapshot.ref",0,0,arguments.length),new oe(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class Z{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,s){var r;(0,u.Dv)("Query.on",2,4,arguments.length),(0,u.Wj)("Query.on","callback",t,!1);const o=Z.getCancelAndContextArgs_("Query.on",i,s),l=(c,f)=>{t.call(o.context,new He(this.database,c),f)};l.userCallback=t,l.context=o.context;const a=null===(r=o.cancel)||void 0===r?void 0:r.bind(o.context);switch(e){case"value":return Cs(this._delegate,l,a),t;case"child_added":return co(this._delegate,l,a),t;case"child_removed":return _o(this._delegate,l,a),t;case"child_changed":return ho(this._delegate,l,a),t;case"child_moved":return fo(this._delegate,l,a),t;default:throw new Error((0,u.gK)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if((0,u.Dv)("Query.off",0,3,arguments.length),function(n,e,t){if(void 0!==e)switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error((0,u.gK)("Query.off","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}(0,e),(0,u.Wj)("Query.off","callback",t,!0),(0,u.lb)("Query.off","context",i,!0),t){const s=()=>{};s.userCallback=t,s.context=i,po(this._delegate,e,s)}else po(this._delegate,e)}get(){return yu(this._delegate).then(e=>new He(this.database,e))}once(e,t,i,s){(0,u.Dv)("Query.once",1,4,arguments.length),(0,u.Wj)("Query.once","callback",t,!0);const r=Z.getCancelAndContextArgs_("Query.once",i,s),o=new u.BH,l=(c,f)=>{const g=new He(this.database,c);t&&t.call(r.context,g,f),o.resolve(g)};l.userCallback=t,l.context=r.context;const a=c=>{r.cancel&&r.cancel.call(r.context,c),o.reject(c)};switch(e){case"value":Cs(this._delegate,l,a,{onlyOnce:!0});break;case"child_added":co(this._delegate,l,a,{onlyOnce:!0});break;case"child_removed":_o(this._delegate,l,a,{onlyOnce:!0});break;case"child_changed":ho(this._delegate,l,a,{onlyOnce:!0});break;case"child_moved":fo(this._delegate,l,a,{onlyOnce:!0});break;default:throw new Error((0,u.gK)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return(0,u.Dv)("Query.limitToFirst",1,1,arguments.length),new Z(this.database,we(this._delegate,function bu(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Ru(n)}(e)))}limitToLast(e){return(0,u.Dv)("Query.limitToLast",1,1,arguments.length),new Z(this.database,we(this._delegate,function Au(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Nu(n)}(e)))}orderByChild(e){return(0,u.Dv)("Query.orderByChild",1,1,arguments.length),new Z(this.database,we(this._delegate,function ku(n){if("$key"===n)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===n)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===n)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return tn("orderByChild","path",n,!1),new Pu(n)}(e)))}orderByKey(){return(0,u.Dv)("Query.orderByKey",0,0,arguments.length),new Z(this.database,we(this._delegate,function Du(){return new xu}()))}orderByPriority(){return(0,u.Dv)("Query.orderByPriority",0,0,arguments.length),new Z(this.database,we(this._delegate,function Lu(){return new Ou}()))}orderByValue(){return(0,u.Dv)("Query.orderByValue",0,0,arguments.length),new Z(this.database,we(this._delegate,function Mu(){return new Fu}()))}startAt(e=null,t){return(0,u.Dv)("Query.startAt",0,2,arguments.length),new Z(this.database,we(this._delegate,function Iu(n=null,e){return en("startAt","key",e,!0),new mo(n,e)}(e,t)))}startAfter(e=null,t){return(0,u.Dv)("Query.startAfter",0,2,arguments.length),new Z(this.database,we(this._delegate,function Tu(n,e){return en("startAfter","key",e,!0),new Su(n,e)}(e,t)))}endAt(e=null,t){return(0,u.Dv)("Query.endAt",0,2,arguments.length),new Z(this.database,we(this._delegate,function Cu(n,e){return en("endAt","key",e,!0),new go(n,e)}(e,t)))}endBefore(e=null,t){return(0,u.Dv)("Query.endBefore",0,2,arguments.length),new Z(this.database,we(this._delegate,function wu(n,e){return en("endBefore","key",e,!0),new Eu(n,e)}(e,t)))}equalTo(e,t){return(0,u.Dv)("Query.equalTo",1,2,arguments.length),new Z(this.database,we(this._delegate,function Uu(n,e){return en("equalTo","key",e,!0),new Wu(n,e)}(e,t)))}toString(){return(0,u.Dv)("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return(0,u.Dv)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if((0,u.Dv)("Query.isEqual",1,1,arguments.length),!(e instanceof Z))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){const s={cancel:void 0,context:void 0};if(t&&i)s.cancel=t,(0,u.Wj)(e,"cancel",s.cancel,!0),s.context=i,(0,u.lb)(e,"context",s.context,!0);else if(t)if("object"==typeof t&&null!==t)s.context=t;else{if("function"!=typeof t)throw new Error((0,u.gK)(e,"cancelOrContext")+" must either be a cancel callback or a context object.");s.cancel=t}return s}get ref(){return new oe(this.database,new _e(this._delegate._repo,this._delegate._path))}}class oe extends Z{constructor(e,t){super(e,new se(t._repo,t._path,new Dn,!1)),this.database=e,this._delegate=t}getKey(){return(0,u.Dv)("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return(0,u.Dv)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new oe(this.database,lt(this._delegate,e))}getParent(){(0,u.Dv)("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new oe(this.database,e):null}getRoot(){return(0,u.Dv)("Reference.root",0,0,arguments.length),new oe(this.database,this._delegate.root)}set(e,t){(0,u.Dv)("Reference.set",1,2,arguments.length),(0,u.Wj)("Reference.set","onComplete",t,!0);const i=ys(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}update(e,t){if((0,u.Dv)("Reference.update",1,2,arguments.length),Array.isArray(e)){const s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,wo("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}fe("Reference.update",this._delegate._path),(0,u.Wj)("Reference.update","onComplete",t,!0);const i=vu(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){(0,u.Dv)("Reference.setWithPriority",2,3,arguments.length),(0,u.Wj)("Reference.setWithPriority","onComplete",i,!0);const s=function mu(n,e,t){if(fe("setWithPriority",n._path),be("setWithPriority",e,n._path,!1),cs("setWithPriority",t,!1),".length"===n.key||".keys"===n.key)throw"setWithPriority failed: "+n.key+" is a read-only object.";const i=new u.BH;return ds(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}(this._delegate,e,t);return i&&s.then(()=>i(null),r=>i(r)),s}remove(e){(0,u.Dv)("Reference.remove",0,1,arguments.length),(0,u.Wj)("Reference.remove","onComplete",e,!0);const t=function pu(n){return fe("remove",n._path),ys(n,null)}(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){(0,u.Dv)("Reference.transaction",1,3,arguments.length),(0,u.Wj)("Reference.transaction","transactionUpdate",e,!1),(0,u.Wj)("Reference.transaction","onComplete",t,!0),function(n,e,t,i){if(void 0!==t&&"boolean"!=typeof t)throw new Error((0,u.gK)("Reference.transaction","applyLocally")+"must be a boolean.")}(0,0,i);const s=function nc(n,e,t){var i;if(n=(0,u.m9)(n),fe("Reference.transaction",n._path),".length"===n.key||".keys"===n.key)throw"Reference.transaction failed: "+n.key+" is a read-only object.";const s=null===(i=t?.applyLocally)||void 0===i||i,r=new u.BH,l=Cs(n,()=>{});return function lu(n,e,t,i,s,r){It(n,"transaction on "+e);const o={path:e,update:t,onComplete:i,status:null,order:In(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=_s(n,e,void 0);o.currentInputSnapshot=l;const a=o.update(l.val());if(void 0===a)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Jt("transaction failed: Data returned ",a,o.path),o.status=0;const c=Zn(n.transactionQueueTree_,e),f=rt(c)||[];let g;f.push(o),ls(c,f),"object"==typeof a&&null!==a&&(0,u.r3)(a,".priority")?(g=(0,u.DV)(a,".priority"),(0,u.hu)(Xt(g),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):g=(zn(n.serverSyncTree_,e)||S.EMPTY_NODE).getPriority().val();const m=nn(n),C=H(a,g),E=ss(C,l,m);o.currentOutputSnapshotRaw=C,o.currentOutputSnapshotResolved=E,o.currentWriteId=ei(n);const N=qi(n.serverSyncTree_,e,E,o.currentWriteId,o.applyLocally);re(n.eventQueue_,e,N),ti(n,n.transactionQueueTree_)}}(n._repo,n._path,e,(a,c,f)=>{let g=null;a?r.reject(a):(g=new ot(f,new _e(n._repo,n._path),M),r.resolve(new tc(c,g)))},l,s),r.promise}(this._delegate,e,{applyLocally:i}).then(r=>new uc(r.committed,new He(this.database,r.snapshot)));return t&&s.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),s}setPriority(e,t){(0,u.Dv)("Reference.setPriority",1,2,arguments.length),(0,u.Wj)("Reference.setPriority","onComplete",t,!0);const i=function gu(n,e){n=(0,u.m9)(n),fe("setPriority",n._path),cs("setPriority",e,!1);const t=new u.BH;return ds(n._repo,V(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}push(e,t){(0,u.Dv)("Reference.push",0,2,arguments.length),(0,u.Wj)("Reference.push","onComplete",t,!0);const i=function _u(n,e){n=(0,u.m9)(n),fe("push",n._path),be("push",e,n._path,!0);const t=Zr(n._repo),i=fu(t),s=lt(n,i),r=lt(n,i);let o;return o=null!=e?ys(r,e).then(()=>r):Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}(this._delegate,e),s=i.then(o=>new oe(this.database,o));t&&s.then(()=>t(null),o=>t(o));const r=new oe(this.database,i);return r.then=s.then.bind(s),r.catch=s.catch.bind(s,void 0),r}onDisconnect(){return fe("Reference.onDisconnect",this._delegate._path),new ac(new lo(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class on{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Yu,forceLongPolling:ju}}useEmulator(e,t,i={}){!function Eo(n,e,t,i={}){(n=(0,u.m9)(n))._checkNotDeleted("useEmulator"),n._instanceStarted&&U("Cannot call useEmulator() after instance has already been initialized.");const s=n._repoInternal;let r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&U('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new ne(ne.OWNER);else if(i.mockUserToken){const o="string"==typeof i.mockUserToken?i.mockUserToken:(0,u.Sg)(i.mockUserToken,n.app.options.projectId);r=new ne(o)}!function Vu(n,e,t,i){n.repoInfo_=new yi(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}(s,e,t,r)}(this._delegate,e,t,i)}ref(e){if((0,u.Dv)("database.ref",0,1,arguments.length),e instanceof oe){const t=uo(this._delegate,e.toString());return new oe(this,t)}{const t=ao(this._delegate,e);return new oe(this,t)}}refFromURL(e){(0,u.Dv)("database.refFromURL",1,1,arguments.length);const i=uo(this._delegate,e);return new oe(this,i)}goOffline(){return(0,u.Dv)("database.goOffline",0,0,arguments.length),function zu(n){(n=(0,u.m9)(n))._checkNotDeleted("goOffline"),eo(n._repo)}(this._delegate)}goOnline(){return(0,u.Dv)("database.goOnline",0,0,arguments.length),function $u(n){(n=(0,u.m9)(n))._checkNotDeleted("goOnline"),function ou(n){n.persistentConnection_&&n.persistentConnection_.resume($r)}(n._repo)}(this._delegate)}}on.ServerValue={TIMESTAMP:function Ju(){return Xu}(),increment:n=>function ec(n){return{".sv":{increment:n}}}(n)};var hc=Object.freeze({__proto__:null,initStandalone:function cc({app:n,url:e,version:t,customAuthImpl:i,namespace:s,nodeAdmin:r=!1}){wn(t);const o=new Ke.zt("auth-internal",new Ke.H0("database-standalone"));return o.setComponent(new Ke.wA("auth-internal",()=>i,"PRIVATE")),{instance:new on(yo(n,o,void 0,e,r),n),namespace:s}}});const dc=on.ServerValue;function Io(n){return null==n}function So(n){return"function"==typeof n.set}function To(n,e){return So(e)?e:n.ref(e)}function Ro(n,e){if(function _c(n){return"string"==typeof n}(n))return e.stringCase();if(So(n))return e.firebaseCase();if(function pc(n){return"function"==typeof n.exportVal}(n))return e.snapshotCase();throw new Error("Expects a string, snapshot, or reference. Got: "+typeof n)}function ln(n,e,t="on",i=hi.z){return new an.y(s=>{let r=null;return r=n[t](e,(o,l)=>{i.schedule(()=>{s.next({snapshot:o,prevKey:l})}),"once"===t&&i.schedule(()=>s.complete())},o=>{i.schedule(()=>s.error(o))}),"on"===t?{unsubscribe(){null!=r&&n.off(e,r)}}:{unsubscribe(){}}}).pipe((0,ge.U)(s=>{const{snapshot:r,prevKey:o}=s;let l=null;return r.exists()&&(l=r.key),{type:e,payload:r,prevKey:o,key:l}}),(0,ut.B)())}function bo(n,e){const t=n.length;for(let i=0;i<t;i++)if(n[i].payload.key===e)return i;return-1}function vc(n,e){const{payload:t,prevKey:i,key:s}=e,r=bo(n,s),o=function mc(n,e){if(Io(e))return 0;{const t=bo(n,e);return-1===t?n.length:t+1}}(n,i);switch(e.type){case"value":if(e.payload&&e.payload.exists()){let l=null;e.payload.forEach(a=>{const c={payload:a,type:"value",prevKey:l,key:a.key};return l=a.key,n=[...n,c],!1})}return n;case"child_added":if(r>-1){const l=n[r-1];(l&&l.key||null)!==i&&(n=n.filter(a=>a.payload.key!==t.key)).splice(o,0,e)}else{if(null==i)return[e,...n];(n=n.slice()).splice(o,0,e)}return n;case"child_removed":return n.filter(l=>l.payload.key!==t.key);case"child_changed":return n.map(l=>l.payload.key===s?e:l);case"child_moved":if(r>-1){const l=n.splice(r,1)[0];return(n=n.slice()).splice(o,0,l),n}return n;default:return n}}function No(n){return(Io(n)||0===n.length)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function Ao(n,e,t){return function gc(n,e,t){return ln(n,"value","once",t).pipe((0,pe.w)(i=>{const s=[(0,B.of)(i)];return e.forEach(r=>s.push(ln(n,r,"on",t))),(0,Tt.T)(...s).pipe((0,mn.R)(vc,[]))}),(0,vn.x)())}(n,e=No(e),t)}function Po(n,e,t){const i=(e=No(e)).map(s=>ln(n,s,"on",t));return(0,Tt.T)(...i)}function ko(n,e){return function(i,s){return Ro(i,{stringCase:()=>n.child(i)[e](s),firebaseCase:()=>i[e](s),snapshotCase:()=>i.ref[e](s)})}}function wc(n){return function(t){return t?Ro(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function xo(n,e){return function(){return ln(n,"value","on",e)}}!function fc(n){n.INTERNAL.registerComponent(new Ke.wA("database-compat",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app-compat").getImmediate(),s=e.getProvider("database").getImmediate({identifier:t});return new on(s,i)},"PUBLIC").setServiceProps({Reference:oe,Query:Z,Database:on,DataSnapshot:He,enableLogging:Zu,INTERNAL:hc,ServerValue:dc}).setMultipleInstances(!0)),n.registerVersion("@firebase/database-compat","0.3.4")}(gi.Z);const Tc=new I.OlP("angularfire2.realtimeDatabaseURL"),Rc=new I.OlP("angularfire2.database.use-emulator");let bc=(()=>{class n{constructor(t,i,s,r,o,l,a,c,f,g,m,C,E,N,G){this.schedulers=l;const ee=a,le=(0,ue.on)(t,o,i);c&&gn(le,o,f,m,C,E,g,N),this.database=(0,ue.cc)(`${le.name}.database.${s}`,"AngularFireDatabase",le.name,()=>{const Ne=o.runOutsideAngular(()=>le.database(s||void 0));return ee&&Ne.useEmulator(...ee),Ne},[ee])}list(t,i){const s=this.schedulers.ngZone.runOutsideAngular(()=>To(this.database,t));let r=s;return i&&(r=i(s)),function Ic(n,e){const t=e.schedulers.outsideAngular,i=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:ko(i,"update"),set:ko(i,"set"),push:s=>i.push(s),remove:wc(i),snapshotChanges:s=>Ao(n,s,t).pipe(me.iC),stateChanges:s=>Po(n,s,t).pipe(me.iC),auditTrail:s=>function yc(n,e,t){return function Ec(n,e,t){return function Cc(n,e){return ln(n,"value","on",e).pipe((0,ge.U)(t=>{let i;return t.payload.forEach(s=>(i=s.key,!1)),{data:t,lastKeyToLoad:i}}))}(n,t).pipe(function Cn(...n){const e=(0,_i.jO)(n);return(0,yn.e)((t,i)=>{const s=n.length,r=new Array(s);let o=n.map(()=>!1),l=!1;for(let a=0;a<s;a++)(0,di.Xf)(n[a]).subscribe((0,Pt.x)(i,c=>{r[a]=c,!l&&!o[a]&&(o[a]=!0,(l=o.every(fi.y))&&(o=null))},Qe.Z));t.subscribe((0,Pt.x)(i,a=>{if(l){const c=[a,...r];i.next(e?e(...c):c)}}))})}(e),(0,ge.U)(([s,r])=>{const o=s.lastKeyToLoad,l=r.map(a=>a.key);return{actions:r,lastKeyToLoad:o,loadedKeys:l}}),function pi(n){return(0,yn.e)((e,t)=>{let i=!1,s=0;e.subscribe((0,Pt.x)(t,r=>(i||(i=!n(r,s++)))&&t.next(r)))})}(s=>-1===s.loadedKeys.indexOf(s.lastKeyToLoad)),(0,ge.U)(s=>s.actions))}(n,Po(n,e).pipe((0,mn.R)((s,r)=>[...s,r],[])),t)}(n,s,t).pipe(me.iC),valueChanges:(s,r)=>Ao(n,s,t).pipe((0,ge.U)(l=>l.map(a=>r&&r.idField?Object.assign(Object.assign({},a.payload.val()),{[r.idField]:a.key}):a.payload.val())),me.iC)}}(r,this)}object(t){return function Sc(n,e){return{query:n,snapshotChanges:()=>xo(n,e.schedulers.outsideAngular)().pipe(me.iC),update:t=>n.ref.update(t),set:t=>n.ref.set(t),remove:()=>n.ref.remove(),valueChanges:()=>xo(n,e.schedulers.outsideAngular)().pipe(me.iC,(0,ge.U)(i=>i.payload.exists()?i.payload.val():null))}}(this.schedulers.ngZone.runOutsideAngular(()=>To(this.database,t)),this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}}return n.\u0275fac=function(t){return new(t||n)(I.LFG(ue.Dh),I.LFG(ue.xv,8),I.LFG(Tc,8),I.LFG(I.Lbi),I.LFG(I.R0b),I.LFG(me.HU),I.LFG(Rc,8),I.LFG(De,8),I.LFG(ct,8),I.LFG(fn,8),I.LFG(_n,8),I.LFG(ht,8),I.LFG(dt,8),I.LFG(pn,8),I.LFG(hn.nm,8))},n.\u0275prov=I.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),Nc=(()=>{class n{constructor(t,i){this.afauth=t,this.db=i}login(t,i){var s=this;return(0,P.Z)(function*(){try{return yield s.afauth.signInWithEmailAndPassword(t,i)}catch(r){return console.log("error en login: ",r),null}})()}register({email:t,password:i}){var s=this;return(0,P.Z)(function*(){try{return yield s.afauth.createUserWithEmailAndPassword(t,i)}catch(r){return console.log("error en login: ",r),null}})()}logLogin(){var t=this;return(0,P.Z)(function*(){const i=yield t.afauth.currentUser;if(null!=i){const s=i.email,r=(new Date).toISOString();t.db.list("/logUser").push({email:s,timestamp:r})}})()}logOut(){var t=this;return(0,P.Z)(function*(){try{return yield t.afauth.signOut()}catch(i){return console.log("error en login: ",i),null}})()}getUserLoggedIn(){return this.afauth.authState}static#e=this.\u0275fac=function(i){return new(i||n)(I.LFG(De),I.LFG(bc))};static#t=this.\u0275prov=I.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})()},8661:(Do,oi,w)=>{w.r(oi);var P=w(5861),I=w(3399),p=w(6710),B=w(9058),Tt=(w(7592),w(7879),w(4537));function ae(){return window}function Rt(){return Rt=(0,P.Z)(function*(_,d,h){var v;const{BuildInfo:y}=ae();(0,p.as)(d.sessionId,"AuthEvent did not contain a session ID");const T=yield function Nt(_){return At.apply(this,arguments)}(d.sessionId),k={};return(0,p.at)()?k.ibi=y.packageName:(0,p.au)()?k.apn=y.packageName:(0,p.av)(_,"operation-not-supported-in-this-environment"),y.displayName&&(k.appDisplayName=y.displayName),k.sessionId=T,(0,p.aw)(_,h,d.type,void 0,null!==(v=d.eventId)&&void 0!==v?v:void 0,k)}),Rt.apply(this,arguments)}function ut(){return(ut=(0,P.Z)(function*(_){const{BuildInfo:d}=ae(),h={};(0,p.at)()?h.iosBundleId=d.packageName:(0,p.au)()?h.androidPackageName=d.packageName:(0,p.av)(_,"operation-not-supported-in-this-environment"),yield(0,p.ax)(_,h)})).apply(this,arguments)}function bt(){return(bt=(0,P.Z)(function*(_,d,h){const{cordova:v}=ae();let y=()=>{};try{yield new Promise((T,k)=>{let x=null;function z(){var D;T();const ne=null===(D=v.plugins.browsertab)||void 0===D?void 0:D.close;"function"==typeof ne&&ne(),"function"==typeof h?.close&&h.close()}function $(){x||(x=window.setTimeout(()=>{k((0,p.az)(_,"redirect-cancelled-by-user"))},2e3))}function he(){"visible"===document?.visibilityState&&$()}d.addPassiveListener(z),document.addEventListener("resume",$,!1),(0,p.au)()&&document.addEventListener("visibilitychange",he,!1),y=()=>{d.removePassiveListener(z),document.removeEventListener("resume",$,!1),document.removeEventListener("visibilitychange",he,!1),x&&window.clearTimeout(x)}})}finally{y()}})).apply(this,arguments)}function At(){return(At=(0,P.Z)(function*(_){const d=function me(_){if((0,p.as)(/[0-9a-zA-Z]+/.test(_),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(_);const d=new ArrayBuffer(_.length),h=new Uint8Array(d);for(let v=0;v<_.length;v++)h[v]=_.charCodeAt(v);return h}(_),h=yield crypto.subtle.digest("SHA-256",d);return Array.from(new Uint8Array(h)).map(y=>y.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}class ci extends p.aB{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(d=>{this.resolveInialized=d})}addPassiveListener(d){this.passiveListeners.add(d)}removePassiveListener(d){this.passiveListeners.delete(d)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(d){return this.resolveInialized(),this.passiveListeners.forEach(h=>h(d)),super.onEvent(d)}initialized(){var d=this;return(0,P.Z)(function*(){yield d.initPromise})()}}function dn(_){return ct.apply(this,arguments)}function ct(){return(ct=(0,P.Z)(function*(_){const d=yield ht()._get(dt(_));return d&&(yield ht()._remove(dt(_))),d})).apply(this,arguments)}function _n(){const _=[];for(let h=0;h<20;h++){const v=Math.floor(62*Math.random());_.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(v))}return _.join("")}function ht(){return(0,p.aC)(p.b)}function dt(_){return(0,p.aD)("authEvent",_.config.apiKey,_.name)}function De(_){if(!_?.includes("?"))return{};const[d,...h]=_.split("?");return(0,B.zd)(h.join("?"))}const mn=class hi{constructor(){this._redirectPersistence=p.a,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=p.aE,this._overrideRedirectResult=p.aF}_initialize(d){var h=this;return(0,P.Z)(function*(){const v=d._key();let y=h.eventManagers.get(v);return y||(y=new ci(d),h.eventManagers.set(v,y),h.attachCallbackListeners(d,y)),y})()}_openPopup(d){(0,p.av)(d,"operation-not-supported-in-this-environment")}_openRedirect(d,h,v,y){var T=this;return(0,P.Z)(function*(){!function cn(_){var d,h,v,y,T,k,x,z,$,he;const D=ae();(0,p.aA)("function"==typeof(null===(d=D?.universalLinks)||void 0===d?void 0:d.subscribe),_,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),(0,p.aA)(typeof(null===(h=D?.BuildInfo)||void 0===h?void 0:h.packageName)<"u",_,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),(0,p.aA)("function"==typeof(null===(T=null===(y=null===(v=D?.cordova)||void 0===v?void 0:v.plugins)||void 0===y?void 0:y.browsertab)||void 0===T?void 0:T.openUrl),_,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,p.aA)("function"==typeof(null===(z=null===(x=null===(k=D?.cordova)||void 0===k?void 0:k.plugins)||void 0===x?void 0:x.browsertab)||void 0===z?void 0:z.isAvailable),_,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,p.aA)("function"==typeof(null===(he=null===($=D?.cordova)||void 0===$?void 0:$.InAppBrowser)||void 0===he?void 0:he.open),_,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(d);const k=yield T._initialize(d);yield k.initialized(),k.resetRedirect(),(0,p.aG)(),yield T._originValidation(d);const x=function hn(_,d,h=null){return{type:d,eventId:h,urlResponse:null,sessionId:_n(),postBody:null,tenantId:_.tenantId,error:(0,p.az)(_,"no-auth-event")}}(d,v,y);yield function ws(_,d){return ht()._set(dt(_),d)}(d,x);const z=yield function ge(_,d,h){return Rt.apply(this,arguments)}(d,x,h),$=yield function un(_){const{cordova:d}=ae();return new Promise(h=>{d.plugins.browsertab.isAvailable(v=>{let y=null;v?d.plugins.browsertab.openUrl(_):y=d.InAppBrowser.open(_,(0,p.ay)()?"_blank":"_system","location=yes"),h(y)})})}(z);return function ui(_,d,h){return bt.apply(this,arguments)}(d,k,$)})()}_isIframeWebStorageSupported(d,h){throw new Error("Method not implemented.")}_originValidation(d){const h=d._key();return this.originValidationPromises[h]||(this.originValidationPromises[h]=function ai(_){return ut.apply(this,arguments)}(d)),this.originValidationPromises[h]}attachCallbackListeners(d,h){const{universalLinks:v,handleOpenURL:y,BuildInfo:T}=ae(),k=setTimeout((0,P.Z)(function*(){yield dn(d),h.onEvent(vn())}),500),x=function(){var he=(0,P.Z)(function*(D){clearTimeout(k);const ne=yield dn(d);let Je=null;ne&&D?.url&&(Je=function fn(_,d){var h,v;const y=function gn(_){const d=De(_),h=d.link?decodeURIComponent(d.link):void 0,v=De(h).link,y=d.deep_link_id?decodeURIComponent(d.deep_link_id):void 0;return De(y).link||y||v||h||_}(d);if(y.includes("/__/auth/callback")){const T=De(y),k=T.firebaseError?function pn(_){try{return JSON.parse(_)}catch{return null}}(decodeURIComponent(T.firebaseError)):null,x=null===(v=null===(h=k?.code)||void 0===h?void 0:h.split("auth/"))||void 0===v?void 0:v[1],z=x?(0,p.az)(x):null;return z?{type:_.type,eventId:_.eventId,tenantId:_.tenantId,error:z,urlResponse:null,sessionId:null,postBody:null}:{type:_.type,eventId:_.eventId,tenantId:_.tenantId,sessionId:_.sessionId,urlResponse:y,postBody:null}}return null}(ne,D.url)),h.onEvent(Je||vn())});return function(ne){return he.apply(this,arguments)}}();typeof v<"u"&&"function"==typeof v.subscribe&&v.subscribe(null,x);const z=y,$=`${T.packageName.toLowerCase()}://`;ae().handleOpenURL=function(){var he=(0,P.Z)(function*(D){if(D.toLowerCase().startsWith($)&&x({url:D}),"function"==typeof z)try{z(D)}catch(ne){console.error(ne)}});return function(D){return he.apply(this,arguments)}}()}};function vn(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:(0,p.az)("no-auth-event")}}function Qe(){var _;return(null===(_=self?.location)||void 0===_?void 0:_.protocol)||null}function Cn(_=(0,B.z$)()){return!("file:"!==Qe()&&"ionic:"!==Qe()&&"capacitor:"!==Qe()||!_.toLowerCase().match(/iphone|ipad|ipod|android/))}function Ye(){try{const _=self.localStorage,d=p.aL();if(_)return _.setItem(d,"1"),_.removeItem(d),!function Ke(_=(0,B.z$)()){return function Ss(){return(0,B.w1)()&&11===document?.documentMode}()||function gi(_=(0,B.z$)()){return/Edge\/\d+/.test(_)}(_)}()||(0,B.hl)()}catch{return u()&&(0,B.hl)()}return!1}function u(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function je(){return(function _i(){return"http:"===Qe()||"https:"===Qe()}()||(0,B.ru)()||Cn())&&!function pi(){return(0,B.b$)()||(0,B.UG)()}()&&Ye()&&!u()}function kt(){return Cn()&&typeof document<"u"}function ze(){return(ze=(0,P.Z)(function*(){return!!kt()&&new Promise(_=>{const d=setTimeout(()=>{_(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(d),_(!0)})})})).apply(this,arguments)}const X={LOCAL:"local",NONE:"none",SESSION:"session"},$e=p.aA,xt="persistence";function Ze(_){return Ie.apply(this,arguments)}function Ie(){return(Ie=(0,P.Z)(function*(_){yield _._initializationPromise;const d=Dt(),h=p.aD(xt,_.config.apiKey,_.name);d&&d.setItem(h,_._getPersistence())})).apply(this,arguments)}function Dt(){var _;try{return(null===(_=function wn(){return typeof window<"u"?window:null}())||void 0===_?void 0:_.sessionStorage)||null}catch{return null}}const qe=p.aA;class q{constructor(){this.browserResolver=p.aC(p.k),this.cordovaResolver=p.aC(mn),this.underlyingResolver=null,this._redirectPersistence=p.a,this._completeRedirectFn=p.aE,this._overrideRedirectResult=p.aF}_initialize(d){var h=this;return(0,P.Z)(function*(){return yield h.selectUnderlyingResolver(),h.assertedUnderlyingResolver._initialize(d)})()}_openPopup(d,h,v,y){var T=this;return(0,P.Z)(function*(){return yield T.selectUnderlyingResolver(),T.assertedUnderlyingResolver._openPopup(d,h,v,y)})()}_openRedirect(d,h,v,y){var T=this;return(0,P.Z)(function*(){return yield T.selectUnderlyingResolver(),T.assertedUnderlyingResolver._openRedirect(d,h,v,y)})()}_isIframeWebStorageSupported(d,h){this.assertedUnderlyingResolver._isIframeWebStorageSupported(d,h)}_originValidation(d){return this.assertedUnderlyingResolver._originValidation(d)}get _shouldInitProactively(){return kt()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return qe(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var d=this;return(0,P.Z)(function*(){if(d.underlyingResolver)return;const h=yield function En(){return ze.apply(this,arguments)}();d.underlyingResolver=h?d.cordovaResolver:d.browserResolver})()}}function Ot(_){return _.unwrap()}function Q(_){return ft(_)}function ft(_){const{_tokenResponse:d}=_ instanceof B.ZR?_.customData:_;if(!d)return null;if(!(_ instanceof B.ZR)&&"temporaryProof"in d&&"phoneNumber"in d)return p.P.credentialFromResult(_);const h=d.providerId;if(!h||h===p.p.PASSWORD)return null;let v;switch(h){case p.p.GOOGLE:v=p.V;break;case p.p.FACEBOOK:v=p.U;break;case p.p.GITHUB:v=p.W;break;case p.p.TWITTER:v=p.Z;break;default:const{oauthIdToken:y,oauthAccessToken:T,oauthTokenSecret:k,pendingToken:x,nonce:z}=d;return T||k||y||x?x?h.startsWith("saml.")?p.aO._create(h,x):p.L._fromParams({providerId:h,signInMethod:h,pendingToken:x,idToken:y,accessToken:T}):new p.X(h).credential({idToken:y,accessToken:T,rawNonce:z}):null}return _ instanceof B.ZR?v.credentialFromError(_):v.credentialFromResult(_)}function U(_,d){return d.catch(h=>{throw h instanceof B.ZR&&function Xe(_,d){var h;const v=null===(h=d.customData)||void 0===h?void 0:h._tokenResponse;if("auth/multi-factor-auth-required"===d?.code)d.resolver=new _t(_,p.aq(_,d));else if(v){const y=ft(d),T=d;y&&(T.credential=y,T.tenantId=v.tenantId||void 0,T.email=v.email||void 0,T.phoneNumber=v.phoneNumber||void 0)}}(_,h),h}).then(h=>{const y=h.user;return{operationType:h.operationType,credential:Q(h),additionalUserInfo:p.ao(h),user:ve.getOrCreate(y)}})}function K(_,d){return Lt.apply(this,arguments)}function Lt(){return(Lt=(0,P.Z)(function*(_,d){const h=yield d;return{verificationId:h.verificationId,confirm:v=>U(_,h.confirm(v))}})).apply(this,arguments)}class _t{constructor(d,h){this.resolver=h,this.auth=function Sn(_){return _.wrapped()}(d)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(d){return U(Ot(this.auth),this.resolver.resolveSignIn(d))}}class ve{constructor(d){this._delegate=d,this.multiFactor=p.ar(d)}static getOrCreate(d){return ve.USER_MAP.has(d)||ve.USER_MAP.set(d,new ve(d)),ve.USER_MAP.get(d)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(d){return this._delegate.getIdTokenResult(d)}getIdToken(d){return this._delegate.getIdToken(d)}linkAndRetrieveDataWithCredential(d){return this.linkWithCredential(d)}linkWithCredential(d){var h=this;return(0,P.Z)(function*(){return U(h.auth,p.a0(h._delegate,d))})()}linkWithPhoneNumber(d,h){var v=this;return(0,P.Z)(function*(){return K(v.auth,p.l(v._delegate,d,h))})()}linkWithPopup(d){var h=this;return(0,P.Z)(function*(){return U(h.auth,p.d(h._delegate,d,q))})()}linkWithRedirect(d){var h=this;return(0,P.Z)(function*(){return yield Ze(p.aH(h.auth)),p.g(h._delegate,d,q)})()}reauthenticateAndRetrieveDataWithCredential(d){return this.reauthenticateWithCredential(d)}reauthenticateWithCredential(d){var h=this;return(0,P.Z)(function*(){return U(h.auth,p.a1(h._delegate,d))})()}reauthenticateWithPhoneNumber(d,h){return K(this.auth,p.r(this._delegate,d,h))}reauthenticateWithPopup(d){return U(this.auth,p.e(this._delegate,d,q))}reauthenticateWithRedirect(d){var h=this;return(0,P.Z)(function*(){return yield Ze(p.aH(h.auth)),p.h(h._delegate,d,q)})()}sendEmailVerification(d){return p.ae(this._delegate,d)}unlink(d){var h=this;return(0,P.Z)(function*(){return yield p.an(h._delegate,d),h})()}updateEmail(d){return p.aj(this._delegate,d)}updatePassword(d){return p.ak(this._delegate,d)}updatePhoneNumber(d){return p.u(this._delegate,d)}updateProfile(d){return p.ai(this._delegate,d)}verifyBeforeUpdateEmail(d,h){return p.af(this._delegate,d,h)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}ve.USER_MAP=new WeakMap;const te=p.aA;let ce=(()=>{class _{constructor(h,v){if(this.app=h,v.isInitialized())return this._delegate=v.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:y}=h.options;te(y,"invalid-api-key",{appName:h.name}),te(y,"invalid-api-key",{appName:h.name});const T=typeof window<"u"?q:void 0;this._delegate=v.initialize({options:{persistence:mi(y,h.name),popupRedirectResolver:T}}),this._delegate._updateErrorMap(p.D),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?ve.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(h){this._delegate.languageCode=h}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(h){this._delegate.tenantId=h}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(h,v){p.I(this._delegate,h,v)}applyActionCode(h){return p.a5(this._delegate,h)}checkActionCode(h){return p.a6(this._delegate,h)}confirmPasswordReset(h,v){return p.a4(this._delegate,h,v)}createUserWithEmailAndPassword(h,v){var y=this;return(0,P.Z)(function*(){return U(y._delegate,p.a8(y._delegate,h,v))})()}fetchProvidersForEmail(h){return this.fetchSignInMethodsForEmail(h)}fetchSignInMethodsForEmail(h){return p.ad(this._delegate,h)}isSignInWithEmailLink(h){return p.ab(this._delegate,h)}getRedirectResult(){var h=this;return(0,P.Z)(function*(){te(je(),h._delegate,"operation-not-supported-in-this-environment");const v=yield p.j(h._delegate,q);return v?U(h._delegate,Promise.resolve(v)):{credential:null,user:null}})()}addFrameworkForLogging(h){!function yn(_,d){(0,p.aH)(_)._logFramework(d)}(this._delegate,h)}onAuthStateChanged(h,v,y){const{next:T,error:k,complete:x}=Se(h,v,y);return this._delegate.onAuthStateChanged(T,k,x)}onIdTokenChanged(h,v,y){const{next:T,error:k,complete:x}=Se(h,v,y);return this._delegate.onIdTokenChanged(T,k,x)}sendSignInLinkToEmail(h,v){return p.aa(this._delegate,h,v)}sendPasswordResetEmail(h,v){return p.a3(this._delegate,h,v||void 0)}setPersistence(h){var v=this;return(0,P.Z)(function*(){let y;switch(function Ae(_,d){$e(Object.values(X).includes(d),_,"invalid-persistence-type"),(0,B.b$)()?$e(d!==X.SESSION,_,"unsupported-persistence-type"):(0,B.UG)()?$e(d===X.NONE,_,"unsupported-persistence-type"):u()?$e(d===X.NONE||d===X.LOCAL&&(0,B.hl)(),_,"unsupported-persistence-type"):$e(d===X.NONE||Ye(),_,"unsupported-persistence-type")}(v._delegate,h),h){case X.SESSION:y=p.a;break;case X.LOCAL:y=(yield p.aC(p.i)._isAvailable())?p.i:p.b;break;case X.NONE:y=p.N;break;default:return p.av("argument-error",{appName:v._delegate.name})}return v._delegate.setPersistence(y)})()}signInAndRetrieveDataWithCredential(h){return this.signInWithCredential(h)}signInAnonymously(){return U(this._delegate,p._(this._delegate))}signInWithCredential(h){return U(this._delegate,p.$(this._delegate,h))}signInWithCustomToken(h){return U(this._delegate,p.a2(this._delegate,h))}signInWithEmailAndPassword(h,v){return U(this._delegate,p.a9(this._delegate,h,v))}signInWithEmailLink(h,v){return U(this._delegate,p.ac(this._delegate,h,v))}signInWithPhoneNumber(h,v){return K(this._delegate,p.s(this._delegate,h,v))}signInWithPopup(h){var v=this;return(0,P.Z)(function*(){return te(je(),v._delegate,"operation-not-supported-in-this-environment"),U(v._delegate,p.c(v._delegate,h,q))})()}signInWithRedirect(h){var v=this;return(0,P.Z)(function*(){return te(je(),v._delegate,"operation-not-supported-in-this-environment"),yield Ze(v._delegate),p.f(v._delegate,h,q)})()}updateCurrentUser(h){return this._delegate.updateCurrentUser(h)}verifyPasswordResetCode(h){return p.a7(this._delegate,h)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return _.Persistence=X,_})();function Se(_,d,h){let v=_;"function"!=typeof _&&({next:v,error:d,complete:h}=_);const y=v;return{next:k=>y(k&&ve.getOrCreate(k)),error:d,complete:h}}function mi(_,d){const h=function In(_,d){const h=Dt();if(!h)return[];const v=p.aD(xt,_,d);switch(h.getItem(v)){case X.NONE:return[p.N];case X.LOCAL:return[p.i,p.a];case X.SESSION:return[p.a];default:return[]}}(_,d);if(typeof self<"u"&&!h.includes(p.i)&&h.push(p.i),typeof window<"u")for(const v of[p.b,p.a])h.includes(v)||h.push(v);return h.includes(p.N)||h.push(p.N),h}class Pe{constructor(){this.providerId="phone",this._delegate=new p.P(Ot(I.Z.auth()))}static credential(d,h){return p.P.credential(d,h)}verifyPhoneNumber(d,h){return this._delegate.verifyPhoneNumber(d,h)}unwrap(){return this._delegate}}Pe.PHONE_SIGN_IN_METHOD=p.P.PHONE_SIGN_IN_METHOD,Pe.PROVIDER_ID=p.P.PROVIDER_ID;const Ft=p.aA;class Tn{constructor(d,h,v=I.Z.app()){var y;Ft(null===(y=v.options)||void 0===y?void 0:y.apiKey,"invalid-api-key",{appName:v.name}),this._delegate=new p.R(d,h,v.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function Rn(_){_.INTERNAL.registerComponent(new Tt.wA("auth-compat",d=>{const h=d.getProvider("app-compat").getImmediate(),v=d.getProvider("auth");return new ce(h,v)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:p.A.EMAIL_SIGNIN,PASSWORD_RESET:p.A.PASSWORD_RESET,RECOVER_EMAIL:p.A.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:p.A.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:p.A.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:p.A.VERIFY_EMAIL}},EmailAuthProvider:p.Q,FacebookAuthProvider:p.U,GithubAuthProvider:p.W,GoogleAuthProvider:p.V,OAuthProvider:p.X,SAMLAuthProvider:p.Y,PhoneAuthProvider:Pe,PhoneMultiFactorGenerator:p.m,RecaptchaVerifier:Tn,TwitterAuthProvider:p.Z,Auth:ce,AuthCredential:p.J,Error:B.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),_.registerVersion("@firebase/auth-compat","0.4.2")}(I.Z)}}]);