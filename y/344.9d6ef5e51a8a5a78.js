"use strict";(self.webpackChunkappUTN=self.webpackChunkappUTN||[]).push([[344],{1344:(hd,vl,O)=>{O.d(vl,{I:()=>Yh});var v=O(5861),N=O(5879),w=O(8645),de=O(2096),gn=O(5592),ui=O(2459),mn=O(3019),xr=O(3093),he=O(4664),et=O(7398),ac=O(4552);class Gt extends w.x{constructor(e=1/0,t=1/0,r=ac.l){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:r,_infiniteTimeWindow:o,_timestampProvider:u,_windowTime:c}=this;t||(r.push(e),!o&&r.push(u.now()+c)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:r,_buffer:o}=this,u=o.slice();for(let c=0;c<u.length&&!e.closed;c+=r?1:2)e.next(u[c]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:r,_infiniteTimeWindow:o}=this,u=(o?1:2)*e;if(e<1/0&&u<r.length&&r.splice(0,r.length-u),!o){const c=t.now();let h=0;for(let p=1;p<r.length&&r[p]<=c;p+=2)h=p;h&&r.splice(0,h+1)}}}var yo=O(3020);function Lr(n,e,t){let r,o=!1;return n&&"object"==typeof n?({bufferSize:r=1/0,windowTime:e=1/0,refCount:o=!1,scheduler:t}=n):r=n??1/0,(0,yo.B)({connector:()=>new Gt(r,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:o})}var yl=O(1374),Il=O(4674);function Mr(n,e){return(0,Il.m)(e)?(0,he.w)(()=>n,e):(0,he.w)(()=>n)}var Io=O(5137),ci=O(2181),Te=O(8397),fe=O(6304),ne=O(6814);O(4097);var Z=O(6122),He=O(4537),_=O(9058),Zt=O(7879);const Ce=new Map,fi={activated:!1,tokenObservers:[]},wo={initialized:!1,enabled:!1};function Y(n){return Ce.get(n)||Object.assign({},fi)}function pi(){return wo}const In="https://content-firebaseappcheck.googleapis.com/v1",Cl="exchangeDebugToken",_i={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class hc{constructor(e,t,r,o,u){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=o,this.upperBound=u,this.pending=null,this.nextErrorWaitInterval=o,o>u)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return(0,v.Z)(function*(){t.stop();try{t.pending=new _.BH,yield function wl(n){return new Promise(e=>{setTimeout(e,n)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new _.BH,yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(r){t.retryPolicy(r)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}const X=new _.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function Vr(n){if(!Y(n).activated)throw X.create("use-before-activation",{appName:n.name})}function gi(n,e){return Hr.apply(this,arguments)}function Hr(){return(Hr=(0,v.Z)(function*({url:n,body:e},t){const r={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){const E=yield o.getHeartbeatsHeader();E&&(r["X-Firebase-Client"]=E)}const u={method:"POST",body:JSON.stringify(e),headers:r};let c,h;try{c=yield fetch(n,u)}catch(E){throw X.create("fetch-network-error",{originalErrorMessage:E?.message})}if(200!==c.status)throw X.create("fetch-status-error",{httpStatus:c.status});try{h=yield c.json()}catch(E){throw X.create("fetch-parse-error",{originalErrorMessage:E?.message})}const p=h.ttl.match(/^([\d.]+)(s)$/);if(!p||!p[2]||isNaN(Number(p[1])))throw X.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${h.ttl}`});const g=1e3*Number(p[1]),I=Date.now();return{token:h.token,expireTimeMillis:I+g,issuedAtTimeMillis:I}})).apply(this,arguments)}function mi(n,e){const{projectId:t,appId:r,apiKey:o}=n.options;return{url:`${In}/projects/${t}/apps/${r}:${Cl}?key=${o}`,body:{debug_token:e}}}const Al="firebase-app-check-database",Br=1,Cn="firebase-app-check-store";let vi=null;function ko(){return(ko=(0,v.Z)(function*(n,e){const r=(yield function yi(){return vi||(vi=new Promise((n,e)=>{try{const t=indexedDB.open(Al,Br);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var o;e(X.create("storage-open",{originalErrorMessage:null===(o=r.target.error)||void 0===o?void 0:o.message}))},t.onupgradeneeded=r=>{0===r.oldVersion&&r.target.result.createObjectStore(Cn,{keyPath:"compositeKey"})}}catch(t){e(X.create("storage-open",{originalErrorMessage:t?.message}))}}),vi)}()).transaction(Cn,"readwrite"),u=r.objectStore(Cn).put({compositeKey:n,value:e});return new Promise((c,h)=>{u.onsuccess=p=>{c()},r.onerror=p=>{var g;h(X.create("storage-set",{originalErrorMessage:null===(g=p.target.error)||void 0===g?void 0:g.message}))}})})).apply(this,arguments)}const $t=new Zt.Yd("@firebase/app-check");function Ii(n,e){return(0,_.hl)()?function tt(n,e){return function ue(n,e){return ko.apply(this,arguments)}(function Rt(n){return`${n.options.appId}-${n.name}`}(n),e)}(n,e).catch(t=>{$t.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Ei(){return pi().enabled}function Ti(){return nt.apply(this,arguments)}function nt(){return(nt=(0,v.Z)(function*(){const n=pi();if(n.enabled&&n.token)return n.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")})).apply(this,arguments)}const Sl={error:"UNKNOWN_ERROR"};function kl(n){return _.US.encodeString(JSON.stringify(n),!1)}function Rn(n){return Gr.apply(this,arguments)}function Gr(){return(Gr=(0,v.Z)(function*(n,e=!1){const t=n.app;Vr(t);const r=Y(t);let u,o=r.token;if(o&&!kt(o)&&(r.token=void 0,o=void 0),!o){const p=yield r.cachedTokenPromise;p&&(kt(p)?o=p:yield Ii(t,void 0))}if(!e&&o&&kt(o))return{token:o.token};let h,c=!1;if(Ei()){r.exchangeTokenPromise||(r.exchangeTokenPromise=gi(mi(t,yield Ti()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),c=!0);const p=yield r.exchangeTokenPromise;return yield Ii(t,p),r.token=p,{token:p.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),c=!0),o=yield Y(t).exchangeTokenPromise}catch(p){"appCheck/throttled"===p.code?$t.warn(p.message):$t.error(p),u=p}return o?u?h=kt(o)?{token:o.token,internalError:u}:Oo(u):(h={token:o.token},r.token=o,yield Ii(t,o)):h=Oo(u),c&&function Kr(n,e){const t=Y(n).tokenObservers;for(const r of t)try{"EXTERNAL"===r.type&&null!=e.error?r.error(e.error):r.next(e)}catch{}}(t,h),h})).apply(this,arguments)}function zr(n){return Zr.apply(this,arguments)}function Zr(){return(Zr=(0,v.Z)(function*(n){const e=n.app;Vr(e);const{provider:t}=Y(e);if(Ei()){const r=yield Ti(),{token:o}=yield gi(mi(e,r),n.heartbeatServiceProvider);return{token:o}}{const{token:r}=yield t.getToken();return{token:r}}})).apply(this,arguments)}function Ci(n,e){const t=Y(n),r=t.tokenObservers.filter(o=>o.next!==e);0===r.length&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function wi(n){const{app:e}=n,t=Y(e);let r=t.tokenRefresher;r||(r=function No(n){const{app:e}=n;return new hc((0,v.Z)(function*(){let r;if(r=Y(e).token?yield Rn(n,!0):yield Rn(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{const t=Y(e);if(t.token){let r=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5;return r=Math.min(r,t.token.expireTimeMillis-3e5),Math.max(0,r-Date.now())}return 0},_i.RETRIAL_MIN_WAIT,_i.RETRIAL_MAX_WAIT)}(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function kt(n){return n.expireTimeMillis-Date.now()>0}function Oo(n){return{token:kl(Sl),error:n}}class $r{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=Y(this.app);for(const t of e)Ci(this.app,t.next);return Promise.resolve()}}const Si="app-check-internal";!function xl(){(0,Z.Xd)(new He.wA("app-check",n=>function Do(n,e){return new $r(n,e)}(n.getProvider("app").getImmediate(),n.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Si).initialize()})),(0,Z.Xd)(new He.wA(Si,n=>function bl(n){return{getToken:e=>Rn(n,e),getLimitedUseToken:()=>zr(n),addTokenListener:e=>function Sn(n,e,t,r){const{app:o}=n,u=Y(o);if(u.tokenObservers=[...u.tokenObservers,{next:t,error:r,type:e}],u.token&&kt(u.token)){const h=u.token;Promise.resolve().then(()=>{t({token:h.token}),wi(n)}).catch(()=>{})}u.cachedTokenPromise.then(()=>wi(n))}(n,"INTERNAL",e),removeTokenListener:e=>Ci(n.app,e)}}(n.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),(0,Z.KN)("@firebase/app-check","0.8.0")}();class Pn{constructor(){return(0,Te.vb)("app-check")}}typeof window<"u"&&window,O(120);const jo=new N.OlP("angularfire2.auth.use-emulator"),Pi=new N.OlP("angularfire2.auth.settings"),qo=new N.OlP("angularfire2.auth.tenant-id"),Yo=new N.OlP("angularfire2.auth.langugage-code"),Ni=new N.OlP("angularfire2.auth.use-device-language"),rt=new N.OlP("angularfire.auth.persistence"),Qo=(n,e,t,r,o,u,c,h)=>(0,fe.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const p=e.runOutsideAngular(()=>n.auth());if(t&&p.useEmulator(...t),r&&(p.tenantId=r),p.languageCode=o,u&&p.useDeviceLanguage(),c)for(const[g,I]of Object.entries(c))p.settings[g]=I;return h&&p.setPersistence(h),p},[t,r,o,u,c,h]);let ns=(()=>{class n{constructor(t,r,o,u,c,h,p,g,I,E,T,b){const P=new w.x,F=(0,de.of)(void 0).pipe((0,xr.Q)(c.outsideAngular),(0,he.w)(()=>u.runOutsideAngular(()=>Promise.resolve().then(O.bind(O,8977)))),(0,et.U)(()=>(0,fe.on)(t,u,r)),(0,et.U)(Q=>Qo(Q,u,h,g,I,E,p,T)),Lr({bufferSize:1,refCount:!1}));if((0,ne.PM)(o))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,de.of)(null);else{F.pipe((0,yl.P)()).subscribe();const me=F.pipe((0,he.w)(re=>re.getRedirectResult().then(Bt=>Bt,()=>null)),Te.iC,Lr({bufferSize:1,refCount:!1})),Ne=F.pipe((0,he.w)(re=>new gn.y(Bt=>({unsubscribe:u.runOutsideAngular(()=>re.onAuthStateChanged(li=>Bt.next(li),li=>Bt.error(li),()=>Bt.complete()))})))),Tt=F.pipe((0,he.w)(re=>new gn.y(Bt=>({unsubscribe:u.runOutsideAngular(()=>re.onIdTokenChanged(li=>Bt.next(li),li=>Bt.error(li),()=>Bt.complete()))}))));this.authState=me.pipe(Mr(Ne),(0,Io.R)(c.outsideAngular),(0,xr.Q)(c.insideAngular)),this.user=me.pipe(Mr(Tt),(0,Io.R)(c.outsideAngular),(0,xr.Q)(c.insideAngular)),this.idToken=this.user.pipe((0,he.w)(re=>re?(0,ui.D)(re.getIdToken()):(0,de.of)(null))),this.idTokenResult=this.user.pipe((0,he.w)(re=>re?(0,ui.D)(re.getIdTokenResult()):(0,de.of)(null))),this.credential=(0,mn.T)(me,P,this.authState.pipe((0,ci.h)(re=>!re))).pipe((0,et.U)(re=>re?.user?re:null),(0,Io.R)(c.outsideAngular),(0,xr.Q)(c.insideAngular))}return(0,fe.pX)(this,F,u,{spy:{apply:(Q,me,Ne)=>{(Q.startsWith("signIn")||Q.startsWith("createUser"))&&Ne.then(Tt=>P.next(Tt))}}})}}return n.\u0275fac=function(t){return new(t||n)(N.LFG(fe.Dh),N.LFG(fe.xv,8),N.LFG(N.Lbi),N.LFG(N.R0b),N.LFG(Te.HU),N.LFG(jo,8),N.LFG(Pi,8),N.LFG(qo,8),N.LFG(Yo,8),N.LFG(Ni,8),N.LFG(rt,8),N.LFG(Pn,8))},n.\u0275prov=N.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();var yc=O(6321),Di=O(6699),Ze=O(3997),Pt=O(9360),st=O(8251),Jo=O(4829),Xo=O(2737),ea=O(2420),Ml=O(4564);O(8977);var ta=O(3399),Nt=O(4268);const xi="@firebase/database";let Li="";function na(n){Li=n}class rs{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,_.Wl)(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,_.cI)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Mi{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return(0,_.r3)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const ss=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new rs(e)}}catch{}return new Mi},ot=ss("localStorage"),os=ss("sessionStorage"),at=new Zt.Yd("@firebase/database"),Fi=function(){let n=1;return function(){return n++}}(),Ui=function(n){const e=(0,_.dS)(n),t=new _.gQ;t.update(e);const r=t.digest();return _.US.encodeByteArray(r)},lt=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?e+=lt.apply(null,r):e+="object"==typeof r?(0,_.Wl)(r):r,e+=" "}return e};let Ke=null,as=!0;const Wi=function(n,e){(0,_.hu)(!e||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(at.logLevel=Zt.in.VERBOSE,Ke=at.log.bind(at),e&&os.set("logging_enabled",!0)):"function"==typeof n?Ke=n:(Ke=null,os.remove("logging_enabled"))},ee=function(...n){if(!0===as&&(as=!1,null===Ke&&!0===os.get("logging_enabled")&&Wi(!0)),Ke){const e=lt.apply(null,n);Ke(e)}},Ot=function(n){return function(...e){ee(n,...e)}},qt=function(...n){const e="FIREBASE INTERNAL ERROR: "+lt(...n);at.error(e)},ye=function(...n){const e=`FIREBASE FATAL ERROR: ${lt(...n)}`;throw at.error(e),new Error(e)},se=function(...n){const e="FIREBASE WARNING: "+lt(...n);at.warn(e)},On=function(n){return"number"==typeof n&&(n!=n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},ut="[MIN_NAME]",Ae="[MAX_NAME]",Dt=function(n,e){if(n===e)return 0;if(n===ut||e===Ae)return-1;if(e===ut||n===Ae)return 1;{const t=Hi(n),r=Hi(e);return null!==t?null!==r?t-r==0?n.length-e.length:t-r:-1:null!==r?1:n<e?-1:1}},cs=function(n,e){return n===e?0:n<e?-1:1},$e=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+(0,_.Wl)(e))},Dn=function(n){if("object"!=typeof n||null===n)return(0,_.Wl)(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)0!==r&&(t+=","),t+=(0,_.Wl)(e[r]),t+=":",t+=Dn(n[e[r]]);return t+="}",t},Vi=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let o=0;o<t;o+=e)r.push(n.substring(o,o+e>t?t:o+e));return r};function $(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const ia=function(n){(0,_.hu)(!On(n),"Invalid JSON number");const r=1023;let o,u,c,h,p;0===n?(u=0,c=0,o=1/n==-1/0?1:0):(o=n<0,(n=Math.abs(n))>=Math.pow(2,1-r)?(h=Math.min(Math.floor(Math.log(n)/Math.LN2),r),u=h+r,c=Math.round(n*Math.pow(2,52-h)-Math.pow(2,52))):(u=0,c=Math.round(n/Math.pow(2,-1074))));const g=[];for(p=52;p;p-=1)g.push(c%2?1:0),c=Math.floor(c/2);for(p=11;p;p-=1)g.push(u%2?1:0),u=Math.floor(u/2);g.push(o?1:0),g.reverse();const I=g.join("");let E="";for(p=0;p<64;p+=8){let T=parseInt(I.substr(p,8),2).toString(16);1===T.length&&(T="0"+T),E+=T}return E.toLowerCase()},Wl=new RegExp("^-?(0*)\\d{1,10}$"),Hi=function(n){if(Wl.test(n)){const e=Number(n);if(e>=-2147483648&&e<=2147483647)return e}return null},Yt=function(n){try{n()}catch(e){setTimeout(()=>{throw se("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},xn=function(n,e){const t=setTimeout(n,e);return"number"==typeof t&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):"object"==typeof t&&t.unref&&t.unref(),t};class _s{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){se(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Vl{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(o=>this.auth_=o)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&"auth/token-not-initialized"===t.code?(ee("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';e+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',se(e)}}let Ln=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}return n.OWNER="owner",n})();const Gi=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Zi="websocket",ua="long_polling";class Mn{constructor(e,t,r,o,u=!1,c="",h=!1,p=!1){this.secure=t,this.namespace=r,this.webSocketOnly=o,this.nodeAdmin=u,this.persistenceKey=c,this.includeNamespaceInQueryParams=h,this.isUsingEmulator=p,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ot.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ot.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function Ki(n,e,t){let r;if((0,_.hu)("string"==typeof e,"typeof type must == string"),(0,_.hu)("object"==typeof t,"typeof params must == object"),e===Zi)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else{if(e!==ua)throw new Error("Unknown connection type: "+e);r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?"}(function Hl(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams})(n)&&(t.ns=n.namespace);const o=[];return $(t,(u,c)=>{o.push(u+"="+c)}),r+o.join("&")}class Bl{constructor(){this.counters_={}}incrementCounter(e,t=1){(0,_.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return(0,_.p$)(this.counters_)}}const Fn={},ms={};function vs(n){const e=n.toString();return Fn[e]||(Fn[e]=new Bl),Fn[e]}class ys{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let o=0;o<r.length;++o)r[o]&&Yt(()=>{this.onMessage_(r[o])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class De{constructor(e,t,r,o,u,c,h){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=o,this.authToken=u,this.transportSessionId=c,this.lastSessionId=h,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ot(e),this.stats_=vs(t),this.urlFn=p=>(this.appCheckToken&&(p.ac=this.appCheckToken),Ki(t,ua,p))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new ys(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(n){if((0,_.Yr)()||"complete"===document.readyState)n();else{let e=!1;const t=function(){document.body?e||(e=!0,n()):setTimeout(t,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&t()}),window.attachEvent("onload",t))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new je((...u)=>{const[c,h,p,g,I]=u;if(this.incrementIncomingBytes_(u),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===c)this.id=h,this.password=p;else{if("close"!==c)throw new Error("Unrecognized command received: "+c);h?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(h,()=>{this.onClosed_()})):this.onClosed_()}},(...u)=>{const[c,h]=u;this.incrementIncomingBytes_(u),this.myPacketOrderer.handleResponse(c,h)},()=>{this.onClosed_()},this.urlFn);const r={start:"t"};r.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(r.cb=this.scriptTagHolder.uniqueCallbackIdentifier),r.v="5",this.transportSessionId&&(r.s=this.transportSessionId),this.lastSessionId&&(r.ls=this.lastSessionId),this.applicationId&&(r.p=this.applicationId),this.appCheckToken&&(r.ac=this.appCheckToken),typeof location<"u"&&location.hostname&&Gi.test(location.hostname)&&(r.r="f");const o=this.urlFn(r);this.log_("Connecting via long-poll to "+o),this.scriptTagHolder.addTag(o,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){De.forceAllow_=!0}static forceDisallow(){De.forceDisallow_=!0}static isAvailable(){return!((0,_.Yr)()||!De.forceAllow_&&(De.forceDisallow_||!(typeof document<"u")||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=(0,_.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=(0,_.h$)(t),o=Vi(r,1840);for(let u=0;u<o.length;u++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,o.length,o[u]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if((0,_.Yr)())return;this.myDisconnFrame=document.createElement("iframe");const r={dframe:"t"};r.id=e,r.pw=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=(0,_.Wl)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class je{constructor(e,t,r,o){if(this.onDisconnect=r,this.urlFn=o,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,_.Yr)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Fi(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=je.createIFrame_();let u="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(u='<script>document.domain="'+document.domain+'";<\/script>');const c="<html><body>"+u+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(c),this.myIFrame.doc.close()}catch(h){ee("frame writing exception"),h.stack&&ee(h.stack),ee(h)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||ee("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),r="",o=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+r.length<=1870;){const c=this.pendingSegs.shift();r=r+"&seg"+o+"="+c.seg+"&ts"+o+"="+c.ts+"&d"+o+"="+c.d,o++}return t+=r,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},o=setTimeout(r,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(o),r()})}addTag(e,t){(0,_.Yr)()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const o=r.readyState;(!o||"loaded"===o||"complete"===o)&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{ee("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}let $i=null;typeof MozWebSocket<"u"?$i=MozWebSocket:typeof WebSocket<"u"&&($i=WebSocket);let Xt=(()=>{class n{constructor(t,r,o,u,c,h,p){this.connId=t,this.applicationId=o,this.appCheckToken=u,this.authToken=c,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ot(this.connId),this.stats_=vs(r),this.connURL=n.connectionURL_(r,h,p,u,o),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,o,u,c){const h={v:"5"};return!(0,_.Yr)()&&typeof location<"u"&&location.hostname&&Gi.test(location.hostname)&&(h.r="f"),r&&(h.s=r),o&&(h.ls=o),u&&(h.ac=u),c&&(h.p=c),Ki(t,Zi,h)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ot.set("previous_websocket_failure",!0);try{let o;if((0,_.Yr)()){o={headers:{"User-Agent":`Firebase/5/${Li}/${process.platform}/${this.nodeAdmin?"AdminNode":"Node"}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(o.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(o.headers["X-Firebase-AppCheck"]=this.appCheckToken);const c=process.env,h=0===this.connURL.indexOf("wss://")?c.HTTPS_PROXY||c.https_proxy:c.HTTP_PROXY||c.http_proxy;h&&(o.proxy={origin:h})}this.mySock=new $i(this.connURL,[],o)}catch(o){this.log_("Error instantiating WebSocket.");const u=o.message||o.data;return u&&this.log_(u),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=o=>{this.handleIncomingFrame(o)},this.mySock.onerror=o=>{this.log_("WebSocket error.  Closing connection.");const u=o.message||o.data;u&&this.log_(u),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){const o=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);o&&o.length>1&&parseFloat(o[1])<4.4&&(t=!0)}return!t&&null!==$i&&!n.forceDisallow_}static previouslyFailed(){return ot.isInMemoryStorage||!0===ot.get("previous_websocket_failure")}markConnectionHealthy(){ot.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const r=this.frames.join("");this.frames=null;const o=(0,_.cI)(r);this.onMessage(o)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if((0,_.hu)(null===this.frames,"We already have a frame buffer"),t.length<=6){const r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(r);else{const o=this.extractFrameCount_(r);null!==o&&this.appendFrame_(o)}}send(t){this.resetKeepAlive();const r=(0,_.Wl)(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);const o=Vi(r,16384);o.length>1&&this.sendString_(String(o.length));for(let u=0;u<o.length;u++)this.sendString_(o[u])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),Yl=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[De,Xt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){const r=Xt&&Xt.isAvailable();let o=r&&!Xt.previouslyFailed();if(t.webSocketOnly&&(r||se("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[Xt];else{const u=this.transports_=[];for(const c of n.ALL_TRANSPORTS)c&&c.isAvailable()&&u.push(c);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}return n.globalTransportInitialized_=!1,n})();class ya{constructor(e,t,r,o,u,c,h,p,g,I){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=o,this.authToken_=u,this.onMessage_=c,this.onReady_=h,this.onDisconnect_=p,this.onKill_=g,this.lastSessionId=I,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ot("c:"+this.id+":"),this.transportManager_=new Yl(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const o=e.healthyTimeout||0;o>0&&(this.healthyTimeout_=xn(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(o)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=$e("t",e),r=$e("d",e);if("c"===t)this.onSecondaryControl_(r);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(r)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=$e("t",e),r=$e("d",e);"c"===t?this.onControl_(r):"d"===t&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=$e("t",e);if("d"in e){const r=e.d;if("h"===t){const o=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(o.h=this.repoInfo_.host),this.onHandshake_(o)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let o=0;o<this.pendingDataMessages.length;++o)this.onDataMessage_(this.pendingDataMessages[o]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(r):"r"===t?this.onReset_(r):"e"===t?qt("Server Error: "+r):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):qt("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,o=e.h;this.sessionId=e.s,this.repoInfo_.host=o,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==r&&se("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),xn(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):xn(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ot.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Ia{put(e,t,r,o){}merge(e,t,r,o){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}class en{constructor(e){this.allowedEvents_=e,this.listeners_={},(0,_.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let o=0;o<r.length;o++)r[o].callback.apply(r[o].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const o=this.getInitialEvent(e);o&&t.apply(r,o)}off(e,t,r){this.validateEventType_(e);const o=this.listeners_[e]||[];for(let u=0;u<o.length;u++)if(o[u].callback===t&&(!r||r===o[u].context))return void o.splice(u,1)}validateEventType_(e){(0,_.hu)(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class ji extends en{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!(0,_.uI)()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new ji}getInitialEvent(e){return(0,_.hu)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class U{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let r=0;for(let o=0;o<this.pieces_.length;o++)this.pieces_[o].length>0&&(this.pieces_[r]=this.pieces_[o],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function W(){return new U("")}function L(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function dt(n){return n.pieces_.length-n.pieceNum_}function B(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new U(n.pieces_,e)}function qi(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function ht(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function ws(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new U(e,0)}function V(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof U)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let o=0;o<r.length;o++)r[o].length>0&&t.push(r[o])}return new U(t,0)}function x(n){return n.pieceNum_>=n.pieces_.length}function oe(n,e){const t=L(n),r=L(e);if(null===t)return e;if(t===r)return oe(B(n),B(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function As(n,e){const t=ht(n,0),r=ht(e,0);for(let o=0;o<t.length&&o<r.length;o++){const u=Dt(t[o],r[o]);if(0!==u)return u}return t.length===r.length?0:t.length<r.length?-1:1}function Yi(n,e){if(dt(n)!==dt(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function ce(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(dt(n)>dt(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class iu{constructor(e,t){this.errorPrefix_=t,this.parts_=ht(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=(0,_.ug)(this.parts_[r]);Ca(this)}}function Ca(n){if(n.byteLength_>768)throw new Error(n.errorPrefix_+"has a key path longer than 768 bytes ("+n.byteLength_+").");if(n.parts_.length>32)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+xt(n))}function xt(n){return 0===n.parts_.length?"":"in property '"+n.parts_.join(".")+"'"}class wa extends en{constructor(){let e,t;super(["visible"]),typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new wa}getInitialEvent(e){return(0,_.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]}}const xe=1e3;let tn,Lt=(()=>{class n extends Ia{constructor(t,r,o,u,c,h,p,g){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=o,this.onConnectStatus_=u,this.onServerInfoUpdate_=c,this.authTokenProvider_=h,this.appCheckTokenProvider_=p,this.authOverride_=g,this.id=n.nextPersistentConnectionId_++,this.log_=Ot("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=xe,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,g&&!(0,_.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");wa.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&ji.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,o){const u=++this.requestNumber_,c={r:u,a:t,b:r};this.log_((0,_.Wl)(c)),(0,_.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(c),o&&(this.requestCBHash_[u]=o)}get(t){this.initConnection_();const r=new _.BH,u={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:h=>{const p=h.d;"ok"===h.s?r.resolve(p):r.reject(p)}};return this.outstandingGets_.push(u),this.outstandingGetCount_++,this.connected_&&this.sendGet_(this.outstandingGets_.length-1),r.promise}listen(t,r,o,u){this.initConnection_();const c=t._queryIdentifier,h=t._path.toString();this.log_("Listen called for "+h+" "+c),this.listens.has(h)||this.listens.set(h,new Map),(0,_.hu)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,_.hu)(!this.listens.get(h).has(c),"listen() called twice for same path/queryId.");const p={onComplete:u,hashFn:r,query:t,tag:o};this.listens.get(h).set(c,p),this.connected_&&this.sendListen_(p)}sendGet_(t){const r=this.outstandingGets_[t];this.sendRequest("g",r.request,o=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(o)})}sendListen_(t){const r=t.query,o=r._path.toString(),u=r._queryIdentifier;this.log_("Listen on "+o+" for "+u);const c={p:o};t.tag&&(c.q=r._queryObject,c.t=t.tag),c.h=t.hashFn(),this.sendRequest("q",c,p=>{const g=p.d,I=p.s;n.warnOnListenWarnings_(g,r),(this.listens.get(o)&&this.listens.get(o).get(u))===t&&(this.log_("listen response",p),"ok"!==I&&this.removeListen_(o,u),t.onComplete&&t.onComplete(I,g))})}static warnOnListenWarnings_(t,r){if(t&&"object"==typeof t&&(0,_.r3)(t,"w")){const o=(0,_.DV)(t,"w");if(Array.isArray(o)&&~o.indexOf("no_index")){const u='".indexOn": "'+r._queryParams.getIndex().toString()+'"',c=r._path.toString();se(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${u} at ${c} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||(0,_.GJ)(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,r=(0,_.w9)(t)?"auth":"gauth",o={cred:t};null===this.authOverride_?o.noauth=!0:"object"==typeof this.authOverride_&&(o.authvar=this.authOverride_),this.sendRequest(r,o,u=>{const c=u.s,h=u.d||"error";this.authToken_===t&&("ok"===c?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(c,h))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const r=t.s,o=t.d||"error";"ok"===r?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,o)})}unlisten(t,r){const o=t._path.toString(),u=t._queryIdentifier;this.log_("Unlisten called for "+o+" "+u),(0,_.hu)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(o,u)&&this.connected_&&this.sendUnlisten_(o,u,t._queryObject,r)}sendUnlisten_(t,r,o,u){this.log_("Unlisten on "+t+" for "+r);const c={p:t};u&&(c.q=o,c.t=u),this.sendRequest("n",c)}onDisconnectPut(t,r,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,o):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:o})}onDisconnectMerge(t,r,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,o):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:o})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,o,u){const c={p:r,d:o};this.log_("onDisconnect "+t,c),this.sendRequest(t,c,h=>{u&&setTimeout(()=>{u(h.s,h.d)},Math.floor(0))})}put(t,r,o,u){this.putInternal("p",t,r,o,u)}merge(t,r,o,u){this.putInternal("m",t,r,o,u)}putInternal(t,r,o,u,c){this.initConnection_();const h={p:r,d:o};void 0!==c&&(h.h=c),this.outstandingPuts_.push({action:t,request:h,onComplete:u}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+r)}sendPut_(t){const r=this.outstandingPuts_[t].action,o=this.outstandingPuts_[t].request,u=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,o,c=>{this.log_(r+" response",c),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),u&&u(c.s,c.d)})}reportStats(t){if(this.connected_){const r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,o=>{"ok"!==o.s&&this.log_("reportStats","Error sending stats: "+o.d)})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+(0,_.Wl)(t));const r=t.r,o=this.requestCBHash_[r];o&&(delete this.requestCBHash_[r],o(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),"d"===t?this.onDataUpdate_(r.p,r.d,!1,r.t):"m"===t?this.onDataUpdate_(r.p,r.d,!0,r.t):"c"===t?this.onListenRevoked_(r.p,r.q):"ac"===t?this.onAuthRevoked_(r.s,r.d):"apc"===t?this.onAppCheckRevoked_(r.s,r.d):"sd"===t?this.onSecurityDebugPacket_(r):qt("Unrecognized action received from server: "+(0,_.Wl)(t)+"\nAre you using the latest client?")}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){(0,_.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=xe,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=xe,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=xe),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const t=(new Date).getTime()-this.lastConnectionAttemptTime_;let r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var t=this;return(0,v.Z)(function*(){if(t.shouldReconnect_()){t.log_("Making a connection attempt"),t.lastConnectionAttemptTime_=(new Date).getTime(),t.lastConnectionEstablishedTime_=null;const r=t.onDataMessage_.bind(t),o=t.onReady_.bind(t),u=t.onRealtimeDisconnect_.bind(t),c=t.id+":"+n.nextConnectionId_++,h=t.lastSessionId;let p=!1,g=null;const I=function(){g?g.close():(p=!0,u())};t.realtime_={close:I,sendRequest:function(b){(0,_.hu)(g,"sendRequest call when we're not connected not allowed."),g.sendRequest(b)}};const T=t.forceTokenRefresh_;t.forceTokenRefresh_=!1;try{const[b,P]=yield Promise.all([t.authTokenProvider_.getToken(T),t.appCheckTokenProvider_.getToken(T)]);p?ee("getToken() completed but was canceled"):(ee("getToken() completed. Creating connection."),t.authToken_=b&&b.accessToken,t.appCheckToken_=P&&P.token,g=new ya(c,t.repoInfo_,t.applicationId_,t.appCheckToken_,t.authToken_,r,o,u,F=>{se(F+" ("+t.repoInfo_.toString()+")"),t.interrupt("server_kill")},h))}catch(b){t.log_("Failed to get token: "+b),p||(t.repoInfo_.nodeAdmin&&se(b),I())}}})()}interrupt(t){ee("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){ee("Resuming connection for reason: "+t),delete this.interruptReasons_[t],(0,_.xb)(this.interruptReasons_)&&(this.reconnectDelay_=xe,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const r=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let o;o=r?r.map(c=>Dn(c)).join("$"):"default";const u=this.removeListen_(t,o);u&&u.onComplete&&u.onComplete("permission_denied")}removeListen_(t,r){const o=new U(t).toString();let u;if(this.listens.has(o)){const c=this.listens.get(o);u=c.get(r),c.delete(r),0===c.size&&this.listens.delete(o)}else u=void 0;return u}onAuthRevoked_(t,r){ee("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===t||"permission_denied"===t)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){ee("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===t||"permission_denied"===t)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let r="js";(0,_.Yr)()&&(r=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+r+"."+Li.replace(/\./g,"-")]=1,(0,_.uI)()?t["framework.cordova"]=1:(0,_.b$)()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=ji.getInstance().currentlyOnline();return(0,_.xb)(this.interruptReasons_)&&t}}return n.nextPersistentConnectionId_=0,n.nextConnectionId_=0,n})();class M{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new M(e,t)}}class Qi{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new M(ut,e),o=new M(ut,t);return 0!==this.compare(r,o)}minPost(){return M.MIN}}class Ra extends Qi{static get __EMPTY_NODE(){return tn}static set __EMPTY_NODE(e){tn=e}compare(e,t){return Dt(e.name,t.name)}isDefinedOn(e){throw(0,_.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return M.MIN}maxPost(){return new M(Ae,tn)}makePost(e,t){return(0,_.hu)("string"==typeof e,"KeyIndex indexValue must always be a string."),new M(e,tn)}toString(){return".key"}}const Le=new Ra;class Ji{constructor(e,t,r,o,u=null){this.isReverse_=o,this.resultGenerator_=u,this.nodeStack_=[];let c=1;for(;!e.isEmpty();)if(c=t?r(e.key,t):1,o&&(c*=-1),c<0)e=this.isReverse_?e.left:e.right;else{if(0===c){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}let ks,Re=(()=>{class n{constructor(t,r,o,u,c){this.key=t,this.value=r,this.color=o??n.RED,this.left=u??ae.EMPTY_NODE,this.right=c??ae.EMPTY_NODE}copy(t,r,o,u,c){return new n(t??this.key,r??this.value,o??this.color,u??this.left,c??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,o){let u=this;const c=o(t,u.key);return u=c<0?u.copy(null,null,null,u.left.insert(t,r,o),null):0===c?u.copy(null,r,null,null,null):u.copy(null,null,null,null,u.right.insert(t,r,o)),u.fixUp_()}removeMin_(){if(this.left.isEmpty())return ae.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let o,u;if(o=this,r(t,o.key)<0)!o.left.isEmpty()&&!o.left.isRed_()&&!o.left.left.isRed_()&&(o=o.moveRedLeft_()),o=o.copy(null,null,null,o.left.remove(t,r),null);else{if(o.left.isRed_()&&(o=o.rotateRight_()),!o.right.isEmpty()&&!o.right.isRed_()&&!o.right.left.isRed_()&&(o=o.moveRedRight_()),0===r(t,o.key)){if(o.right.isEmpty())return ae.EMPTY_NODE;u=o.right.min_(),o=o.copy(u.key,u.value,null,null,o.right.removeMin_())}o=o.copy(null,null,null,null,o.right.remove(t,r))}return o.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})();class ae{constructor(e,t=ae.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new ae(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Re.BLACK,null,null))}remove(e){return new ae(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Re.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),0===t)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,o=null;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),0===t){if(r.left.isEmpty())return o?o.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}t<0?r=r.left:t>0&&(o=r,r=r.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ji(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ji(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ji(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ji(this.root_,null,this.comparator_,!0,e)}}function uu(n,e){return Dt(n.name,e.name)}function Ss(n,e){return Dt(n,e)}ae.EMPTY_NODE=new class lu{copy(e,t,r,o,u){return this}insert(e,t,r){return new Re(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Sa=function(n){return"number"==typeof n?"number:"+ia(n):"string:"+n},Xi=function(n){if(n.isLeafNode()){const e=n.val();(0,_.hu)("string"==typeof e||"number"==typeof e||"object"==typeof e&&(0,_.r3)(e,".sv"),"Priority must be a string or number.")}else(0,_.hu)(n===ks||n.isEmpty(),"priority of unexpected type.");(0,_.hu)(n===ks||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let ka,ba,er,ft=(()=>{class n{constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,(0,_.hu)(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),Xi(this.priorityNode_)}static set __childrenNodeConstructor(t){ka=t}static get __childrenNodeConstructor(){return ka}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return x(t)?this:".priority"===L(t)?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return".priority"===t?this.updatePriority(r):r.isEmpty()&&".priority"!==t?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){const o=L(t);return null===o?r:r.isEmpty()&&".priority"!==o?this:((0,_.hu)(".priority"!==o||1===dt(t),".priority must be the last token in a path"),this.updateImmediateChild(o,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(B(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Sa(this.priorityNode_.val())+":");const r=typeof this.value_;t+=r+":",t+="number"===r?ia(this.value_):this.value_,this.lazyHash_=Ui(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:((0,_.hu)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const r=typeof t.value_,o=typeof this.value_,u=n.VALUE_TYPE_ORDER.indexOf(r),c=n.VALUE_TYPE_ORDER.indexOf(o);return(0,_.hu)(u>=0,"Unknown leaf type: "+r),(0,_.hu)(c>=0,"Unknown leaf type: "+o),u===c?"object"===o?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:c-u}withIndex(){return this}isIndexed(){return!0}equals(t){return t===this||!!t.isLeafNode()&&(this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_))}}return n.VALUE_TYPE_ORDER=["object","boolean","number","string"],n})();const H=new class cu extends Qi{compare(e,t){const r=e.node.getPriority(),o=t.node.getPriority(),u=r.compareTo(o);return 0===u?Dt(e.name,t.name):u}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return M.MIN}maxPost(){return new M(Ae,new ft("[PRIORITY-POST]",er))}makePost(e,t){const r=ba(e);return new M(t,new ft("[PRIORITY-POST]",r))}toString(){return".priority"}},Hn=Math.log(2);class Mt{constructor(e){this.count=parseInt(Math.log(e+1)/Hn,10),this.current_=this.count-1;const o=(u=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=e+1&o}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const nn=function(n,e,t,r){n.sort(e);const o=function(p,g){const I=g-p;let E,T;if(0===I)return null;if(1===I)return E=n[p],T=t?t(E):E,new Re(T,E.node,Re.BLACK,null,null);{const b=parseInt(I/2,10)+p,P=o(p,b),F=o(b+1,g);return E=n[b],T=t?t(E):E,new Re(T,E.node,Re.BLACK,P,F)}},h=function(p){let g=null,I=null,E=n.length;const T=function(P,F){const Q=E-P,me=E;E-=P;const Ne=o(Q+1,me),Tt=n[Q],re=t?t(Tt):Tt;b(new Re(re,Tt.node,F,null,Ne))},b=function(P){g?(g.left=P,g=P):(I=P,g=P)};for(let P=0;P<p.count;++P){const F=p.nextBitIsOne(),Q=Math.pow(2,p.count-(P+1));F?T(Q,Re.BLACK):(T(Q,Re.BLACK),T(Q,Re.RED))}return I}(new Mt(n.length));return new ae(r||e,h)};let Ns;const rn={};class qe{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return(0,_.hu)(rn&&H,"ChildrenNode.ts has not been loaded"),Ns=Ns||new qe({".priority":rn},{".priority":H}),Ns}get(e){const t=(0,_.DV)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ae?t:null}hasIndex(e){return(0,_.r3)(this.indexSet_,e.toString())}addIndex(e,t){(0,_.hu)(e!==Le,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let o=!1;const u=t.getIterator(M.Wrap);let h,c=u.getNext();for(;c;)o=o||e.isDefinedOn(c.node),r.push(c),c=u.getNext();h=o?nn(r,e.getCompare()):rn;const p=e.toString(),g=Object.assign({},this.indexSet_);g[p]=e;const I=Object.assign({},this.indexes_);return I[p]=h,new qe(I,g)}addToIndexes(e,t){const r=(0,_.UI)(this.indexes_,(o,u)=>{const c=(0,_.DV)(this.indexSet_,u);if((0,_.hu)(c,"Missing index implementation for "+u),o===rn){if(c.isDefinedOn(e.node)){const h=[],p=t.getIterator(M.Wrap);let g=p.getNext();for(;g;)g.name!==e.name&&h.push(g),g=p.getNext();return h.push(e),nn(h,c.getCompare())}return rn}{const h=t.get(e.name);let p=o;return h&&(p=p.remove(new M(e.name,h))),p.insert(e,e.node)}});return new qe(r,this.indexSet_)}removeFromIndexes(e,t){const r=(0,_.UI)(this.indexes_,o=>{if(o===rn)return o;{const u=t.get(e.name);return u?o.remove(new M(e.name,u)):o}});return new qe(r,this.indexSet_)}}let Ft,D=(()=>{class n{constructor(t,r,o){this.children_=t,this.priorityNode_=r,this.indexMap_=o,this.lazyHash_=null,this.priorityNode_&&Xi(this.priorityNode_),this.children_.isEmpty()&&(0,_.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Ft||(Ft=new n(new ae(Ss),null,qe.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ft}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const r=this.children_.get(t);return null===r?Ft:r}}getChild(t){const r=L(t);return null===r?this:this.getImmediateChild(r).getChild(B(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,r){if((0,_.hu)(r,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(r);{const o=new M(t,r);let u,c;r.isEmpty()?(u=this.children_.remove(t),c=this.indexMap_.removeFromIndexes(o,this.children_)):(u=this.children_.insert(t,r),c=this.indexMap_.addToIndexes(o,this.children_));const h=u.isEmpty()?Ft:this.priorityNode_;return new n(u,h,c)}}updateChild(t,r){const o=L(t);if(null===o)return r;{(0,_.hu)(".priority"!==L(t)||1===dt(t),".priority must be the last token in a path");const u=this.getImmediateChild(o).updateChild(B(t),r);return this.updateImmediateChild(o,u)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const r={};let o=0,u=0,c=!0;if(this.forEachChild(H,(h,p)=>{r[h]=p.val(t),o++,c&&n.INTEGER_REGEXP_.test(h)?u=Math.max(u,Number(h)):c=!1}),!t&&c&&u<2*o){const h=[];for(const p in r)h[p]=r[p];return h}return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+Sa(this.getPriority().val())+":"),this.forEachChild(H,(r,o)=>{const u=o.hash();""!==u&&(t+=":"+r+":"+u)}),this.lazyHash_=""===t?"":Ui(t)}return this.lazyHash_}getPredecessorChildName(t,r,o){const u=this.resolveIndex_(o);if(u){const c=u.getPredecessorKey(new M(t,r));return c?c.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const r=this.resolveIndex_(t);if(r){const o=r.minKey();return o&&o.name}return this.children_.minKey()}getFirstChild(t){const r=this.getFirstChildName(t);return r?new M(r,this.children_.get(r)):null}getLastChildName(t){const r=this.resolveIndex_(t);if(r){const o=r.maxKey();return o&&o.name}return this.children_.maxKey()}getLastChild(t){const r=this.getLastChildName(t);return r?new M(r,this.children_.get(r)):null}forEachChild(t,r){const o=this.resolveIndex_(t);return o?o.inorderTraversal(u=>r(u.name,u.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){const o=this.resolveIndex_(r);if(o)return o.getIteratorFrom(t,u=>u);{const u=this.children_.getIteratorFrom(t.name,M.Wrap);let c=u.peek();for(;null!=c&&r.compare(c,t)<0;)u.getNext(),c=u.peek();return u}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){const o=this.resolveIndex_(r);if(o)return o.getReverseIteratorFrom(t,u=>u);{const u=this.children_.getReverseIteratorFrom(t.name,M.Wrap);let c=u.peek();for(;null!=c&&r.compare(c,t)>0;)u.getNext(),c=u.peek();return u}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Bn?-1:0}withIndex(t){if(t===Le||this.indexMap_.hasIndex(t))return this;{const r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===Le||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const r=t;if(this.getPriority().equals(r.getPriority())){if(this.children_.count()===r.children_.count()){const o=this.getIterator(H),u=r.getIterator(H);let c=o.getNext(),h=u.getNext();for(;c&&h;){if(c.name!==h.name||!c.node.equals(h.node))return!1;c=o.getNext(),h=u.getNext()}return null===c&&null===h}return!1}return!1}}resolveIndex_(t){return t===Le?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})();const Bn=new class du extends D{constructor(){super(new ae(Ss),D.EMPTY_NODE,qe.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return D.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(M,{MIN:{value:new M(ut,D.EMPTY_NODE)},MAX:{value:new M(Ae,Bn)}}),Ra.__EMPTY_NODE=D.EMPTY_NODE,ft.__childrenNodeConstructor=D,function bs(n){ks=n}(Bn),function Ps(n){er=n}(Bn);const Os=!0;function j(n,e=null){if(null===n)return D.EMPTY_NODE;if("object"==typeof n&&".priority"in n&&(e=n[".priority"]),(0,_.hu)(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof n&&".value"in n&&null!==n[".value"]&&(n=n[".value"]),"object"!=typeof n||".sv"in n)return new ft(n,j(e));if(n instanceof Array||!Os){let t=D.EMPTY_NODE;return $(n,(r,o)=>{if((0,_.r3)(n,r)&&"."!==r.substring(0,1)){const u=j(o);(u.isLeafNode()||!u.isEmpty())&&(t=t.updateImmediateChild(r,u))}}),t.updatePriority(j(e))}{const t=[];let r=!1;if($(n,(c,h)=>{if("."!==c.substring(0,1)){const p=j(h);p.isEmpty()||(r=r||!p.getPriority().isEmpty(),t.push(new M(c,p)))}}),0===t.length)return D.EMPTY_NODE;const u=nn(t,uu,c=>c.name,Ss);if(r){const c=nn(t,H.getCompare());return new D(u,j(e),new qe({".priority":c},{".priority":H}))}return new D(u,j(e),qe.Default)}}!function tr(n){ba=n}(j);class Gn extends Qi{constructor(e){super(),this.indexPath_=e,(0,_.hu)(!x(e)&&".priority"!==L(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),o=this.extractChild(t.node),u=r.compareTo(o);return 0===u?Dt(e.name,t.name):u}makePost(e,t){const r=j(e),o=D.EMPTY_NODE.updateChild(this.indexPath_,r);return new M(t,o)}maxPost(){const e=D.EMPTY_NODE.updateChild(this.indexPath_,Bn);return new M(Ae,e)}toString(){return ht(this.indexPath_,0).join("/")}}const zn=new class hu extends Qi{compare(e,t){const r=e.node.compareTo(t.node);return 0===r?Dt(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return M.MIN}maxPost(){return M.MAX}makePost(e,t){const r=j(e);return new M(t,r)}toString(){return".value"}};function nr(n){return{type:"value",snapshotNode:n}}function sn(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Ye(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Zn(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}class Kn{constructor(e){this.index_=e}updateChild(e,t,r,o,u,c){(0,_.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const h=e.getImmediateChild(t);return h.getChild(o).equals(r.getChild(o))&&h.isEmpty()===r.isEmpty()||(null!=c&&(r.isEmpty()?e.hasChild(t)?c.trackChildChange(Ye(t,h)):(0,_.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):h.isEmpty()?c.trackChildChange(sn(t,r)):c.trackChildChange(Zn(t,r,h))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return null!=r&&(e.isLeafNode()||e.forEachChild(H,(o,u)=>{t.hasChild(o)||r.trackChildChange(Ye(o,u))}),t.isLeafNode()||t.forEachChild(H,(o,u)=>{if(e.hasChild(o)){const c=e.getImmediateChild(o);c.equals(u)||r.trackChildChange(Zn(o,u,c))}else r.trackChildChange(sn(o,u))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?D.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Ut{constructor(e){this.indexedFilter_=new Kn(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Ut.getStartPost_(e),this.endPost_=Ut.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,o,u,c){return this.matches(new M(t,r))||(r=D.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,o,u,c)}updateFullNode(e,t,r){t.isLeafNode()&&(t=D.EMPTY_NODE);let o=t.withIndex(this.index_);o=o.updatePriority(D.EMPTY_NODE);const u=this;return t.forEachChild(H,(c,h)=>{u.matches(new M(c,h))||(o=o.updateImmediateChild(c,D.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,o,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class Ds{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Ut(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,o,u,c){return this.rangedFilter_.matches(new M(t,r))||(r=D.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,o,u,c):this.fullLimitUpdateChild_(e,t,r,u,c)}updateFullNode(e,t,r){let o;if(t.isLeafNode()||t.isEmpty())o=D.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let u;o=D.EMPTY_NODE.withIndex(this.index_),u=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;u.hasNext()&&c<this.limit_;){const h=u.getNext();if(this.withinDirectionalStart(h)){if(!this.withinDirectionalEnd(h))break;o=o.updateImmediateChild(h.name,h.node),c++}}}else{let u;o=t.withIndex(this.index_),o=o.updatePriority(D.EMPTY_NODE),u=this.reverse_?o.getReverseIterator(this.index_):o.getIterator(this.index_);let c=0;for(;u.hasNext();){const h=u.getNext();c<this.limit_&&this.withinDirectionalStart(h)&&this.withinDirectionalEnd(h)?c++:o=o.updateImmediateChild(h.name,D.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,o,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,o,u){let c;if(this.reverse_){const E=this.index_.getCompare();c=(T,b)=>E(b,T)}else c=this.index_.getCompare();const h=e;(0,_.hu)(h.numChildren()===this.limit_,"");const p=new M(t,r),g=this.reverse_?h.getFirstChild(this.index_):h.getLastChild(this.index_),I=this.rangedFilter_.matches(p);if(h.hasChild(t)){const E=h.getImmediateChild(t);let T=o.getChildAfterChild(this.index_,g,this.reverse_);for(;null!=T&&(T.name===t||h.hasChild(T.name));)T=o.getChildAfterChild(this.index_,T,this.reverse_);const b=null==T?1:c(T,p);if(I&&!r.isEmpty()&&b>=0)return u?.trackChildChange(Zn(t,r,E)),h.updateImmediateChild(t,r);{u?.trackChildChange(Ye(t,E));const F=h.updateImmediateChild(t,D.EMPTY_NODE);return null!=T&&this.rangedFilter_.matches(T)?(u?.trackChildChange(sn(T.name,T.node)),F.updateImmediateChild(T.name,T.node)):F}}return r.isEmpty()?e:I&&c(g,p)>=0?(null!=u&&(u.trackChildChange(Ye(g.name,g.node)),u.trackChildChange(sn(t,r))),h.updateImmediateChild(t,r).updateImmediateChild(g.name,D.EMPTY_NODE)):e}}class ir{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=H}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,_.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(0,_.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ut}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,_.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(0,_.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ae}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,_.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===H}copy(){const e=new ir;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Ls(n,e,t){const r=n.copy();return r.startSet_=!0,void 0===e&&(e=null),r.indexStartValue_=e,null!=t?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function $n(n,e,t){const r=n.copy();return r.endSet_=!0,void 0===e&&(e=null),r.indexEndValue_=e,void 0!==t?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function rr(n,e){const t=n.copy();return t.index_=e,t}function sr(n){const e={};if(n.isDefault())return e;let t;if(n.index_===H?t="$priority":n.index_===zn?t="$value":n.index_===Le?t="$key":((0,_.hu)(n.index_ instanceof Gn,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=(0,_.Wl)(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=(0,_.Wl)(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+(0,_.Wl)(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=(0,_.Wl)(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+(0,_.Wl)(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Oa(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;""===t&&(t=n.isViewFromLeft()?"l":"r"),e.vf=t}return n.index_!==H&&(e.i=n.index_.toString()),e}class or extends Ia{constructor(e,t,r,o){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=o,this.log_=Ot("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:((0,_.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,o){const u=e._path.toString();this.log_("Listen called for "+u+" "+e._queryIdentifier);const c=or.getListenId_(e,r),h={};this.listens_[c]=h;const p=sr(e._queryParams);this.restRequest_(u+".json",p,(g,I)=>{let E=I;if(404===g&&(E=null,g=null),null===g&&this.onDataUpdate_(u,E,!1,r),(0,_.DV)(this.listens_,c)===h){let T;T=g?401===g?"permission_denied":"rest_error:"+g:"ok",o(T,null)}})}unlisten(e,t){const r=or.getListenId_(e,t);delete this.listens_[r]}get(e){const t=sr(e._queryParams),r=e._path.toString(),o=new _.BH;return this.restRequest_(r+".json",t,(u,c)=>{let h=c;404===u&&(h=null,u=null),null===u?(this.onDataUpdate_(r,h,!1,null),o.resolve(h)):o.reject(new Error(h))}),o.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([o,u])=>{o&&o.accessToken&&(t.auth=o.accessToken),u&&u.token&&(t.ac=u.token);const c=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+(0,_.xO)(t);this.log_("Sending REST request for "+c);const h=new XMLHttpRequest;h.onreadystatechange=()=>{if(r&&4===h.readyState){this.log_("REST Response for "+c+" received. status:",h.status,"response:",h.responseText);let p=null;if(h.status>=200&&h.status<300){try{p=(0,_.cI)(h.responseText)}catch{se("Failed to parse JSON response for "+c+": "+h.responseText)}r(null,p)}else 401!==h.status&&404!==h.status&&se("Got unsuccessful REST response for "+c+" Status: "+h.status),r(h.status);r=null}},h.open("GET",c,!0),h.send()})}}class Ms{constructor(){this.rootNode_=D.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function ar(){return{value:null,children:new Map}}function pt(n,e,t){if(x(e))n.value=t,n.children.clear();else if(null!==n.value)n.value=n.value.updateChild(e,t);else{const r=L(e);n.children.has(r)||n.children.set(r,ar()),pt(n.children.get(r),e=B(e),t)}}function on(n,e){if(x(e))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(H,(r,o)=>{pt(n,new U(r),o)}),on(n,e)}}if(n.children.size>0){const t=L(e);return e=B(e),n.children.has(t)&&on(n.children.get(t),e)&&n.children.delete(t),0===n.children.size}return!0}function jn(n,e,t){null!==n.value?t(e,n.value):function Da(n,e){n.children.forEach((t,r)=>{e(r,t)})}(n,(r,o)=>{jn(o,new U(e.toString()+"/"+r),t)})}class Fs{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&$(this.last_,(r,o)=>{t[r]=t[r]-o}),this.last_=e,t}}class Fa{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Fs(e);const r=1e4+2e4*Math.random();xn(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;$(e,(o,u)=>{u>0&&(0,_.r3)(this.statsToReport_,o)&&(t[o]=u,r=!0)}),r&&this.server_.reportStats(t),xn(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Me=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Me||{});function Us(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class ur{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Me.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(x(this.path)){if(null!=this.affectedTree.value)return(0,_.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new U(e));return new ur(W(),t,this.revert)}}return(0,_.hu)(L(this.path)===e,"operationForChild called for unrelated child."),new ur(B(this.path),this.affectedTree,this.revert)}}class Yn{constructor(e,t){this.source=e,this.path=t,this.type=Me.LISTEN_COMPLETE}operationForChild(e){return x(this.path)?new Yn(this.source,W()):new Yn(this.source,B(this.path))}}class Qe{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Me.OVERWRITE}operationForChild(e){return x(this.path)?new Qe(this.source,W(),this.snap.getImmediateChild(e)):new Qe(this.source,B(this.path),this.snap)}}class an{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Me.MERGE}operationForChild(e){if(x(this.path)){const t=this.children.subtree(new U(e));return t.isEmpty()?null:t.value?new Qe(this.source,W(),t.value):new an(this.source,W(),t)}return(0,_.hu)(L(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new an(this.source,B(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class _t{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(x(e))return this.isFullyInitialized()&&!this.filtered_;const t=L(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Ua{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function gt(n,e,t,r,o,u){const c=r.filter(h=>h.type===t);c.sort((h,p)=>function vu(n,e,t){if(null==e.childName||null==t.childName)throw(0,_.g5)("Should only compare child_ events.");const r=new M(e.childName,e.snapshotNode),o=new M(t.childName,t.snapshotNode);return n.index_.compare(r,o)}(n,h,p)),c.forEach(h=>{const p=function mu(n,e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}(n,h,u);o.forEach(g=>{g.respondsTo(h.type)&&e.push(g.createEvent(p,n.query_))})})}function cr(n,e){return{eventCache:n,serverCache:e}}function Qn(n,e,t,r){return cr(new _t(e,t,r),n.serverCache)}function Wa(n,e,t,r){return cr(n.eventCache,new _t(e,t,r))}function dr(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Wt(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Ws;class G{constructor(e,t=(()=>(Ws||(Ws=new ae(cs)),Ws))()){this.value=e,this.children=t}static fromObject(e){let t=new G(null);return $(e,(r,o)=>{t=t.set(new U(r),o)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:W(),value:this.value};if(x(e))return null;{const r=L(e),o=this.children.get(r);if(null!==o){const u=o.findRootMostMatchingPathAndValue(B(e),t);return null!=u?{path:V(new U(r),u.path),value:u.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(x(e))return this;{const t=L(e),r=this.children.get(t);return null!==r?r.subtree(B(e)):new G(null)}}set(e,t){if(x(e))return new G(t,this.children);{const r=L(e),u=(this.children.get(r)||new G(null)).set(B(e),t),c=this.children.insert(r,u);return new G(this.value,c)}}remove(e){if(x(e))return this.children.isEmpty()?new G(null):new G(null,this.children);{const t=L(e),r=this.children.get(t);if(r){const o=r.remove(B(e));let u;return u=o.isEmpty()?this.children.remove(t):this.children.insert(t,o),null===this.value&&u.isEmpty()?new G(null):new G(this.value,u)}return this}}get(e){if(x(e))return this.value;{const t=L(e),r=this.children.get(t);return r?r.get(B(e)):null}}setTree(e,t){if(x(e))return t;{const r=L(e),u=(this.children.get(r)||new G(null)).setTree(B(e),t);let c;return c=u.isEmpty()?this.children.remove(r):this.children.insert(r,u),new G(this.value,c)}}fold(e){return this.fold_(W(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((o,u)=>{r[o]=u.fold_(V(e,o),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,W(),t)}findOnPath_(e,t,r){const o=!!this.value&&r(t,this.value);if(o)return o;if(x(e))return null;{const u=L(e),c=this.children.get(u);return c?c.findOnPath_(B(e),V(t,u),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,W(),t)}foreachOnPath_(e,t,r){if(x(e))return this;{this.value&&r(t,this.value);const o=L(e),u=this.children.get(o);return u?u.foreachOnPath_(B(e),V(t,o),r):new G(null)}}foreach(e){this.foreach_(W(),e)}foreach_(e,t){this.children.inorderTraversal((r,o)=>{o.foreach_(V(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}class Se{constructor(e){this.writeTree_=e}static empty(){return new Se(new G(null))}}function Jn(n,e,t){if(x(e))return new Se(new G(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(null!=r){const o=r.path;let u=r.value;const c=oe(o,e);return u=u.updateChild(c,t),new Se(n.writeTree_.set(o,u))}{const o=new G(t),u=n.writeTree_.setTree(e,o);return new Se(u)}}}function Hs(n,e,t){let r=n;return $(t,(o,u)=>{r=Jn(r,V(e,o),u)}),r}function Va(n,e){if(x(e))return Se.empty();{const t=n.writeTree_.setTree(e,new G(null));return new Se(t)}}function hr(n,e){return null!=Vt(n,e)}function Vt(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return null!=t?n.writeTree_.get(t.path).getChild(oe(t.path,e)):null}function Ha(n){const e=[],t=n.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(H,(r,o)=>{e.push(new M(r,o))}):n.writeTree_.children.inorderTraversal((r,o)=>{null!=o.value&&e.push(new M(r,o.value))}),e}function mt(n,e){if(x(e))return n;{const t=Vt(n,e);return new Se(null!=t?new G(t):n.writeTree_.subtree(e))}}function Bs(n){return n.writeTree_.isEmpty()}function ln(n,e){return fr(W(),n.writeTree_,e)}function fr(n,e,t){if(null!=e.value)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((o,u)=>{".priority"===o?((0,_.hu)(null!==u.value,"Priority writes must always be leaf nodes"),r=u.value):t=fr(V(n,o),u,t)}),!t.getChild(n).isEmpty()&&null!==r&&(t=t.updateChild(V(n,".priority"),r)),t}}function un(n,e){return ja(e,n)}function Eu(n,e){if(n.snap)return ce(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&ce(V(n.path,t),e))return!0;return!1}function Tu(n){return n.visible}function Cu(n,e,t){let r=Se.empty();for(let o=0;o<n.length;++o){const u=n[o];if(e(u)){const c=u.path;let h;if(u.snap)ce(t,c)?(h=oe(t,c),r=Jn(r,h,u.snap)):ce(c,t)&&(h=oe(c,t),r=Jn(r,W(),u.snap.getChild(h)));else{if(!u.children)throw(0,_.g5)("WriteRecord should have .snap or .children");if(ce(t,c))h=oe(t,c),r=Hs(r,h,u.children);else if(ce(c,t))if(h=oe(c,t),x(h))r=Hs(r,W(),u.children);else{const p=(0,_.DV)(u.children,L(h));if(p){const g=p.getChild(B(h));r=Jn(r,W(),g)}}}}}return r}function pr(n,e,t,r,o){if(r||o){const u=mt(n.visibleWrites,e);return!o&&Bs(u)?t:o||null!=t||hr(u,W())?ln(Cu(n.allWrites,function(g){return(g.visible||o)&&(!r||!~r.indexOf(g.writeId))&&(ce(g.path,e)||ce(e,g.path))},e),t||D.EMPTY_NODE):null}{const u=Vt(n.visibleWrites,e);if(null!=u)return u;{const c=mt(n.visibleWrites,e);return Bs(c)?t:null!=t||hr(c,W())?ln(c,t||D.EMPTY_NODE):null}}}function gr(n,e,t,r){return pr(n.writeTree,n.treePath,e,t,r)}function Zs(n,e){return function Ga(n,e,t){let r=D.EMPTY_NODE;const o=Vt(n.visibleWrites,e);if(o)return o.isLeafNode()||o.forEachChild(H,(u,c)=>{r=r.updateImmediateChild(u,c)}),r;if(t){const u=mt(n.visibleWrites,e);return t.forEachChild(H,(c,h)=>{const p=ln(mt(u,new U(c)),h);r=r.updateImmediateChild(c,p)}),Ha(u).forEach(c=>{r=r.updateImmediateChild(c.name,c.node)}),r}return Ha(mt(n.visibleWrites,e)).forEach(c=>{r=r.updateImmediateChild(c.name,c.node)}),r}(n.writeTree,n.treePath,e)}function Ka(n,e,t,r){return function _r(n,e,t,r,o){(0,_.hu)(r||o,"Either existingEventSnap or existingServerSnap must exist");const u=V(e,t);if(hr(n.visibleWrites,u))return null;{const c=mt(n.visibleWrites,u);return Bs(c)?o.getChild(t):ln(c,o.getChild(t))}}(n.writeTree,n.treePath,e,t,r)}function Xn(n,e){return function Za(n,e){return Vt(n.visibleWrites,e)}(n.writeTree,V(n.treePath,e))}function $a(n,e,t){return function za(n,e,t,r){const o=V(e,t),u=Vt(n.visibleWrites,o);return null!=u?u:r.isCompleteForChild(t)?ln(mt(n.visibleWrites,o),r.getNode().getImmediateChild(t)):null}(n.writeTree,n.treePath,e,t)}function vt(n,e){return ja(V(n.treePath,e),n.writeTree)}function ja(n,e){return{treePath:n,writeTree:e}}class Su{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;(0,_.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,_.hu)(".priority"!==r,"Only non-priority child changes can be tracked.");const o=this.changeMap.get(r);if(o){const u=o.type;if("child_added"===t&&"child_removed"===u)this.changeMap.set(r,Zn(r,e.snapshotNode,o.snapshotNode));else if("child_removed"===t&&"child_added"===u)this.changeMap.delete(r);else if("child_removed"===t&&"child_changed"===u)this.changeMap.set(r,Ye(r,o.oldSnap));else if("child_changed"===t&&"child_added"===u)this.changeMap.set(r,sn(r,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==u)throw(0,_.g5)("Illegal combination of changes: "+e+" occurred after "+o);this.changeMap.set(r,Zn(r,e.snapshotNode,o.oldSnap))}}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}const qa=new class Ks{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}};class ei{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=null!=this.optCompleteServerCache_?new _t(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return $a(this.writes_,e,r)}}getChildAfterChild(e,t,r){const o=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Wt(this.viewCache_),u=function Ru(n,e,t,r,o,u){return function wu(n,e,t,r,o,u,c){let h;const p=mt(n.visibleWrites,e),g=Vt(p,W());if(null!=g)h=g;else{if(null==t)return[];h=ln(p,t)}if(h=h.withIndex(c),h.isEmpty()||h.isLeafNode())return[];{const I=[],E=c.getCompare(),T=u?h.getReverseIteratorFrom(r,c):h.getIteratorFrom(r,c);let b=T.getNext();for(;b&&I.length<o;)0!==E(b,r)&&I.push(b),b=T.getNext();return I}}(n.writeTree,n.treePath,e,t,r,o,u)}(this.writes_,o,t,1,r,e);return 0===u.length?null:u[0]}}function Ya(n,e,t,r,o,u){const c=e.eventCache;if(null!=Xn(r,t))return e;{let h,p;if(x(t))if((0,_.hu)(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const g=Wt(e),E=Zs(r,g instanceof D?g:D.EMPTY_NODE);h=n.filter.updateFullNode(e.eventCache.getNode(),E,u)}else{const g=gr(r,Wt(e));h=n.filter.updateFullNode(e.eventCache.getNode(),g,u)}else{const g=L(t);if(".priority"===g){(0,_.hu)(1===dt(t),"Can't have a priority with additional path components");const I=c.getNode();p=e.serverCache.getNode();const E=Ka(r,t,I,p);h=null!=E?n.filter.updatePriority(I,E):c.getNode()}else{const I=B(t);let E;if(c.isCompleteForChild(g)){p=e.serverCache.getNode();const T=Ka(r,t,c.getNode(),p);E=null!=T?c.getNode().getImmediateChild(g).updateChild(I,T):c.getNode().getImmediateChild(g)}else E=$a(r,g,e.serverCache);h=null!=E?n.filter.updateChild(c.getNode(),g,E,I,o,u):c.getNode()}}return Qn(e,h,c.isFullyInitialized()||x(t),n.filter.filtersNodes())}}function cn(n,e,t,r,o,u,c,h){const p=e.serverCache;let g;const I=c?n.filter:n.filter.getIndexedFilter();if(x(t))g=I.updateFullNode(p.getNode(),r,null);else if(I.filtersNodes()&&!p.isFiltered()){const b=p.getNode().updateChild(t,r);g=I.updateFullNode(p.getNode(),b,null)}else{const b=L(t);if(!p.isCompleteForPath(t)&&dt(t)>1)return e;const P=B(t),Q=p.getNode().getImmediateChild(b).updateChild(P,r);g=".priority"===b?I.updatePriority(p.getNode(),Q):I.updateChild(p.getNode(),b,Q,P,qa,null)}const E=Wa(e,g,p.isFullyInitialized()||x(t),I.filtersNodes());return Ya(n,E,t,o,new ei(o,E,u),h)}function js(n,e,t,r,o,u,c){const h=e.eventCache;let p,g;const I=new ei(o,e,u);if(x(t))g=n.filter.updateFullNode(e.eventCache.getNode(),r,c),p=Qn(e,g,!0,n.filter.filtersNodes());else{const E=L(t);if(".priority"===E)g=n.filter.updatePriority(e.eventCache.getNode(),r),p=Qn(e,g,h.isFullyInitialized(),h.isFiltered());else{const T=B(t),b=h.getNode().getImmediateChild(E);let P;if(x(T))P=r;else{const F=I.getCompleteChild(E);P=null!=F?".priority"===qi(T)&&F.getChild(ws(T)).isEmpty()?F:F.updateChild(T,r):D.EMPTY_NODE}p=b.equals(P)?e:Qn(e,n.filter.updateChild(h.getNode(),E,P,T,I,c),h.isFullyInitialized(),n.filter.filtersNodes())}}return p}function Qa(n,e){return n.eventCache.isCompleteForChild(e)}function Ja(n,e,t){return t.foreach((r,o)=>{e=e.updateChild(r,o)}),e}function qs(n,e,t,r,o,u,c,h){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let g,p=e;g=x(t)?r:new G(null).setTree(t,r);const I=e.serverCache.getNode();return g.children.inorderTraversal((E,T)=>{if(I.hasChild(E)){const P=Ja(0,e.serverCache.getNode().getImmediateChild(E),T);p=cn(n,p,new U(E),P,o,u,c,h)}}),g.children.inorderTraversal((E,T)=>{const b=!e.serverCache.isCompleteForChild(E)&&null===T.value;if(!I.hasChild(E)&&!b){const F=Ja(0,e.serverCache.getNode().getImmediateChild(E),T);p=cn(n,p,new U(E),F,o,u,c,h)}}),p}class Du{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,o=new Kn(r.getIndex()),u=function xs(n){return n.loadsAllData()?new Kn(n.getIndex()):n.hasLimit()?new Ds(n):new Ut(n)}(r);this.processor_=function ku(n){return{filter:n}}(u);const c=t.serverCache,h=t.eventCache,p=o.updateFullNode(D.EMPTY_NODE,c.getNode(),null),g=u.updateFullNode(D.EMPTY_NODE,h.getNode(),null),I=new _t(p,c.isFullyInitialized(),o.filtersNodes()),E=new _t(g,h.isFullyInitialized(),u.filtersNodes());this.viewCache_=cr(E,I),this.eventGenerator_=new Ua(this.query_)}get query(){return this.query_}}function xu(n,e){const t=Wt(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!x(e)&&!t.getImmediateChild(L(e)).isEmpty())?t.getChild(e):null}function el(n){return 0===n.eventRegistrations_.length}function tl(n,e,t){const r=[];if(t){(0,_.hu)(null==e,"A cancel should cancel all event registrations.");const o=n.query._path;n.eventRegistrations_.forEach(u=>{const c=u.createCancelEvent(t,o);c&&r.push(c)})}if(e){let o=[];for(let u=0;u<n.eventRegistrations_.length;++u){const c=n.eventRegistrations_[u];if(c.matches(e)){if(e.hasAnyCallback()){o=o.concat(n.eventRegistrations_.slice(u+1));break}}else o.push(c)}n.eventRegistrations_=o}else n.eventRegistrations_=[];return r}function nl(n,e,t,r){e.type===Me.MERGE&&null!==e.source.queryId&&((0,_.hu)(Wt(n.viewCache_),"We should always have a full cache before handling merges"),(0,_.hu)(dr(n.viewCache_),"Missing event cache, even though we have a server cache"));const o=n.viewCache_,u=function $s(n,e,t,r,o){const u=new Su;let c,h;if(t.type===Me.OVERWRITE){const g=t;g.source.fromUser?c=js(n,e,g.path,g.snap,r,o,u):((0,_.hu)(g.source.fromServer,"Unknown source."),h=g.source.tagged||e.serverCache.isFiltered()&&!x(g.path),c=cn(n,e,g.path,g.snap,r,o,h,u))}else if(t.type===Me.MERGE){const g=t;g.source.fromUser?c=function Nu(n,e,t,r,o,u,c){let h=e;return r.foreach((p,g)=>{const I=V(t,p);Qa(e,L(I))&&(h=js(n,h,I,g,o,u,c))}),r.foreach((p,g)=>{const I=V(t,p);Qa(e,L(I))||(h=js(n,h,I,g,o,u,c))}),h}(n,e,g.path,g.children,r,o,u):((0,_.hu)(g.source.fromServer,"Unknown source."),h=g.source.tagged||e.serverCache.isFiltered(),c=qs(n,e,g.path,g.children,r,o,h,u))}else if(t.type===Me.ACK_USER_WRITE){const g=t;c=g.revert?function Ou(n,e,t,r,o,u){let c;if(null!=Xn(r,t))return e;{const h=new ei(r,e,o),p=e.eventCache.getNode();let g;if(x(t)||".priority"===L(t)){let I;if(e.serverCache.isFullyInitialized())I=gr(r,Wt(e));else{const E=e.serverCache.getNode();(0,_.hu)(E instanceof D,"serverChildren would be complete if leaf node"),I=Zs(r,E)}g=n.filter.updateFullNode(p,I,u)}else{const I=L(t);let E=$a(r,I,e.serverCache);null==E&&e.serverCache.isCompleteForChild(I)&&(E=p.getImmediateChild(I)),g=null!=E?n.filter.updateChild(p,I,E,B(t),h,u):e.eventCache.getNode().hasChild(I)?n.filter.updateChild(p,I,D.EMPTY_NODE,B(t),h,u):p,g.isEmpty()&&e.serverCache.isFullyInitialized()&&(c=gr(r,Wt(e)),c.isLeafNode()&&(g=n.filter.updateFullNode(g,c,u)))}return c=e.serverCache.isFullyInitialized()||null!=Xn(r,W()),Qn(e,g,c,n.filter.filtersNodes())}}(n,e,g.path,r,o,u):function Xa(n,e,t,r,o,u,c){if(null!=Xn(o,t))return e;const h=e.serverCache.isFiltered(),p=e.serverCache;if(null!=r.value){if(x(t)&&p.isFullyInitialized()||p.isCompleteForPath(t))return cn(n,e,t,p.getNode().getChild(t),o,u,h,c);if(x(t)){let g=new G(null);return p.getNode().forEachChild(Le,(I,E)=>{g=g.set(new U(I),E)}),qs(n,e,t,g,o,u,h,c)}return e}{let g=new G(null);return r.foreach((I,E)=>{const T=V(t,I);p.isCompleteForPath(T)&&(g=g.set(I,p.getNode().getChild(T)))}),qs(n,e,t,g,o,u,h,c)}}(n,e,g.path,g.affectedTree,r,o,u)}else{if(t.type!==Me.LISTEN_COMPLETE)throw(0,_.g5)("Unknown operation type: "+t.type);c=function Ys(n,e,t,r,o){const u=e.serverCache;return Ya(n,Wa(e,u.getNode(),u.isFullyInitialized()||x(t),u.isFiltered()),t,r,qa,o)}(n,e,t.path,r,u)}const p=u.getChanges();return function Pu(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const o=r.getNode().isLeafNode()||r.getNode().isEmpty(),u=dr(n);(t.length>0||!n.eventCache.isFullyInitialized()||o&&!r.getNode().equals(u)||!r.getNode().getPriority().equals(u.getPriority()))&&t.push(nr(dr(e)))}}(e,c,p),{viewCache:c,changes:p}}(n.processor_,o,e,t,r);return function bu(n,e){(0,_.hu)(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),(0,_.hu)(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}(n.processor_,u.viewCache),(0,_.hu)(u.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=u.viewCache,Xs(n,u.changes,u.viewCache.eventCache.getNode(),null)}function Xs(n,e,t,r){return function gu(n,e,t,r){const o=[],u=[];return e.forEach(c=>{"child_changed"===c.type&&n.index_.indexedValueChanged(c.oldSnap,c.snapshotNode)&&u.push(function fu(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}(c.childName,c.snapshotNode))}),gt(n,o,"child_removed",e,r,t),gt(n,o,"child_added",e,r,t),gt(n,o,"child_moved",u,r,t),gt(n,o,"child_changed",e,r,t),gt(n,o,"value",e,r,t),o}(n.eventGenerator_,e,t,r?[r]:n.eventRegistrations_)}let vr,Ir;class il{constructor(){this.views=new Map}}function eo(n,e,t,r){const o=e.source.queryId;if(null!==o){const u=n.views.get(o);return(0,_.hu)(null!=u,"SyncTree gave us an op for an invalid query."),nl(u,e,t,r)}{let u=[];for(const c of n.views.values())u=u.concat(nl(c,e,t,r));return u}}function to(n,e,t,r,o){const c=n.views.get(e._queryIdentifier);if(!c){let h=gr(t,o?r:null),p=!1;h?p=!0:r instanceof D?(h=Zs(t,r),p=!1):(h=D.EMPTY_NODE,p=!1);const g=cr(new _t(h,p,!1),new _t(r,o,!1));return new Du(e,g)}return c}function rl(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function yt(n,e){let t=null;for(const r of n.views.values())t=t||xu(r,e);return t}function no(n,e){return e._queryParams.loadsAllData()?ni(n):n.views.get(e._queryIdentifier)}function yr(n,e){return null!=no(n,e)}function Fe(n){return null!=ni(n)}function ni(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let _e=1;class dn{constructor(e){this.listenProvider_=e,this.syncPointTree_=new G(null),this.pendingWriteTree_=function Au(){return{visibleWrites:Se.empty(),allWrites:[],lastWriteId:-1}}(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Er(n,e,t,r,o){return function yu(n,e,t,r,o){(0,_.hu)(r>n.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:o}),o&&(n.visibleWrites=Jn(n.visibleWrites,e,t)),n.lastWriteId=r}(n.pendingWriteTree_,e,t,r,o),o?te(n,new Qe({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,t)):[]}function Ue(n,e,t=!1){const r=function Iu(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}(n.pendingWriteTree_,e);if(function Ba(n,e){const t=n.allWrites.findIndex(h=>h.writeId===e);(0,_.hu)(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let o=r.visible,u=!1,c=n.allWrites.length-1;for(;o&&c>=0;){const h=n.allWrites[c];h.visible&&(c>=t&&Eu(h,r.path)?o=!1:ce(r.path,h.path)&&(u=!0)),c--}return!!o&&(u?(function zs(n){n.visibleWrites=Cu(n.allWrites,Tu,W()),n.lastWriteId=n.allWrites.length>0?n.allWrites[n.allWrites.length-1].writeId:-1}(n),!0):(r.snap?n.visibleWrites=Va(n.visibleWrites,r.path):$(r.children,p=>{n.visibleWrites=Va(n.visibleWrites,V(r.path,p))}),!0))}(n.pendingWriteTree_,e)){let u=new G(null);return null!=r.snap?u=u.set(W(),!0):$(r.children,c=>{u=u.set(new U(c),!0)}),te(n,new ur(r.path,u,t))}return[]}function Ht(n,e,t){return te(n,new Qe({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,t))}function ke(n,e,t,r,o=!1){const u=e._path,c=n.syncPointTree_.get(u);let h=[];if(c&&("default"===e._queryIdentifier||yr(c,e))){const p=function Wu(n,e,t,r){const o=e._queryIdentifier,u=[];let c=[];const h=Fe(n);if("default"===o)for(const[p,g]of n.views.entries())c=c.concat(tl(g,t,r)),el(g)&&(n.views.delete(p),g.query._queryParams.loadsAllData()||u.push(g.query));else{const p=n.views.get(o);p&&(c=c.concat(tl(p,t,r)),el(p)&&(n.views.delete(o),p.query._queryParams.loadsAllData()||u.push(p.query)))}return h&&!Fe(n)&&u.push(new(function Fu(){return(0,_.hu)(vr,"Reference.ts has not been loaded"),vr}())(e._repo,e._path)),{removed:u,events:c}}(c,e,t,r);(function ti(n){return 0===n.views.size})(c)&&(n.syncPointTree_=n.syncPointTree_.remove(u));const g=p.removed;if(h=p.events,!o){const I=-1!==g.findIndex(T=>T._queryParams.loadsAllData()),E=n.syncPointTree_.findOnPath(u,(T,b)=>Fe(b));if(I&&!E){const T=n.syncPointTree_.subtree(u);if(!T.isEmpty()){const b=function ao(n){return n.fold((e,t,r)=>{if(t&&Fe(t))return[ni(t)];{let o=[];return t&&(o=rl(t)),$(r,(u,c)=>{o=o.concat(c)}),o}})}(T);for(let P=0;P<b.length;++P){const F=b[P],Q=F.query,me=al(n,F);n.listenProvider_.startListening(ii(Q),ge(n,Q),me.hashFn,me.onComplete)}}}!E&&g.length>0&&!r&&(I?n.listenProvider_.stopListening(ii(e),null):g.forEach(T=>{const b=n.queryToTagMap.get(It(T));n.listenProvider_.stopListening(ii(T),b)}))}!function Zu(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const o=It(r),u=n.queryToTagMap.get(o);n.queryToTagMap.delete(o),n.tagToQueryMap.delete(u)}}}(n,g)}return h}function ro(n,e,t,r){const o=Ar(n,r);if(null!=o){const u=Rr(o),c=u.path,h=u.queryId,p=oe(c,e);return oo(n,c,new Qe(Us(h),p,t))}return[]}function so(n,e,t,r=!1){const o=e._path;let u=null,c=!1;n.syncPointTree_.foreachOnPath(o,(T,b)=>{const P=oe(T,o);u=u||yt(b,P),c=c||Fe(b)});let p,h=n.syncPointTree_.get(o);h?(c=c||Fe(h),u=u||yt(h,W())):(h=new il,n.syncPointTree_=n.syncPointTree_.set(o,h)),null!=u?p=!0:(p=!1,u=D.EMPTY_NODE,n.syncPointTree_.subtree(o).foreachChild((b,P)=>{const F=yt(P,W());F&&(u=u.updateImmediateChild(b,F))}));const g=yr(h,e);if(!g&&!e._queryParams.loadsAllData()){const T=It(e);(0,_.hu)(!n.queryToTagMap.has(T),"View does not exist, but we have a tag");const b=function Ku(){return _e++}();n.queryToTagMap.set(T,b),n.tagToQueryMap.set(b,T)}let E=function Uu(n,e,t,r,o,u){const c=to(n,e,r,o,u);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,c),function mr(n,e){n.eventRegistrations_.push(e)}(c,t),function Lu(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(H,(u,c)=>{r.push(sn(u,c))}),t.isFullyInitialized()&&r.push(nr(t.getNode())),Xs(n,r,t.getNode(),e)}(c,t)}(h,e,t,un(n.pendingWriteTree_,o),u,p);if(!g&&!c&&!r){const T=no(h,e);E=E.concat(function $u(n,e,t){const r=e._path,o=ge(n,e),u=al(n,t),c=n.listenProvider_.startListening(ii(e),o,u.hashFn,u.onComplete),h=n.syncPointTree_.subtree(r);if(o)(0,_.hu)(!Fe(h.value),"If we're adding a query, it shouldn't be shadowed");else{const p=h.fold((g,I,E)=>{if(!x(g)&&I&&Fe(I))return[ni(I).query];{let T=[];return I&&(T=T.concat(rl(I).map(b=>b.query))),$(E,(b,P)=>{T=T.concat(P)}),T}});for(let g=0;g<p.length;++g){const I=p[g];n.listenProvider_.stopListening(ii(I),ge(n,I))}}return c}(n,e,T))}return E}function Tr(n,e,t){const o=n.pendingWriteTree_,u=n.syncPointTree_.findOnPath(e,(c,h)=>{const g=yt(h,oe(c,e));if(g)return g});return pr(o,e,u,t,!0)}function te(n,e){return Cr(e,n.syncPointTree_,null,un(n.pendingWriteTree_,W()))}function Cr(n,e,t,r){if(x(n.path))return wr(n,e,t,r);{const o=e.get(W());null==t&&null!=o&&(t=yt(o,W()));let u=[];const c=L(n.path),h=n.operationForChild(c),p=e.children.get(c);if(p&&h){const g=t?t.getImmediateChild(c):null,I=vt(r,c);u=u.concat(Cr(h,p,g,I))}return o&&(u=u.concat(eo(o,n,r,t))),u}}function wr(n,e,t,r){const o=e.get(W());null==t&&null!=o&&(t=yt(o,W()));let u=[];return e.children.inorderTraversal((c,h)=>{const p=t?t.getImmediateChild(c):null,g=vt(r,c),I=n.operationForChild(c);I&&(u=u.concat(wr(I,h,p,g)))}),o&&(u=u.concat(eo(o,n,r,t))),u}function al(n,e){const t=e.query,r=ge(n,t);return{hashFn:()=>(function Qs(n){return n.viewCache_.serverCache.getNode()}(e)||D.EMPTY_NODE).hash(),onComplete:o=>{if("ok"===o)return r?function Gu(n,e,t){const r=Ar(n,t);if(r){const o=Rr(r),u=o.path,c=o.queryId,h=oe(u,e);return oo(n,u,new Yn(Us(c),h))}return[]}(n,t._path,r):function sl(n,e){return te(n,new Yn({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e))}(n,t._path);{const u=function hs(n,e){let t="Unknown Error";"too_big"===n?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===n?t="Client doesn't have permission to access the desired data.":"unavailable"===n&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}(o,t);return ke(n,t,null,u)}}}}function ge(n,e){const t=It(e);return n.queryToTagMap.get(t)}function It(n){return n._path.toString()+"$"+n._queryIdentifier}function Ar(n,e){return n.tagToQueryMap.get(e)}function Rr(n){const e=n.indexOf("$");return(0,_.hu)(-1!==e&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new U(n.substr(0,e))}}function oo(n,e,t){const r=n.syncPointTree_.get(e);return(0,_.hu)(r,"Missing sync point for query tag that we're tracking"),eo(r,t,un(n.pendingWriteTree_,e),null)}function ii(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(function Vu(){return(0,_.hu)(Ir,"Reference.ts has not been loaded"),Ir}())(n._repo,n._path):n}class a{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new a(t)}node(){return this.node_}}class i{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=V(this.path_,e);return new i(this.syncTree_,t)}node(){return Tr(this.syncTree_,this.path_)}}const s=function(n){return(n=n||{}).timestamp=n.timestamp||(new Date).getTime(),n},l=function(n,e,t){return n&&"object"==typeof n?((0,_.hu)(".sv"in n,"Unexpected leaf node or priority contents"),"string"==typeof n[".sv"]?d(n[".sv"],e,t):"object"==typeof n[".sv"]?f(n[".sv"],e):void(0,_.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2))):n},d=function(n,e,t){if("timestamp"===n)return t.timestamp;(0,_.hu)(!1,"Unexpected server value: "+n)},f=function(n,e,t){n.hasOwnProperty("increment")||(0,_.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;"number"!=typeof r&&(0,_.hu)(!1,"Unexpected increment value: "+r);const o=e.node();if((0,_.hu)(null!==o&&typeof o<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return r;const c=o.getValue();return"number"!=typeof c?r:c+r},m=function(n,e,t,r){return C(e,new i(t,n),r)},y=function(n,e,t){return C(n,new a(e),t)};function C(n,e,t){const r=n.getPriority().val(),o=l(r,e.getImmediateChild(".priority"),t);let u;if(n.isLeafNode()){const c=n,h=l(c.getValue(),e,t);return h!==c.getValue()||o!==c.getPriority().val()?new ft(h,j(o)):n}{const c=n;return u=c,o!==c.getPriority().val()&&(u=u.updatePriority(new ft(o))),c.forEachChild(H,(h,p)=>{const g=C(p,e.getImmediateChild(h),t);g!==p&&(u=u.updateImmediateChild(h,g))}),u}}class R{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function k(n,e){let t=e instanceof U?e:new U(e),r=n,o=L(t);for(;null!==o;){const u=(0,_.DV)(r.node.children,o)||{children:{},childCount:0};r=new R(o,r,u),t=B(t),o=L(t)}return r}function S(n){return n.node.value}function z(n,e){n.node.value=e,si(n)}function Ie(n){return n.node.childCount>0}function ri(n,e){$(n.node.children,(t,r)=>{e(new R(t,n,r))})}function kr(n,e,t,r){t&&!r&&e(n),ri(n,o=>{kr(o,e,!0,r)}),t&&r&&e(n)}function hn(n){return new U(null===n.parent?n.name:hn(n.parent)+"/"+n.name)}function si(n){null!==n.parent&&function ul(n,e,t){const r=function Sr(n){return void 0===S(n)&&!Ie(n)}(t),o=(0,_.r3)(n.node.children,e);r&&o?(delete n.node.children[e],n.node.childCount--,si(n)):!r&&!o&&(n.node.children[e]=t.node,n.node.childCount++,si(n))}(n.parent,n.name,n)}const cl=/[\[\].#$\/\u0000-\u001F\u007F]/,lo=/[\[\].#$\u0000-\u001F\u007F]/,br=10485760,Pr=function(n){return"string"==typeof n&&0!==n.length&&!cl.test(n)},Nr=function(n){return"string"==typeof n&&0!==n.length&&!lo.test(n)},uo=function(n){return null===n||"string"==typeof n||"number"==typeof n&&!On(n)||n&&"object"==typeof n&&(0,_.r3)(n,".sv")},Et=function(n,e,t,r){r&&void 0===e||co((0,_.gK)(n,"value"),e,t)},co=function(n,e,t){const r=t instanceof U?new iu(t,n):t;if(void 0===e)throw new Error(n+"contains undefined "+xt(r));if("function"==typeof e)throw new Error(n+"contains a function "+xt(r)+" with contents = "+e.toString());if(On(e))throw new Error(n+"contains "+e.toString()+" "+xt(r));if("string"==typeof e&&e.length>br/3&&(0,_.ug)(e)>br)throw new Error(n+"contains a string greater than "+br+" utf8 bytes "+xt(r)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let o=!1,u=!1;if($(e,(c,h)=>{if(".value"===c)o=!0;else if(".priority"!==c&&".sv"!==c&&(u=!0,!Pr(c)))throw new Error(n+" contains an invalid key ("+c+") "+xt(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function Rs(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=(0,_.ug)(e),Ca(n)})(r,c),co(n,h,r),function Ta(n){const e=n.parts_.pop();n.byteLength_-=(0,_.ug)(e),n.parts_.length>0&&(n.byteLength_-=1)}(r)}),o&&u)throw new Error(n+' contains ".value" child '+xt(r)+" in addition to actual children.")}},Ac=function(n,e,t,r){if(r&&void 0===e)return;const o=(0,_.gK)(n,"values");if(!e||"object"!=typeof e||Array.isArray(e))throw new Error(o+" must be an object containing the children to replace.");const u=[];$(e,(c,h)=>{const p=new U(c);if(co(o,h,V(t,p)),".priority"===qi(p)&&!uo(h))throw new Error(o+"contains an invalid value for '"+p.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");u.push(p)}),function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const u=ht(r);for(let c=0;c<u.length;c++)if((".priority"!==u[c]||c!==u.length-1)&&!Pr(u[c]))throw new Error(n+"contains an invalid key ("+u[c]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}e.sort(As);let o=null;for(t=0;t<e.length;t++){if(r=e[t],null!==o&&ce(o,r))throw new Error(n+"contains a path "+o.toString()+" that is ancestor of another path "+r.toString());o=r}}(o,u)},qu=function(n,e,t){if(!t||void 0!==e){if(On(e))throw new Error((0,_.gK)(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!uo(e))throw new Error((0,_.gK)(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ho=function(n,e,t,r){if(!(r&&void 0===t||Pr(t)))throw new Error((0,_.gK)(n,e)+'was an invalid key = "'+t+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},fo=function(n,e,t,r){if(!(r&&void 0===t||Nr(t)))throw new Error((0,_.gK)(n,e)+'was an invalid path = "'+t+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},pd=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),fo(n,e,t,r)},We=function(n,e){if(".info"===L(e))throw new Error(n+" failed = Can't modify data under /.info/")},Rc=function(n,e){const t=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!Pr(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==t.length&&!function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Nr(n)}(t))throw new Error((0,_.gK)(n,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class _d{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function dl(n,e){let t=null;for(let r=0;r<e.length;r++){const o=e[r],u=o.getPath();null!==t&&!Yi(u,t.path)&&(n.eventLists_.push(t),t=null),null===t&&(t={events:[],path:u}),t.events.push(o)}t&&n.eventLists_.push(t)}function Sc(n,e,t){dl(n,t),kc(n,r=>Yi(r,e))}function be(n,e,t){dl(n,t),kc(n,r=>ce(r,e)||ce(e,r))}function kc(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const o=n.eventLists_[r];o&&(e(o.path)?(gd(n.eventLists_[r]),n.eventLists_[r]=null):t=!1)}t&&(n.eventLists_=[]),n.recursionDepth_--}function gd(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(null!==t){n.events[e]=null;const r=t.getEventRunner();Ke&&ee("event: "+t.toString()),Yt(r)}}}const bc="repo_interrupt",md=25;class vd{constructor(e,t,r,o){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=o,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new _d,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ar(),this.transactionQueueTree_=new R,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Pc(n){const t=n.infoData_.getNode(new U(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function po(n){return s({timestamp:Pc(n)})}function Nc(n,e,t,r,o){n.dataUpdateCount++;const u=new U(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let c=[];if(o)if(r){const p=(0,_.UI)(t,g=>j(g));c=function zu(n,e,t,r){const o=Ar(n,r);if(o){const u=Rr(o),c=u.path,h=u.queryId,p=oe(c,e),g=G.fromObject(t);return oo(n,c,new an(Us(h),p,g))}return[]}(n.serverSyncTree_,u,p,o)}else{const p=j(t);c=ro(n.serverSyncTree_,u,p,o)}else if(r){const p=(0,_.UI)(t,g=>j(g));c=function Bu(n,e,t){const r=G.fromObject(t);return te(n,new an({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,r))}(n.serverSyncTree_,u,p)}else{const p=j(t);c=Ht(n.serverSyncTree_,u,p)}let h=u;c.length>0&&(h=Dr(n,u)),be(n.eventQueue_,h,c)}function Oc(n,e){Yu(n,"connected",e),!1===e&&function Cd(n){Or(n,"onDisconnectEvents");const e=po(n),t=ar();jn(n.onDisconnect_,W(),(o,u)=>{const c=m(o,u,n.serverSyncTree_,e);pt(t,o,c)});let r=[];jn(t,W(),(o,u)=>{r=r.concat(Ht(n.serverSyncTree_,o,u));const c=ec(n,o);Dr(n,c)}),n.onDisconnect_=ar(),be(n.eventQueue_,W(),r)}(n)}function Yu(n,e,t){const r=new U("/.info/"+e),o=j(t);n.infoData_.updateSnapshot(r,o);const u=Ht(n.infoSyncTree_,r,o);be(n.eventQueue_,r,u)}function hl(n){return n.nextWriteId_++}function Qu(n,e,t,r,o){Or(n,"set",{path:e.toString(),value:t,priority:r});const u=po(n),c=j(t,r),h=Tr(n.serverSyncTree_,e),p=y(c,h,u),g=hl(n),I=Er(n.serverSyncTree_,e,p,g,!0);dl(n.eventQueue_,I),n.server_.put(e.toString(),c.val(!0),(T,b)=>{const P="ok"===T;P||se("set at "+e+" failed: "+T);const F=Ue(n.serverSyncTree_,g,!P);be(n.eventQueue_,e,F),fn(0,o,T,b)});const E=ec(n,e);Dr(n,E),be(n.eventQueue_,E,[])}function wd(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,o)=>{"ok"===r&&on(n.onDisconnect_,e),fn(0,t,r,o)})}function Dc(n,e,t,r){const o=j(t);n.server_.onDisconnectPut(e.toString(),o.val(!0),(u,c)=>{"ok"===u&&pt(n.onDisconnect_,e,o),fn(0,r,u,c)})}function Ju(n,e,t){let r;r=".info"===L(e._path)?ke(n.infoSyncTree_,e,t):ke(n.serverSyncTree_,e,t),Sc(n.eventQueue_,e._path,r)}function xc(n){n.persistentConnection_&&n.persistentConnection_.interrupt(bc)}function Or(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),ee(t,...e)}function fn(n,e,t,r){e&&Yt(()=>{if("ok"===t)e(null);else{const o=(t||"error").toUpperCase();let u=o;r&&(u+=": "+r);const c=new Error(u);c.code=o,e(c)}})}function Xu(n,e,t){return Tr(n.serverSyncTree_,e,t)||D.EMPTY_NODE}function fl(n,e=n.transactionQueueTree_){if(e||pl(n,e),S(e)){const t=Mc(n,e);(0,_.hu)(t.length>0,"Sending zero length transaction queue"),t.every(o=>0===o.status)&&function Pd(n,e,t){const r=t.map(g=>g.currentWriteId),o=Xu(n,e,r);let u=o;const c=o.hash();for(let g=0;g<t.length;g++){const I=t[g];(0,_.hu)(0===I.status,"tryToSendTransactionQueue_: items in queue should all be run."),I.status=1,I.retryCount++;const E=oe(e,I.path);u=u.updateChild(E,I.currentOutputSnapshotRaw)}const h=u.val(!0),p=e;n.server_.put(p.toString(),h,g=>{Or(n,"transaction put response",{path:p.toString(),status:g});let I=[];if("ok"===g){const E=[];for(let T=0;T<t.length;T++)t[T].status=2,I=I.concat(Ue(n.serverSyncTree_,t[T].currentWriteId)),t[T].onComplete&&E.push(()=>t[T].onComplete(null,!0,t[T].currentOutputSnapshotResolved)),t[T].unwatcher();pl(n,k(n.transactionQueueTree_,e)),fl(n,n.transactionQueueTree_),be(n.eventQueue_,e,I);for(let T=0;T<E.length;T++)Yt(E[T])}else{if("datastale"===g)for(let E=0;E<t.length;E++)t[E].status=3===t[E].status?4:0;else{se("transaction at "+p.toString()+" failed: "+g);for(let E=0;E<t.length;E++)t[E].status=4,t[E].abortReason=g}Dr(n,e)}},c)}(n,hn(e),t)}else Ie(e)&&ri(e,t=>{fl(n,t)})}function Dr(n,e){const t=Lc(n,e),r=hn(t);return function Nd(n,e,t){if(0===e.length)return;const r=[];let o=[];const c=e.filter(h=>0===h.status).map(h=>h.currentWriteId);for(let h=0;h<e.length;h++){const p=e[h],g=oe(t,p.path);let E,I=!1;if((0,_.hu)(null!==g,"rerunTransactionsUnderNode_: relativePath should not be null."),4===p.status)I=!0,E=p.abortReason,o=o.concat(Ue(n.serverSyncTree_,p.currentWriteId,!0));else if(0===p.status)if(p.retryCount>=md)I=!0,E="maxretry",o=o.concat(Ue(n.serverSyncTree_,p.currentWriteId,!0));else{const T=Xu(n,p.path,c);p.currentInputSnapshot=T;const b=e[h].update(T.val());if(void 0!==b){co("transaction failed: Data returned ",b,p.path);let P=j(b);"object"==typeof b&&null!=b&&(0,_.r3)(b,".priority")||(P=P.updatePriority(T.getPriority()));const Q=p.currentWriteId,me=po(n),Ne=y(P,T,me);p.currentOutputSnapshotRaw=P,p.currentOutputSnapshotResolved=Ne,p.currentWriteId=hl(n),c.splice(c.indexOf(Q),1),o=o.concat(Er(n.serverSyncTree_,p.path,Ne,p.currentWriteId,p.applyLocally)),o=o.concat(Ue(n.serverSyncTree_,Q,!0))}else I=!0,E="nodata",o=o.concat(Ue(n.serverSyncTree_,p.currentWriteId,!0))}be(n.eventQueue_,t,o),o=[],I&&(e[h].status=2,setTimeout(e[h].unwatcher,Math.floor(0)),e[h].onComplete&&r.push("nodata"===E?()=>e[h].onComplete(null,!1,e[h].currentInputSnapshot):()=>e[h].onComplete(new Error(E),!1,null)))}pl(n,n.transactionQueueTree_);for(let h=0;h<r.length;h++)Yt(r[h]);fl(n,n.transactionQueueTree_)}(n,Mc(n,t),r),r}function Lc(n,e){let t,r=n.transactionQueueTree_;for(t=L(e);null!==t&&void 0===S(r);)r=k(r,t),t=L(e=B(e));return r}function Mc(n,e){const t=[];return Fc(n,e,t),t.sort((r,o)=>r.order-o.order),t}function Fc(n,e,t){const r=S(e);if(r)for(let o=0;o<r.length;o++)t.push(r[o]);ri(e,o=>{Fc(n,o,t)})}function pl(n,e){const t=S(e);if(t){let r=0;for(let o=0;o<t.length;o++)2!==t[o].status&&(t[r]=t[o],r++);t.length=r,z(e,t.length>0?t:void 0)}ri(e,r=>{pl(n,r)})}function ec(n,e){const t=hn(Lc(n,e)),r=k(n.transactionQueueTree_,e);return function ll(n,e,t){let r=t?n:n.parent;for(;null!==r;){if(e(r))return!0;r=r.parent}}(r,o=>{tc(n,o)}),tc(n,r),kr(r,o=>{tc(n,o)}),t}function tc(n,e){const t=S(e);if(t){const r=[];let o=[],u=-1;for(let c=0;c<t.length;c++)3===t[c].status||(1===t[c].status?((0,_.hu)(u===c-1,"All SENT items should be at beginning of queue."),u=c,t[c].status=3,t[c].abortReason="set"):((0,_.hu)(0===t[c].status,"Unexpected transaction status in abort"),t[c].unwatcher(),o=o.concat(Ue(n.serverSyncTree_,t[c].currentWriteId,!0)),t[c].onComplete&&r.push(t[c].onComplete.bind(null,new Error("set"),!1,null))));-1===u?z(e,void 0):t.length=u+1,be(n.eventQueue_,hn(e),o);for(let c=0;c<r.length;c++)Yt(r[c])}}const nc=function(n,e){const t=xd(n),r=t.namespace;return"firebase.com"===t.domain&&ye(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||"undefined"===r)&&"localhost"!==t.domain&&ye("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||typeof window<"u"&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&se("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new Mn(t.host,t.secure,r,"ws"===t.scheme||"wss"===t.scheme,e,"",r!==t.subdomain),path:new U(t.pathString)}},xd=function(n){let e="",t="",r="",o="",u="",c=!0,h="https",p=443;if("string"==typeof n){let g=n.indexOf("//");g>=0&&(h=n.substring(0,g-1),n=n.substring(g+2));let I=n.indexOf("/");-1===I&&(I=n.length);let E=n.indexOf("?");-1===E&&(E=n.length),e=n.substring(0,Math.min(I,E)),I<E&&(o=function Od(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let o=t[r];try{o=decodeURIComponent(o.replace(/\+/g," "))}catch{}e+="/"+o}return e}(n.substring(I,E)));const T=function Dd(n){const e={};"?"===n.charAt(0)&&(n=n.substring(1));for(const t of n.split("&")){if(0===t.length)continue;const r=t.split("=");2===r.length?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):se(`Invalid query segment '${t}' in query '${n}'`)}return e}(n.substring(Math.min(n.length,E)));g=e.indexOf(":"),g>=0?(c="https"===h||"wss"===h,p=parseInt(e.substring(g+1),10)):g=e.length;const b=e.slice(0,g);if("localhost"===b.toLowerCase())t="localhost";else if(b.split(".").length<=2)t=b;else{const P=e.indexOf(".");r=e.substring(0,P).toLowerCase(),t=e.substring(P+1),u=r}"ns"in T&&(u=T.ns)}return{host:e,port:p,domain:t,subdomain:r,secure:c,scheme:h,pathString:o,namespace:u}},Uc="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Ld=function(){let n=0;const e=[];return function(t){const r=t===n;let o;n=t;const u=new Array(8);for(o=7;o>=0;o--)u[o]=Uc.charAt(t%64),t=Math.floor(t/64);(0,_.hu)(0===t,"Cannot push at time == 0");let c=u.join("");if(r){for(o=11;o>=0&&63===e[o];o--)e[o]=0;e[o]++}else for(o=0;o<12;o++)e[o]=Math.floor(64*Math.random());for(o=0;o<12;o++)c+=Uc.charAt(e[o]);return(0,_.hu)(20===c.length,"nextPushId: Length should be 20."),c}}();class Wc{constructor(e,t,r,o){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=o}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,_.Wl)(this.snapshot.exportVal())}}class Vc{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class ic{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return(0,_.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Hc{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new _.BH;return wd(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){We("OnDisconnect.remove",this._path);const e=new _.BH;return Dc(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){We("OnDisconnect.set",this._path),Et("OnDisconnect.set",e,this._path,!1);const t=new _.BH;return Dc(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){We("OnDisconnect.setWithPriority",this._path),Et("OnDisconnect.setWithPriority",e,this._path,!1),qu("OnDisconnect.setWithPriority",t,!1);const r=new _.BH;return function Ad(n,e,t,r,o){const u=j(t,r);n.server_.onDisconnectPut(e.toString(),u.val(!0),(c,h)=>{"ok"===c&&pt(n.onDisconnect_,e,u),fn(0,o,c,h)})}(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){We("OnDisconnect.update",this._path),Ac("OnDisconnect.update",e,this._path,!1);const t=new _.BH;return function Rd(n,e,t,r){if((0,_.xb)(t))return ee("onDisconnect().update() called with empty data.  Don't do anything."),void fn(0,r,"ok",void 0);n.server_.onDisconnectMerge(e.toString(),t,(o,u)=>{"ok"===o&&$(t,(c,h)=>{const p=j(h);pt(n.onDisconnect_,V(e,c),p)}),fn(0,r,o,u)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class Ee{constructor(e,t,r,o){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=o}get key(){return x(this._path)?null:qi(this._path)}get ref(){return new Ve(this._repo,this._path)}get _queryIdentifier(){const e=Oa(this._queryParams),t=Dn(e);return"{}"===t?"default":t}get _queryObject(){return Oa(this._queryParams)}isEqual(e){if(!((e=(0,_.m9)(e))instanceof Ee))return!1;const t=this._repo===e._repo,r=Yi(this._path,e._path);return t&&r&&this._queryIdentifier===e._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function nu(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)""!==n.pieces_[t]&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}(this._path)}}function _l(n,e){if(!0===n._orderByCalled)throw new Error(e+": You can't combine multiple orderBy calls.")}function pn(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Le){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==ut)throw new Error(r);if("string"!=typeof e)throw new Error(o)}if(n.hasEnd()){if(n.getIndexEndName()!==Ae)throw new Error(r);if("string"!=typeof t)throw new Error(o)}}else if(n.getIndex()===H){if(null!=e&&!uo(e)||null!=t&&!uo(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,_.hu)(n.getIndex()instanceof Gn||n.getIndex()===zn,"unknown index type."),null!=e&&"object"==typeof e||null!=t&&"object"==typeof t)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function gl(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Ve extends Ee{constructor(e,t){super(e,t,new ir,!1)}get parent(){const e=ws(this._path);return null===e?null:new Ve(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class oi{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new U(e),r=ai(this.ref,e);return new oi(this._node.getChild(t),r,H)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(r,o)=>e(new oi(o,ai(this.ref,r),H)))}hasChild(e){const t=new U(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Bc(n,e){return(n=(0,_.m9)(n))._checkNotDeleted("ref"),void 0!==e?ai(n._root,e):n._root}function Gc(n,e){(n=(0,_.m9)(n))._checkNotDeleted("refFromURL");const t=nc(e,n._repo.repoInfo_.nodeAdmin);Rc("refFromURL",t);const r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&ye("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),Bc(n,t.path.toString())}function ai(n,e){return null===L((n=(0,_.m9)(n))._path)?pd("child","path",e,!1):fo("child","path",e,!1),new Ve(n._repo,V(n._path,e))}function rc(n,e){n=(0,_.m9)(n),We("set",n._path),Et("set",e,n._path,!1);const t=new _.BH;return Qu(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Vd(n,e){Ac("update",e,n._path,!1);const t=new _.BH;return function Td(n,e,t,r){Or(n,"update",{path:e.toString(),value:t});let o=!0;const u=po(n),c={};if($(t,(h,p)=>{o=!1,c[h]=m(V(e,h),j(p),n.serverSyncTree_,u)}),o)ee("update() called with empty data.  Don't do anything."),fn(0,r,"ok",void 0);else{const h=hl(n),p=function Hu(n,e,t,r){!function Gs(n,e,t,r){(0,_.hu)(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=Hs(n.visibleWrites,e,t),n.lastWriteId=r}(n.pendingWriteTree_,e,t,r);const o=G.fromObject(t);return te(n,new an({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,o))}(n.serverSyncTree_,e,c,h);dl(n.eventQueue_,p),n.server_.merge(e.toString(),t,(g,I)=>{const E="ok"===g;E||se("update at "+e+" failed: "+g);const T=Ue(n.serverSyncTree_,h,!E),b=T.length>0?Dr(n,e):e;be(n.eventQueue_,b,T),fn(0,r,g,I)}),$(t,g=>{const I=ec(n,V(e,g));Dr(n,I)}),be(n.eventQueue_,e,[])}}(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Hd(n){n=(0,_.m9)(n);const e=new ic(()=>{}),t=new _o(e);return function Ed(n,e,t){const r=function ol(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(g,I)=>{const E=oe(g,t);r=r||yt(I,E)});let o=n.syncPointTree_.get(t);o?r=r||yt(o,W()):(o=new il,n.syncPointTree_=n.syncPointTree_.set(t,o));const u=null!=r,c=u?new _t(r,!0,!1):null;return function Js(n){return dr(n.viewCache_)}(to(o,e,un(n.pendingWriteTree_,e._path),u?c.getNode():D.EMPTY_NODE,u))}(n.serverSyncTree_,e);return null!=r?Promise.resolve(r):n.server_.get(e).then(o=>{const u=j(o).withIndex(e._queryParams.getIndex());let c;if(so(n.serverSyncTree_,e,t,!0),e._queryParams.loadsAllData())c=Ht(n.serverSyncTree_,e._path,u);else{const h=ge(n.serverSyncTree_,e);c=ro(n.serverSyncTree_,e._path,u,h)}return be(n.eventQueue_,e._path,c),ke(n.serverSyncTree_,e,t,null,!0),u},o=>(Or(n,"get for query "+(0,_.Wl)(e)+" failed: "+o),Promise.reject(new Error(o))))}(n._repo,n,t).then(r=>new oi(r,new Ve(n._repo,n._path),n._queryParams.getIndex()))}class _o{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const r=t._queryParams.getIndex();return new Wc("value",this,new oi(e.snapshotNode,new Ve(t._repo,t._path),r))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Vc(this,e,t):null}matches(e){return e instanceof _o&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class ml{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Vc(this,e,t):null}createEvent(e,t){(0,_.hu)(null!=e.childName,"Child events should have a childName.");const r=ai(new Ve(t._repo,t._path),e.childName),o=t._queryParams.getIndex();return new Wc(e.type,this,new oi(e.snapshotNode,r,o),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof ml&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function go(n,e,t,r,o){let u;if("object"==typeof r&&(u=void 0,o=r),"function"==typeof r&&(u=r),o&&o.onlyOnce){const p=t,g=(I,E)=>{Ju(n._repo,n,h),p(I,E)};g.userCallback=t.userCallback,g.context=t.context,t=g}const c=new ic(t,u||void 0),h="value"===e?new _o(c):new ml(e,c);return function Sd(n,e,t){let r;r=".info"===L(e._path)?so(n.infoSyncTree_,e,t):so(n.serverSyncTree_,e,t),Sc(n.eventQueue_,e._path,r)}(n._repo,n,h),()=>Ju(n._repo,n,h)}function sc(n,e,t,r){return go(n,"value",e,t,r)}function zc(n,e,t,r){return go(n,"child_added",e,t,r)}function Zc(n,e,t,r){return go(n,"child_changed",e,t,r)}function Kc(n,e,t,r){return go(n,"child_moved",e,t,r)}function $c(n,e,t,r){return go(n,"child_removed",e,t,r)}function jc(n,e,t){let r=null;const o=t?new ic(t):null;"value"===e?r=new _o(o):e&&(r=new ml(e,o)),Ju(n._repo,n,r)}class Je{}class qc extends Je{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Et("endAt",this._value,e._path,!0);const t=$n(e._queryParams,this._value,this._key);if(gl(t),pn(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ee(e._repo,e._path,t,e._orderByCalled)}}class Gd extends Je{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Et("endBefore",this._value,e._path,!1);const t=function _u(n,e,t){let r;return r=$n(n,e,n.index_===Le||t?t:ut),r.endBeforeSet_=!0,r}(e._queryParams,this._value,this._key);if(gl(t),pn(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ee(e._repo,e._path,t,e._orderByCalled)}}class Yc extends Je{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Et("startAt",this._value,e._path,!0);const t=Ls(e._queryParams,this._value,this._key);if(gl(t),pn(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Ee(e._repo,e._path,t,e._orderByCalled)}}class Kd extends Je{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Et("startAfter",this._value,e._path,!1);const t=function pu(n,e,t){let r;return r=Ls(n,e,n.index_===Le||t?t:Ae),r.startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if(gl(t),pn(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Ee(e._repo,e._path,t,e._orderByCalled)}}class jd extends Je{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ee(e._repo,e._path,function Pa(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}(e._queryParams,this._limit),e._orderByCalled)}}class Yd extends Je{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ee(e._repo,e._path,function Na(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}(e._queryParams,this._limit),e._orderByCalled)}}class Jd extends Je{constructor(e){super(),this._path=e}_apply(e){_l(e,"orderByChild");const t=new U(this._path);if(x(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const r=new Gn(t),o=rr(e._queryParams,r);return pn(o),new Ee(e._repo,e._path,o,!0)}}class eh extends Je{_apply(e){_l(e,"orderByKey");const t=rr(e._queryParams,Le);return pn(t),new Ee(e._repo,e._path,t,!0)}}class nh extends Je{_apply(e){_l(e,"orderByPriority");const t=rr(e._queryParams,H);return pn(t),new Ee(e._repo,e._path,t,!0)}}class rh extends Je{_apply(e){_l(e,"orderByValue");const t=rr(e._queryParams,zn);return pn(t),new Ee(e._repo,e._path,t,!0)}}class oh extends Je{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(Et("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new qc(this._value,this._key)._apply(new Yc(this._value,this._key)._apply(e))}}function Xe(n,...e){let t=(0,_.m9)(n);for(const r of e)t=r._apply(t);return t}(function Mu(n){(0,_.hu)(!vr,"__referenceConstructor has already been defined"),vr=n})(Ve),function io(n){(0,_.hu)(!Ir,"__referenceConstructor has already been defined"),Ir=n}(Ve);const oc={};function Jc(n,e,t,r,o){let u=r||n.options.databaseURL;void 0===u&&(n.options.projectId||ye("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),ee("Using default host for project ",n.options.projectId),u=`${n.options.projectId}-default-rtdb.firebaseio.com`);let p,g,c=nc(u,o),h=c.repoInfo;typeof process<"u"&&process.env&&(g=process.env.FIREBASE_DATABASE_EMULATOR_HOST),g?(p=!0,u=`http://${g}?ns=${h.namespace}`,c=nc(u,o),h=c.repoInfo):p=!c.repoInfo.secure;const I=o&&p?new Ln(Ln.OWNER):new Vl(n.name,n.options,e);Rc("Invalid Firebase Database URL",c),x(c.path)||ye("Database URL must point to the root of a Firebase Database (not including a child path).");const E=function dh(n,e,t,r){let o=oc[e.name];o||(o={},oc[e.name]=o);let u=o[n.toURLString()];return u&&ye("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),u=new vd(n,false,t,r),o[n.toURLString()]=u,u}(h,n,I,new _s(n.name,t));return new fh(E,n)}class fh{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function yd(n,e,t){if(n.stats_=vs(n.repoInfo_),n.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)n.server_=new or(n.repoInfo_,(r,o,u,c)=>{Nc(n,r,o,u,c)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Oc(n,!0),0);else{if(typeof t<"u"&&null!==t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,_.Wl)(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Lt(n.repoInfo_,e,(r,o,u,c)=>{Nc(n,r,o,u,c)},r=>{Oc(n,r)},r=>{!function Id(n,e){$(e,(t,r)=>{Yu(n,t,r)})}(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=function ca(n,e){const t=n.toString();return ms[t]||(ms[t]=e()),ms[t]}(n.repoInfo_,()=>new Fa(n.stats_,n.server_)),n.infoData_=new Ms,n.infoSyncTree_=new dn({startListening:(r,o,u,c)=>{let h=[];const p=n.infoData_.getNode(r._path);return p.isEmpty()||(h=Ht(n.infoSyncTree_,r._path,p),setTimeout(()=>{c("ok")},0)),h},stopListening:()=>{}}),Yu(n,"connected",!1),n.serverSyncTree_=new dn({startListening:(r,o,u,c)=>(n.server_.listen(r,u,o,(h,p)=>{const g=c(h,p);be(n.eventQueue_,r._path,g)}),[]),stopListening:(r,o)=>{n.server_.unlisten(r,o)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ve(this._repo,W())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function ch(n,e){const t=oc[e];(!t||t[n.key]!==n)&&ye(`Database ${e}(${n.repoInfo_}) has already been deleted.`),xc(n),delete t[n.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&ye("Cannot call "+e+" on a deleted database.")}}function Xc(){Yl.IS_TRANSPORT_INITIALIZED&&se("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function ph(){Xc(),De.forceDisallow()}function _h(){Xc(),Xt.forceDisallow(),De.forceAllow()}function vh(n,e){Wi(n,e)}const Ih={".sv":"timestamp"};class Ch{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}Lt.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)},Lt.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)},function yh(n){na(Nt.SDK_VERSION),(0,Nt._registerComponent)(new He.wA("database",(e,{instanceIdentifier:t})=>Jc(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),(0,Nt.registerVersion)(xi,"0.14.4",n),(0,Nt.registerVersion)(xi,"0.14.4","esm2017")}();const Sh=new Zt.Yd("@firebase/database-compat"),td=function(n){Sh.warn("FIREBASE WARNING: "+n)};class Ph{constructor(e){this._delegate=e}cancel(e){(0,_.Dv)("OnDisconnect.cancel",0,1,arguments.length),(0,_.Wj)("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){(0,_.Dv)("OnDisconnect.remove",0,1,arguments.length),(0,_.Wj)("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){(0,_.Dv)("OnDisconnect.set",1,2,arguments.length),(0,_.Wj)("OnDisconnect.set","onComplete",t,!0);const r=this._delegate.set(e);return t&&r.then(()=>t(null),o=>t(o)),r}setWithPriority(e,t,r){(0,_.Dv)("OnDisconnect.setWithPriority",2,3,arguments.length),(0,_.Wj)("OnDisconnect.setWithPriority","onComplete",r,!0);const o=this._delegate.setWithPriority(e,t);return r&&o.then(()=>r(null),u=>r(u)),o}update(e,t){if((0,_.Dv)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const o={};for(let u=0;u<e.length;++u)o[""+u]=e[u];e=o,td("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}(0,_.Wj)("OnDisconnect.update","onComplete",t,!0);const r=this._delegate.update(e);return t&&r.then(()=>t(null),o=>t(o)),r}}class Nh{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return(0,_.Dv)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class _n{constructor(e,t){this._database=e,this._delegate=t}val(){return(0,_.Dv)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return(0,_.Dv)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return(0,_.Dv)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return(0,_.Dv)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return(0,_.Dv)("DataSnapshot.child",0,1,arguments.length),e=String(e),fo("DataSnapshot.child","path",e,!1),new _n(this._database,this._delegate.child(e))}hasChild(e){return(0,_.Dv)("DataSnapshot.hasChild",1,1,arguments.length),fo("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return(0,_.Dv)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return(0,_.Dv)("DataSnapshot.forEach",1,1,arguments.length),(0,_.Wj)("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new _n(this._database,t)))}hasChildren(){return(0,_.Dv)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return(0,_.Dv)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return(0,_.Dv)("DataSnapshot.ref",0,0,arguments.length),new Pe(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class le{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,o){var u;(0,_.Dv)("Query.on",2,4,arguments.length),(0,_.Wj)("Query.on","callback",t,!1);const c=le.getCancelAndContextArgs_("Query.on",r,o),h=(g,I)=>{t.call(c.context,new _n(this.database,g),I)};h.userCallback=t,h.context=c.context;const p=null===(u=c.cancel)||void 0===u?void 0:u.bind(c.context);switch(e){case"value":return sc(this._delegate,h,p),t;case"child_added":return zc(this._delegate,h,p),t;case"child_removed":return $c(this._delegate,h,p),t;case"child_changed":return Zc(this._delegate,h,p),t;case"child_moved":return Kc(this._delegate,h,p),t;default:throw new Error((0,_.gK)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if((0,_.Dv)("Query.off",0,3,arguments.length),function(n,e,t){if(void 0!==e)switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error((0,_.gK)("Query.off","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}(0,e),(0,_.Wj)("Query.off","callback",t,!0),(0,_.lb)("Query.off","context",r,!0),t){const o=()=>{};o.userCallback=t,o.context=r,jc(this._delegate,e,o)}else jc(this._delegate,e)}get(){return Hd(this._delegate).then(e=>new _n(this.database,e))}once(e,t,r,o){(0,_.Dv)("Query.once",1,4,arguments.length),(0,_.Wj)("Query.once","callback",t,!0);const u=le.getCancelAndContextArgs_("Query.once",r,o),c=new _.BH,h=(g,I)=>{const E=new _n(this.database,g);t&&t.call(u.context,E,I),c.resolve(E)};h.userCallback=t,h.context=u.context;const p=g=>{u.cancel&&u.cancel.call(u.context,g),c.reject(g)};switch(e){case"value":sc(this._delegate,h,p,{onlyOnce:!0});break;case"child_added":zc(this._delegate,h,p,{onlyOnce:!0});break;case"child_removed":$c(this._delegate,h,p,{onlyOnce:!0});break;case"child_changed":Zc(this._delegate,h,p,{onlyOnce:!0});break;case"child_moved":Kc(this._delegate,h,p,{onlyOnce:!0});break;default:throw new Error((0,_.gK)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return c.promise}limitToFirst(e){return(0,_.Dv)("Query.limitToFirst",1,1,arguments.length),new le(this.database,Xe(this._delegate,function qd(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new jd(n)}(e)))}limitToLast(e){return(0,_.Dv)("Query.limitToLast",1,1,arguments.length),new le(this.database,Xe(this._delegate,function Qd(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Yd(n)}(e)))}orderByChild(e){return(0,_.Dv)("Query.orderByChild",1,1,arguments.length),new le(this.database,Xe(this._delegate,function Xd(n){if("$key"===n)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===n)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===n)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return fo("orderByChild","path",n,!1),new Jd(n)}(e)))}orderByKey(){return(0,_.Dv)("Query.orderByKey",0,0,arguments.length),new le(this.database,Xe(this._delegate,function th(){return new eh}()))}orderByPriority(){return(0,_.Dv)("Query.orderByPriority",0,0,arguments.length),new le(this.database,Xe(this._delegate,function ih(){return new nh}()))}orderByValue(){return(0,_.Dv)("Query.orderByValue",0,0,arguments.length),new le(this.database,Xe(this._delegate,function sh(){return new rh}()))}startAt(e=null,t){return(0,_.Dv)("Query.startAt",0,2,arguments.length),new le(this.database,Xe(this._delegate,function Zd(n=null,e){return ho("startAt","key",e,!0),new Yc(n,e)}(e,t)))}startAfter(e=null,t){return(0,_.Dv)("Query.startAfter",0,2,arguments.length),new le(this.database,Xe(this._delegate,function $d(n,e){return ho("startAfter","key",e,!0),new Kd(n,e)}(e,t)))}endAt(e=null,t){return(0,_.Dv)("Query.endAt",0,2,arguments.length),new le(this.database,Xe(this._delegate,function Bd(n,e){return ho("endAt","key",e,!0),new qc(n,e)}(e,t)))}endBefore(e=null,t){return(0,_.Dv)("Query.endBefore",0,2,arguments.length),new le(this.database,Xe(this._delegate,function zd(n,e){return ho("endBefore","key",e,!0),new Gd(n,e)}(e,t)))}equalTo(e,t){return(0,_.Dv)("Query.equalTo",1,2,arguments.length),new le(this.database,Xe(this._delegate,function ah(n,e){return ho("equalTo","key",e,!0),new oh(n,e)}(e,t)))}toString(){return(0,_.Dv)("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return(0,_.Dv)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if((0,_.Dv)("Query.isEqual",1,1,arguments.length),!(e instanceof le))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){const o={cancel:void 0,context:void 0};if(t&&r)o.cancel=t,(0,_.Wj)(e,"cancel",o.cancel,!0),o.context=r,(0,_.lb)(e,"context",o.context,!0);else if(t)if("object"==typeof t&&null!==t)o.context=t;else{if("function"!=typeof t)throw new Error((0,_.gK)(e,"cancelOrContext")+" must either be a cancel callback or a context object.");o.cancel=t}return o}get ref(){return new Pe(this.database,new Ve(this._delegate._repo,this._delegate._path))}}class Pe extends le{constructor(e,t){super(e,new Ee(t._repo,t._path,new ir,!1)),this.database=e,this._delegate=t}getKey(){return(0,_.Dv)("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return(0,_.Dv)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new Pe(this.database,ai(this._delegate,e))}getParent(){(0,_.Dv)("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new Pe(this.database,e):null}getRoot(){return(0,_.Dv)("Reference.root",0,0,arguments.length),new Pe(this.database,this._delegate.root)}set(e,t){(0,_.Dv)("Reference.set",1,2,arguments.length),(0,_.Wj)("Reference.set","onComplete",t,!0);const r=rc(this._delegate,e);return t&&r.then(()=>t(null),o=>t(o)),r}update(e,t){if((0,_.Dv)("Reference.update",1,2,arguments.length),Array.isArray(e)){const o={};for(let u=0;u<e.length;++u)o[""+u]=e[u];e=o,td("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}We("Reference.update",this._delegate._path),(0,_.Wj)("Reference.update","onComplete",t,!0);const r=Vd(this._delegate,e);return t&&r.then(()=>t(null),o=>t(o)),r}setWithPriority(e,t,r){(0,_.Dv)("Reference.setWithPriority",2,3,arguments.length),(0,_.Wj)("Reference.setWithPriority","onComplete",r,!0);const o=function Wd(n,e,t){if(We("setWithPriority",n._path),Et("setWithPriority",e,n._path,!1),qu("setWithPriority",t,!1),".length"===n.key||".keys"===n.key)throw"setWithPriority failed: "+n.key+" is a read-only object.";const r=new _.BH;return Qu(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}(this._delegate,e,t);return r&&o.then(()=>r(null),u=>r(u)),o}remove(e){(0,_.Dv)("Reference.remove",0,1,arguments.length),(0,_.Wj)("Reference.remove","onComplete",e,!0);const t=function Fd(n){return We("remove",n._path),rc(n,null)}(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){(0,_.Dv)("Reference.transaction",1,3,arguments.length),(0,_.Wj)("Reference.transaction","transactionUpdate",e,!1),(0,_.Wj)("Reference.transaction","onComplete",t,!0),function(n,e,t,r){if(void 0!==t&&"boolean"!=typeof t)throw new Error((0,_.gK)("Reference.transaction","applyLocally")+"must be a boolean.")}(0,0,r);const o=function wh(n,e,t){var r;if(n=(0,_.m9)(n),We("Reference.transaction",n._path),".length"===n.key||".keys"===n.key)throw"Reference.transaction failed: "+n.key+" is a read-only object.";const o=null===(r=t?.applyLocally)||void 0===r||r,u=new _.BH,h=sc(n,()=>{});return function bd(n,e,t,r,o,u){Or(n,"transaction on "+e);const c={path:e,update:t,onComplete:r,status:null,order:Fi(),applyLocally:u,retryCount:0,unwatcher:o,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},h=Xu(n,e,void 0);c.currentInputSnapshot=h;const p=c.update(h.val());if(void 0===p)c.unwatcher(),c.currentOutputSnapshotRaw=null,c.currentOutputSnapshotResolved=null,c.onComplete&&c.onComplete(null,!1,c.currentInputSnapshot);else{co("transaction failed: Data returned ",p,c.path),c.status=0;const g=k(n.transactionQueueTree_,e),I=S(g)||[];let E;I.push(c),z(g,I),"object"==typeof p&&null!==p&&(0,_.r3)(p,".priority")?(E=(0,_.DV)(p,".priority"),(0,_.hu)(uo(E),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):E=(Tr(n.serverSyncTree_,e)||D.EMPTY_NODE).getPriority().val();const T=po(n),b=j(p,E),P=y(b,h,T);c.currentOutputSnapshotRaw=b,c.currentOutputSnapshotResolved=P,c.currentWriteId=hl(n);const F=Er(n.serverSyncTree_,e,P,c.currentWriteId,c.applyLocally);be(n.eventQueue_,e,F),fl(n,n.transactionQueueTree_)}}(n._repo,n._path,e,(p,g,I)=>{let E=null;p?u.reject(p):(E=new oi(I,new Ve(n._repo,n._path),H),u.resolve(new Ch(g,E)))},h,o),u.promise}(this._delegate,e,{applyLocally:r}).then(u=>new Nh(u.committed,new _n(this.database,u.snapshot)));return t&&o.then(u=>t(null,u.committed,u.snapshot),u=>t(u,!1,null)),o}setPriority(e,t){(0,_.Dv)("Reference.setPriority",1,2,arguments.length),(0,_.Wj)("Reference.setPriority","onComplete",t,!0);const r=function Ud(n,e){n=(0,_.m9)(n),We("setPriority",n._path),qu("setPriority",e,!1);const t=new _.BH;return Qu(n._repo,V(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}(this._delegate,e);return t&&r.then(()=>t(null),o=>t(o)),r}push(e,t){(0,_.Dv)("Reference.push",0,2,arguments.length),(0,_.Wj)("Reference.push","onComplete",t,!0);const r=function Md(n,e){n=(0,_.m9)(n),We("push",n._path),Et("push",e,n._path,!0);const t=Pc(n._repo),r=Ld(t),o=ai(n,r),u=ai(n,r);let c;return c=null!=e?rc(u,e).then(()=>u):Promise.resolve(u),o.then=c.then.bind(c),o.catch=c.then.bind(c,void 0),o}(this._delegate,e),o=r.then(c=>new Pe(this.database,c));t&&o.then(()=>t(null),c=>t(c));const u=new Pe(this.database,r);return u.then=o.then.bind(o),u.catch=o.catch.bind(o,void 0),u}onDisconnect(){return We("Reference.onDisconnect",this._delegate._path),new Ph(new Hc(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class mo{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:ph,forceLongPolling:_h}}useEmulator(e,t,r={}){!function ed(n,e,t,r={}){(n=(0,_.m9)(n))._checkNotDeleted("useEmulator"),n._instanceStarted&&ye("Cannot call useEmulator() after instance has already been initialized.");const o=n._repoInternal;let u;if(o.repoInfo_.nodeAdmin)r.mockUserToken&&ye('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),u=new Ln(Ln.OWNER);else if(r.mockUserToken){const c="string"==typeof r.mockUserToken?r.mockUserToken:(0,_.Sg)(r.mockUserToken,n.app.options.projectId);u=new Ln(c)}!function uh(n,e,t,r){n.repoInfo_=new Mn(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}(o,e,t,u)}(this._delegate,e,t,r)}ref(e){if((0,_.Dv)("database.ref",0,1,arguments.length),e instanceof Pe){const t=Gc(this._delegate,e.toString());return new Pe(this,t)}{const t=Bc(this._delegate,e);return new Pe(this,t)}}refFromURL(e){(0,_.Dv)("database.refFromURL",1,1,arguments.length);const r=Gc(this._delegate,e);return new Pe(this,r)}goOffline(){return(0,_.Dv)("database.goOffline",0,0,arguments.length),function gh(n){(n=(0,_.m9)(n))._checkNotDeleted("goOffline"),xc(n._repo)}(this._delegate)}goOnline(){return(0,_.Dv)("database.goOnline",0,0,arguments.length),function mh(n){(n=(0,_.m9)(n))._checkNotDeleted("goOnline"),function kd(n){n.persistentConnection_&&n.persistentConnection_.resume(bc)}(n._repo)}(this._delegate)}}mo.ServerValue={TIMESTAMP:function Eh(){return Ih}(),increment:n=>function Th(n){return{".sv":{increment:n}}}(n)};var Dh=Object.freeze({__proto__:null,initStandalone:function Oh({app:n,url:e,version:t,customAuthImpl:r,namespace:o,nodeAdmin:u=!1}){na(t);const c=new He.zt("auth-internal",new He.H0("database-standalone"));return c.setComponent(new He.wA("auth-internal",()=>r,"PRIVATE")),{instance:new mo(Jc(n,c,void 0,e,u),n),namespace:o}}});const xh=mo.ServerValue;function nd(n){return null==n}function id(n){return"function"==typeof n.set}function rd(n,e){return id(e)?e:n.ref(e)}function sd(n,e){if(function Mh(n){return"string"==typeof n}(n))return e.stringCase();if(id(n))return e.firebaseCase();if(function Fh(n){return"function"==typeof n.exportVal}(n))return e.snapshotCase();throw new Error("Expects a string, snapshot, or reference. Got: "+typeof n)}function vo(n,e,t="on",r=yc.z){return new gn.y(o=>{let u=null;return u=n[t](e,(c,h)=>{r.schedule(()=>{o.next({snapshot:c,prevKey:h})}),"once"===t&&r.schedule(()=>o.complete())},c=>{r.schedule(()=>o.error(c))}),"on"===t?{unsubscribe(){null!=u&&n.off(e,u)}}:{unsubscribe(){}}}).pipe((0,et.U)(o=>{const{snapshot:u,prevKey:c}=o;let h=null;return u.exists()&&(h=u.key),{type:e,payload:u,prevKey:c,key:h}}),(0,yo.B)())}function od(n,e){const t=n.length;for(let r=0;r<t;r++)if(n[r].payload.key===e)return r;return-1}function Vh(n,e){const{payload:t,prevKey:r,key:o}=e,u=od(n,o),c=function Wh(n,e){if(nd(e))return 0;{const t=od(n,e);return-1===t?n.length:t+1}}(n,r);switch(e.type){case"value":if(e.payload&&e.payload.exists()){let h=null;e.payload.forEach(p=>{const g={payload:p,type:"value",prevKey:h,key:p.key};return h=p.key,n=[...n,g],!1})}return n;case"child_added":if(u>-1){const h=n[u-1];(h&&h.key||null)!==r&&(n=n.filter(p=>p.payload.key!==t.key)).splice(c,0,e)}else{if(null==r)return[e,...n];(n=n.slice()).splice(c,0,e)}return n;case"child_removed":return n.filter(h=>h.payload.key!==t.key);case"child_changed":return n.map(h=>h.payload.key===o?e:h);case"child_moved":if(u>-1){const h=n.splice(u,1)[0];return(n=n.slice()).splice(c,0,h),n}return n;default:return n}}function ad(n){return(nd(n)||0===n.length)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function ld(n,e,t){return function Uh(n,e,t){return vo(n,"value","once",t).pipe((0,he.w)(r=>{const o=[(0,de.of)(r)];return e.forEach(u=>o.push(vo(n,u,"on",t))),(0,mn.T)(...o).pipe((0,Di.R)(Vh,[]))}),(0,Ze.x)())}(n,e=ad(e),t)}function ud(n,e,t){const r=(e=ad(e)).map(o=>vo(n,o,"on",t));return(0,mn.T)(...r)}function cd(n,e){return function(r,o){return sd(r,{stringCase:()=>n.child(r)[e](o),firebaseCase:()=>r[e](o),snapshotCase:()=>r.ref[e](o)})}}function zh(n){return function(t){return t?sd(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function dd(n,e){return function(){return vo(n,"value","on",e)}}!function Lh(n){n.INTERNAL.registerComponent(new He.wA("database-compat",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app-compat").getImmediate(),o=e.getProvider("database").getImmediate({identifier:t});return new mo(o,r)},"PUBLIC").setServiceProps({Reference:Pe,Query:le,Database:mo,DataSnapshot:_n,enableLogging:vh,INTERNAL:Dh,ServerValue:xh}).setMultipleInstances(!0)),n.registerVersion("@firebase/database-compat","0.3.4")}(ta.Z);const $h=new N.OlP("angularfire2.realtimeDatabaseURL"),jh=new N.OlP("angularfire2.database.use-emulator");let qh=(()=>{class n{constructor(t,r,o,u,c,h,p,g,I,E,T,b,P,F,Q){this.schedulers=h;const me=p,Ne=(0,fe.on)(t,c,r);g&&Qo(Ne,c,I,T,b,P,E,F),this.database=(0,fe.cc)(`${Ne.name}.database.${o}`,"AngularFireDatabase",Ne.name,()=>{const Tt=c.runOutsideAngular(()=>Ne.database(o||void 0));return me&&Tt.useEmulator(...me),Tt},[me])}list(t,r){const o=this.schedulers.ngZone.runOutsideAngular(()=>rd(this.database,t));let u=o;return r&&(u=r(o)),function Zh(n,e){const t=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:cd(r,"update"),set:cd(r,"set"),push:o=>r.push(o),remove:zh(r),snapshotChanges:o=>ld(n,o,t).pipe(Te.iC),stateChanges:o=>ud(n,o,t).pipe(Te.iC),auditTrail:o=>function Hh(n,e,t){return function Gh(n,e,t){return function Bh(n,e){return vo(n,"value","on",e).pipe((0,et.U)(t=>{let r;return t.payload.forEach(o=>(r=o.key,!1)),{data:t,lastKeyToLoad:r}}))}(n,t).pipe(function jt(...n){const e=(0,Ml.jO)(n);return(0,Pt.e)((t,r)=>{const o=n.length,u=new Array(o);let c=n.map(()=>!1),h=!1;for(let p=0;p<o;p++)(0,Jo.Xf)(n[p]).subscribe((0,st.x)(r,g=>{u[p]=g,!h&&!c[p]&&(c[p]=!0,(h=c.every(Xo.y))&&(c=null))},ea.Z));t.subscribe((0,st.x)(r,p=>{if(h){const g=[p,...u];r.next(e?e(...g):g)}}))})}(e),(0,et.U)(([o,u])=>{const c=o.lastKeyToLoad,h=u.map(p=>p.key);return{actions:u,lastKeyToLoad:c,loadedKeys:h}}),function Fl(n){return(0,Pt.e)((e,t)=>{let r=!1,o=0;e.subscribe((0,st.x)(t,u=>(r||(r=!n(u,o++)))&&t.next(u)))})}(o=>-1===o.loadedKeys.indexOf(o.lastKeyToLoad)),(0,et.U)(o=>o.actions))}(n,ud(n,e).pipe((0,Di.R)((o,u)=>[...o,u],[])),t)}(n,o,t).pipe(Te.iC),valueChanges:(o,u)=>ld(n,o,t).pipe((0,et.U)(h=>h.map(p=>u&&u.idField?Object.assign(Object.assign({},p.payload.val()),{[u.idField]:p.key}):p.payload.val())),Te.iC)}}(u,this)}object(t){return function Kh(n,e){return{query:n,snapshotChanges:()=>dd(n,e.schedulers.outsideAngular)().pipe(Te.iC),update:t=>n.ref.update(t),set:t=>n.ref.set(t),remove:()=>n.ref.remove(),valueChanges:()=>dd(n,e.schedulers.outsideAngular)().pipe(Te.iC,(0,et.U)(r=>r.payload.exists()?r.payload.val():null))}}(this.schedulers.ngZone.runOutsideAngular(()=>rd(this.database,t)),this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}}return n.\u0275fac=function(t){return new(t||n)(N.LFG(fe.Dh),N.LFG(fe.xv,8),N.LFG($h,8),N.LFG(N.Lbi),N.LFG(N.R0b),N.LFG(Te.HU),N.LFG(jh,8),N.LFG(ns,8),N.LFG(jo,8),N.LFG(Pi,8),N.LFG(qo,8),N.LFG(Yo,8),N.LFG(Ni,8),N.LFG(rt,8),N.LFG(Pn,8))},n.\u0275prov=N.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),Yh=(()=>{class n{constructor(t,r){this.afauth=t,this.db=r}login(t,r){var o=this;return(0,v.Z)(function*(){try{return yield o.afauth.signInWithEmailAndPassword(t,r)}catch(u){return console.log("error en login: ",u),null}})()}register({email:t,password:r}){var o=this;return(0,v.Z)(function*(){try{return yield o.afauth.createUserWithEmailAndPassword(t,r)}catch(u){return console.log("error en login: ",u),null}})()}logLogin(){var t=this;return(0,v.Z)(function*(){const r=yield t.afauth.currentUser;if(r){const o=r.email,u=(new Date).toISOString();t.db.list("/logUser").push({email:o,timestamp:u})}})()}logOut(){var t=this;return(0,v.Z)(function*(){try{return yield t.afauth.signOut()}catch(r){return console.log("error en login: ",r),null}})()}getUserLoggedIn(){return this.afauth.authState}static#e=this.\u0275fac=function(r){return new(r||n)(N.LFG(ns),N.LFG(qh))};static#t=this.\u0275prov=N.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})()},8977:(hd,vl,O)=>{O.r(vl);var v=O(5861),N=O(3399),w=O(9058),de=O(4268),gn=O(7582),ui=O(7879),mn=O(4537);const he={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"};const yl=function yo(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend."}},Il=function Lr(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Mr=new w.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),ci=new ui.Yd("@firebase/auth");function fe(a,...i){ci.logLevel<=ui.in.ERROR&&ci.error(`Auth (${de.SDK_VERSION}): ${a}`,...i)}function ne(a,...i){throw Eo(a,...i)}function ie(a,...i){return Eo(a,...i)}function vn(a,i,s){const l=Object.assign(Object.assign({},Il()),{[i]:s});return new w.LL("auth","Firebase",l).create(i,{appName:a.name})}function zt(a,i,s){if(!(i instanceof s))throw s.name!==i.constructor.name&&ne(a,"argument-error"),vn(a,"argument-error",`Type of ${i.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Eo(a,...i){if("string"!=typeof a){const s=i[0],l=[...i.slice(1)];return l[0]&&(l[0].appName=a.name),a._errorFactory.create(s,...l)}return Mr.create(a,...i)}function A(a,i,...s){if(!a)throw Eo(i,...s)}function ve(a){const i="INTERNAL ASSERTION FAILED: "+a;throw fe(i),new Error(i)}function Oe(a,i){a||ve(i)}function di(){var a;return typeof self<"u"&&(null===(a=self.location)||void 0===a?void 0:a.href)||""}function Fr(){return"http:"===To()||"https:"===To()}function To(){var a;return typeof self<"u"&&(null===(a=self.location)||void 0===a?void 0:a.protocol)||null}class hi{constructor(i,s){this.shortDelay=i,this.longDelay=s,Oe(s>i,"Short delay should be less than long delay!"),this.isMobile=(0,w.uI)()||(0,w.b$)()}get(){return function lc(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Fr()||(0,w.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Co(a,i){Oe(a.emulator,"Emulator should always be set here");const{url:s}=a.emulator;return i?`${s}${i.startsWith("/")?i.slice(1):i}`:s}class El{static initialize(i,s,l){this.fetchImpl=i,s&&(this.headersImpl=s),l&&(this.responseImpl=l)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:void ve("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:void ve("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:void ve("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const cc={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},dc=new hi(3e4,6e4);function q(a,i){return a.tenantId&&!i.tenantId?Object.assign(Object.assign({},i),{tenantId:a.tenantId}):i}function Z(a,i,s,l){return He.apply(this,arguments)}function He(){return(He=(0,v.Z)(function*(a,i,s,l,d={}){return _(a,d,(0,v.Z)(function*(){let f={},m={};l&&("GET"===i?m=l:f={body:JSON.stringify(l)});const y=(0,w.xO)(Object.assign({key:a.config.apiKey},m)).slice(1),C=yield a._getAdditionalHeaders();return C["Content-Type"]="application/json",a.languageCode&&(C["X-Firebase-Locale"]=a.languageCode),El.fetch()(wo(a,a.config.apiHost,s,y),Object.assign({method:i,headers:C,referrerPolicy:"no-referrer"},f))}))})).apply(this,arguments)}function _(a,i,s){return Zt.apply(this,arguments)}function Zt(){return(Zt=(0,v.Z)(function*(a,i,s){a._canInitEmulator=!1;const l=Object.assign(Object.assign({},cc),i);try{const d=new Y(a),f=yield Promise.race([s(),d.promise]);d.clearNetworkTimeout();const m=yield f.json();if("needConfirmation"in m)throw yn(a,"account-exists-with-different-credential",m);if(f.ok&&!("errorMessage"in m))return m;{const y=f.ok?m.errorMessage:m.error.message,[C,R]=y.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===C)throw yn(a,"credential-already-in-use",m);if("EMAIL_EXISTS"===C)throw yn(a,"email-already-in-use",m);if("USER_DISABLED"===C)throw yn(a,"user-disabled",m);const k=l[C]||C.toLowerCase().replace(/[_\s]+/g,"-");if(R)throw vn(a,k,R);ne(a,k)}}catch(d){if(d instanceof w.ZR)throw d;ne(a,"network-request-failed",{message:String(d)})}})).apply(this,arguments)}function Ce(a,i,s,l){return fi.apply(this,arguments)}function fi(){return(fi=(0,v.Z)(function*(a,i,s,l,d={}){const f=yield Z(a,i,s,l,d);return"mfaPendingCredential"in f&&ne(a,"multi-factor-auth-required",{_serverResponse:f}),f})).apply(this,arguments)}function wo(a,i,s,l){const d=`${i}${s}?${l}`;return a.config.emulator?Co(a.config,d):`${a.config.apiScheme}://${d}`}class Y{constructor(i){this.auth=i,this.timer=null,this.promise=new Promise((s,l)=>{this.timer=setTimeout(()=>l(ie(this.auth,"network-request-failed")),dc.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function yn(a,i,s){const l={appName:a.name};s.email&&(l.email=s.email),s.phoneNumber&&(l.phoneNumber=s.phoneNumber);const d=ie(a,i,l);return d.customData._tokenResponse=s,d}function In(){return(In=(0,v.Z)(function*(a,i){return Z(a,"POST","/v1/accounts:delete",i)})).apply(this,arguments)}function Ur(){return(Ur=(0,v.Z)(function*(a,i){return Z(a,"POST","/v1/accounts:update",i)})).apply(this,arguments)}function _i(){return(_i=(0,v.Z)(function*(a,i){return Z(a,"POST","/v1/accounts:lookup",i)})).apply(this,arguments)}function En(a){if(a)try{const i=new Date(Number(a));if(!isNaN(i.getTime()))return i.toUTCString()}catch{}}function Wr(){return(Wr=(0,v.Z)(function*(a,i=!1){const s=(0,w.m9)(a),l=yield s.getIdToken(i),d=Ct(l);A(d&&d.exp&&d.auth_time&&d.iat,s.auth,"internal-error");const f="object"==typeof d.firebase?d.firebase:void 0,m=f?.sign_in_provider;return{claims:d,token:l,authTime:En(X(d.auth_time)),issuedAtTime:En(X(d.iat)),expirationTime:En(X(d.exp)),signInProvider:m||null,signInSecondFactor:f?.sign_in_second_factor||null}})).apply(this,arguments)}function X(a){return 1e3*Number(a)}function Ct(a){const[i,s,l]=a.split(".");if(void 0===i||void 0===s||void 0===l)return fe("JWT malformed, contained fewer than 3 sections"),null;try{const d=(0,w.tV)(s);return d?JSON.parse(d):(fe("Failed to decode base64 JWT payload"),null)}catch(d){return fe("Caught error parsing JWT payload as JSON",d?.toString()),null}}function we(a,i){return Kt.apply(this,arguments)}function Kt(){return(Kt=(0,v.Z)(function*(a,i,s=!1){if(s)return i;try{return yield i}catch(l){throw l instanceof w.ZR&&function gi({code:a}){return"auth/user-disabled"===a||"auth/user-token-expired"===a}(l)&&a.auth.currentUser===a&&(yield a.auth.signOut()),l}})).apply(this,arguments)}class Hr{constructor(i){this.user=i,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(i){var s;if(i){const l=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),l}{this.errorBackoff=3e4;const d=(null!==(s=this.user.stsTokenManager.expirationTime)&&void 0!==s?s:0)-Date.now()-3e5;return Math.max(0,d)}}schedule(i=!1){var s=this;if(!this.isRunning)return;const l=this.getInterval(i);this.timerId=setTimeout((0,v.Z)(function*(){yield s.iteration()}),l)}iteration(){var i=this;return(0,v.Z)(function*(){try{yield i.user.getIdToken(!0)}catch(s){return void("auth/network-request-failed"===s?.code&&i.schedule(!0))}i.schedule()})()}}class Ao{constructor(i,s){this.createdAt=i,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=En(this.lastLoginAt),this.creationTime=En(this.createdAt)}_copy(i){this.createdAt=i.createdAt,this.lastLoginAt=i.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function Tn(a){return mi.apply(this,arguments)}function mi(){return mi=(0,v.Z)(function*(a){var i;const s=a.auth,l=yield a.getIdToken(),d=yield we(a,function Cl(a,i){return _i.apply(this,arguments)}(s,{idToken:l}));A(d?.users.length,s,"internal-error");const f=d.users[0];a._notifyReloadListener(f);const m=null!==(i=f.providerUserInfo)&&void 0!==i&&i.length?function Ro(a){return a.map(i=>{var{providerId:s}=i,l=(0,gn._T)(i,["providerId"]);return{providerId:s,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}(f.providerUserInfo):[],y=function Cn(a,i){return[...a.filter(l=>!i.some(d=>d.providerId===l.providerId)),...i]}(a.providerData,m),k=!!a.isAnonymous&&!(a.email&&f.passwordHash||y?.length),S={uid:f.localId,displayName:f.displayName||null,photoURL:f.photoUrl||null,email:f.email||null,emailVerified:f.emailVerified||!1,phoneNumber:f.phoneNumber||null,tenantId:f.tenantId||null,providerData:y,metadata:new Ao(f.createdAt,f.lastLoginAt),isAnonymous:k};Object.assign(a,S)}),mi.apply(this,arguments)}function Br(){return(Br=(0,v.Z)(function*(a){const i=(0,w.m9)(a);yield Tn(i),yield i.auth._persistUserIfCurrent(i),i.auth._notifyListenersIfCurrent(i)})).apply(this,arguments)}function yi(){return(yi=(0,v.Z)(function*(a,i){const s=yield _(a,{},(0,v.Z)(function*(){const l=(0,w.xO)({grant_type:"refresh_token",refresh_token:i}).slice(1),{tokenApiHost:d,apiKey:f}=a.config,m=wo(a,d,"/v1/token",`key=${f}`),y=yield a._getAdditionalHeaders();return y["Content-Type"]="application/x-www-form-urlencoded",El.fetch()(m,{method:"POST",headers:y,body:l})}));return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}})).apply(this,arguments)}class wn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(i){A(i.idToken,"internal-error"),A(typeof i.idToken<"u","internal-error"),A(typeof i.refreshToken<"u","internal-error");const s="expiresIn"in i&&typeof i.expiresIn<"u"?Number(i.expiresIn):function Vr(a){const i=Ct(a);return A(i,"internal-error"),A(typeof i.exp<"u","internal-error"),A(typeof i.iat<"u","internal-error"),Number(i.exp)-Number(i.iat)}(i.idToken);this.updateTokensAndExpiration(i.idToken,i.refreshToken,s)}getToken(i,s=!1){var l=this;return(0,v.Z)(function*(){return A(!l.accessToken||l.refreshToken,i,"user-token-expired"),s||!l.accessToken||l.isExpired?l.refreshToken?(yield l.refresh(i,l.refreshToken),l.accessToken):null:l.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(i,s){var l=this;return(0,v.Z)(function*(){const{accessToken:d,refreshToken:f,expiresIn:m}=yield function vi(a,i){return yi.apply(this,arguments)}(i,s);l.updateTokensAndExpiration(d,f,Number(m))})()}updateTokensAndExpiration(i,s,l){this.refreshToken=s||null,this.accessToken=i||null,this.expirationTime=Date.now()+1e3*l}static fromJSON(i,s){const{refreshToken:l,accessToken:d,expirationTime:f}=s,m=new wn;return l&&(A("string"==typeof l,"internal-error",{appName:i}),m.refreshToken=l),d&&(A("string"==typeof d,"internal-error",{appName:i}),m.accessToken=d),f&&(A("number"==typeof f,"internal-error",{appName:i}),m.expirationTime=f),m}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(i){this.accessToken=i.accessToken,this.refreshToken=i.refreshToken,this.expirationTime=i.expirationTime}_clone(){return Object.assign(new wn,this.toJSON())}_performRefresh(){return ve("not implemented")}}function tt(a,i){A("string"==typeof a||typeof a>"u","internal-error",{appName:i})}class wt{constructor(i){var{uid:s,auth:l,stsTokenManager:d}=i,f=(0,gn._T)(i,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Hr(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=l,this.stsTokenManager=d,this.accessToken=d.accessToken,this.displayName=f.displayName||null,this.email=f.email||null,this.emailVerified=f.emailVerified||!1,this.phoneNumber=f.phoneNumber||null,this.photoURL=f.photoURL||null,this.isAnonymous=f.isAnonymous||!1,this.tenantId=f.tenantId||null,this.providerData=f.providerData?[...f.providerData]:[],this.metadata=new Ao(f.createdAt||void 0,f.lastLoginAt||void 0)}getIdToken(i){var s=this;return(0,v.Z)(function*(){const l=yield we(s,s.stsTokenManager.getToken(s.auth,i));return A(l,s.auth,"internal-error"),s.accessToken!==l&&(s.accessToken=l,yield s.auth._persistUserIfCurrent(s),s.auth._notifyListenersIfCurrent(s)),l})()}getIdTokenResult(i){return function wl(a){return Wr.apply(this,arguments)}(this,i)}reload(){return function Al(a){return Br.apply(this,arguments)}(this)}_assign(i){this!==i&&(A(this.uid===i.uid,this.auth,"internal-error"),this.displayName=i.displayName,this.photoURL=i.photoURL,this.email=i.email,this.emailVerified=i.emailVerified,this.phoneNumber=i.phoneNumber,this.isAnonymous=i.isAnonymous,this.tenantId=i.tenantId,this.providerData=i.providerData.map(s=>Object.assign({},s)),this.metadata._copy(i.metadata),this.stsTokenManager._assign(i.stsTokenManager))}_clone(i){const s=new wt(Object.assign(Object.assign({},this),{auth:i,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(i){A(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=i,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(i){this.reloadListener?this.reloadListener(i):this.reloadUserInfo=i}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(i,s=!1){var l=this;return(0,v.Z)(function*(){let d=!1;i.idToken&&i.idToken!==l.stsTokenManager.accessToken&&(l.stsTokenManager.updateFromServerResponse(i),d=!0),s&&(yield Tn(l)),yield l.auth._persistUserIfCurrent(l),d&&l.auth._notifyListenersIfCurrent(l)})()}delete(){var i=this;return(0,v.Z)(function*(){const s=yield i.getIdToken();return yield we(i,function pi(a,i){return In.apply(this,arguments)}(i.auth,{idToken:s})),i.stsTokenManager.clearRefreshToken(),i.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(i=>Object.assign({},i)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(i,s){var l,d,f,m,y,C,R,k;const S=null!==(l=s.displayName)&&void 0!==l?l:void 0,z=null!==(d=s.email)&&void 0!==d?d:void 0,Ie=null!==(f=s.phoneNumber)&&void 0!==f?f:void 0,Sr=null!==(m=s.photoURL)&&void 0!==m?m:void 0,ri=null!==(y=s.tenantId)&&void 0!==y?y:void 0,kr=null!==(C=s._redirectEventId)&&void 0!==C?C:void 0,ll=null!==(R=s.createdAt)&&void 0!==R?R:void 0,hn=null!==(k=s.lastLoginAt)&&void 0!==k?k:void 0,{uid:si,emailVerified:ul,isAnonymous:cl,providerData:lo,stsTokenManager:br}=s;A(si&&br,i,"internal-error");const Pr=wn.fromJSON(this.name,br);A("string"==typeof si,i,"internal-error"),tt(S,i.name),tt(z,i.name),A("boolean"==typeof ul,i,"internal-error"),A("boolean"==typeof cl,i,"internal-error"),tt(Ie,i.name),tt(Sr,i.name),tt(ri,i.name),tt(kr,i.name),tt(ll,i.name),tt(hn,i.name);const Nr=new wt({uid:si,auth:i,email:z,emailVerified:ul,displayName:S,isAnonymous:cl,photoURL:Sr,phoneNumber:Ie,tenantId:ri,stsTokenManager:Pr,createdAt:ll,lastLoginAt:hn});return lo&&Array.isArray(lo)&&(Nr.providerData=lo.map(ju=>Object.assign({},ju))),kr&&(Nr._redirectEventId=kr),Nr}static _fromIdTokenResponse(i,s,l=!1){return(0,v.Z)(function*(){const d=new wn;d.updateFromServerResponse(s);const f=new wt({uid:s.localId,auth:i,stsTokenManager:d,isAnonymous:l});return yield Tn(f),f})()}}const So=new Map;function ue(a){Oe(a instanceof Function,"Expected a class definition");let i=So.get(a);return i?(Oe(i instanceof a,"Instance stored in cache mismatched with class"),i):(i=new a,So.set(a,i),i)}const At=(()=>{class a{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,v.Z)(function*(){return!0})()}_set(s,l){var d=this;return(0,v.Z)(function*(){d.storage[s]=l})()}_get(s){var l=this;return(0,v.Z)(function*(){const d=l.storage[s];return void 0===d?null:d})()}_remove(s){var l=this;return(0,v.Z)(function*(){delete l.storage[s]})()}_addListener(s,l){}_removeListener(s,l){}}return a.type="NONE",a})();function Be(a,i,s){return`firebase:${a}:${i}:${s}`}class Rt{constructor(i,s,l){this.persistence=i,this.auth=s,this.userKey=l;const{config:d,name:f}=this.auth;this.fullUserKey=Be(this.userKey,d.apiKey,f),this.fullPersistenceKey=Be("persistence",d.apiKey,f),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(i){return this.persistence._set(this.fullUserKey,i.toJSON())}getCurrentUser(){var i=this;return(0,v.Z)(function*(){const s=yield i.persistence._get(i.fullUserKey);return s?wt._fromJSON(i.auth,s):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(i){var s=this;return(0,v.Z)(function*(){if(s.persistence===i)return;const l=yield s.getCurrentUser();return yield s.removeCurrentUser(),s.persistence=i,l?s.setCurrentUser(l):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(i,s,l="authUser"){return(0,v.Z)(function*(){if(!s.length)return new Rt(ue(At),i,l);const d=(yield Promise.all(s.map(function(){var R=(0,v.Z)(function*(k){if(yield k._isAvailable())return k});return function(k){return R.apply(this,arguments)}}()))).filter(R=>R);let f=d[0]||ue(At);const m=Be(l,i.config.apiKey,i.name);let y=null;for(const R of s)try{const k=yield R._get(m);if(k){const S=wt._fromJSON(i,k);R!==f&&(y=S),f=R;break}}catch{}const C=d.filter(R=>R._shouldAllowMigration);return f._shouldAllowMigration&&C.length?(f=C[0],y&&(yield f._set(m,y.toJSON())),yield Promise.all(s.map(function(){var R=(0,v.Z)(function*(k){if(k!==f)try{yield k._remove(m)}catch{}});return function(k){return R.apply(this,arguments)}}())),new Rt(f,i,l)):new Rt(f,i,l)})()}}function $t(a){const i=a.toLowerCase();if(i.includes("opera/")||i.includes("opr/")||i.includes("opios/"))return"Opera";if(Po(i))return"IEMobile";if(i.includes("msie")||i.includes("trident/"))return"IE";if(i.includes("edge/"))return"Edge";if(bo(i))return"Firefox";if(i.includes("silk/"))return"Silk";if(Ei(i))return"Blackberry";if(Ti(i))return"Webos";if(An(i))return"Safari";if((i.includes("chrome/")||Ii(i))&&!i.includes("edge/"))return"Chrome";if(St(i))return"Android";{const l=a.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===l?.length)return l[1]}return"Other"}function bo(a=(0,w.z$)()){return/firefox\//i.test(a)}function An(a=(0,w.z$)()){const i=a.toLowerCase();return i.includes("safari/")&&!i.includes("chrome/")&&!i.includes("crios/")&&!i.includes("android")}function Ii(a=(0,w.z$)()){return/crios\//i.test(a)}function Po(a=(0,w.z$)()){return/iemobile/i.test(a)}function St(a=(0,w.z$)()){return/android/i.test(a)}function Ei(a=(0,w.z$)()){return/blackberry/i.test(a)}function Ti(a=(0,w.z$)()){return/webos/i.test(a)}function nt(a=(0,w.z$)()){return/iphone|ipad|ipod/i.test(a)||/macintosh/i.test(a)&&/mobile/i.test(a)}function Rn(a=(0,w.z$)()){return nt(a)||St(a)||Ti(a)||Ei(a)||/windows phone/i.test(a)||Po(a)}function zr(a,i=[]){let s;switch(a){case"Browser":s=$t((0,w.z$)());break;case"Worker":s=`${$t((0,w.z$)())}-${a}`;break;default:s=a}const l=i.length?i.join(","):"FirebaseCore-web";return`${s}/JsCore/${de.SDK_VERSION}/${l}`}function Sn(){return(Sn=(0,v.Z)(function*(a){return(yield Z(a,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function Ci(a,i){return wi.apply(this,arguments)}function wi(){return(wi=(0,v.Z)(function*(a,i){return Z(a,"GET","/v2/recaptchaConfig",q(a,i))})).apply(this,arguments)}function No(a){return void 0!==a&&void 0!==a.getResponse}function Kr(a){return void 0!==a&&void 0!==a.enterprise}class kt{constructor(i){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===i.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=i.recaptchaKey.split("/")[3],this.emailPasswordEnabled=i.recaptchaEnforcementState.some(s=>"EMAIL_PASSWORD_PROVIDER"===s.provider&&"OFF"!==s.enforcementState)}}function $r(a){return new Promise((i,s)=>{const l=document.createElement("script");l.setAttribute("src",a),l.onload=i,l.onerror=d=>{const f=ie("internal-error");f.customData=d,s(f)},l.type="text/javascript",l.charset="UTF-8",function Oo(){var a,i;return null!==(i=null===(a=document.getElementsByTagName("head"))||void 0===a?void 0:a[0])&&void 0!==i?i:document}().appendChild(l)})}function Do(a){return`__${a}${Math.floor(1e6*Math.random())}`}class xo{constructor(i){this.type="recaptcha-enterprise",this.auth=K(i)}verify(i="verify",s=!1){var l=this;return(0,v.Z)(function*(){function f(){return f=(0,v.Z)(function*(y){if(!s){if(null==y.tenantId&&null!=y._agentRecaptchaConfig)return y._agentRecaptchaConfig.siteKey;if(null!=y.tenantId&&void 0!==y._tenantRecaptchaConfigs[y.tenantId])return y._tenantRecaptchaConfigs[y.tenantId].siteKey}return new Promise(function(){var C=(0,v.Z)(function*(R,k){Ci(y,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(S=>{if(void 0!==S.recaptchaKey){const z=new kt(S);return null==y.tenantId?y._agentRecaptchaConfig=z:y._tenantRecaptchaConfigs[y.tenantId]=z,R(z.siteKey)}k(new Error("recaptcha Enterprise site key undefined"))}).catch(S=>{k(S)})});return function(R,k){return C.apply(this,arguments)}}())}),f.apply(this,arguments)}function m(y,C,R){const k=window.grecaptcha;Kr(k)?k.enterprise.ready(()=>{k.enterprise.execute(y,{action:i}).then(S=>{C(S)}).catch(()=>{C("NO_RECAPTCHA")})}):R(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((y,C)=>{(function d(y){return f.apply(this,arguments)})(l.auth).then(R=>{if(!s&&Kr(window.grecaptcha))m(R,y,C);else{if(typeof window>"u")return void C(new Error("RecaptchaVerifier is only supported in browser"));$r("https://www.google.com/recaptcha/enterprise.js?render="+R).then(()=>{m(R,y,C)}).catch(k=>{C(k)})}}).catch(R=>{C(R)})})})()}}function it(a,i,s){return jr.apply(this,arguments)}function jr(){return(jr=(0,v.Z)(function*(a,i,s,l=!1){const d=new xo(a);let f;try{f=yield d.verify(s)}catch{f=yield d.verify(s,!0)}const m=Object.assign({},i);return Object.assign(m,l?{captchaResp:f}:{captchaResponse:f}),Object.assign(m,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(m,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),m})).apply(this,arguments)}class Ol{constructor(i){this.auth=i,this.queue=[]}pushCallback(i,s){const l=f=>new Promise((m,y)=>{try{m(i(f))}catch(C){y(C)}});l.onAbort=s,this.queue.push(l);const d=this.queue.length-1;return()=>{this.queue[d]=()=>Promise.resolve()}}runMiddleware(i){var s=this;return(0,v.Z)(function*(){if(s.auth.currentUser===i)return;const l=[];try{for(const d of s.queue)yield d(i),d.onAbort&&l.push(d.onAbort)}catch(d){l.reverse();for(const f of l)try{f()}catch{}throw s.auth._errorFactory.create("login-blocked",{originalMessage:d?.message})}})()}}class Ai{constructor(i,s,l,d){this.app=i,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=l,this.config=d,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new qr(this),this.idTokenSubscription=new qr(this),this.beforeStateQueue=new Ol(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Mr,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=i.name,this.clientVersion=d.sdkClientVersion}_initializeWithPersistence(i,s){var l=this;return s&&(this._popupRedirectResolver=ue(s)),this._initializationPromise=this.queue((0,v.Z)(function*(){var d,f;if(!l._deleted&&(l.persistenceManager=yield Rt.create(l,i),!l._deleted)){if(null!==(d=l._popupRedirectResolver)&&void 0!==d&&d._shouldInitProactively)try{yield l._popupRedirectResolver._initialize(l)}catch{}yield l.initializeCurrentUser(s),l.lastNotifiedUid=(null===(f=l.currentUser)||void 0===f?void 0:f.uid)||null,!l._deleted&&(l._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var i=this;return(0,v.Z)(function*(){if(i._deleted)return;const s=yield i.assertedPersistence.getCurrentUser();if(i.currentUser||s){if(i.currentUser&&s&&i.currentUser.uid===s.uid)return i._currentUser._assign(s),void(yield i.currentUser.getIdToken());yield i._updateCurrentUser(s,!0)}})()}initializeCurrentUser(i){var s=this;return(0,v.Z)(function*(){var l;const d=yield s.assertedPersistence.getCurrentUser();let f=d,m=!1;if(i&&s.config.authDomain){yield s.getOrInitRedirectPersistenceManager();const y=null===(l=s.redirectUser)||void 0===l?void 0:l._redirectEventId,C=f?._redirectEventId,R=yield s.tryRedirectSignIn(i);(!y||y===C)&&R?.user&&(f=R.user,m=!0)}if(!f)return s.directlySetCurrentUser(null);if(!f._redirectEventId){if(m)try{yield s.beforeStateQueue.runMiddleware(f)}catch(y){f=d,s._popupRedirectResolver._overrideRedirectResult(s,()=>Promise.reject(y))}return f?s.reloadAndSetCurrentUserOrClear(f):s.directlySetCurrentUser(null)}return A(s._popupRedirectResolver,s,"argument-error"),yield s.getOrInitRedirectPersistenceManager(),s.redirectUser&&s.redirectUser._redirectEventId===f._redirectEventId?s.directlySetCurrentUser(f):s.reloadAndSetCurrentUserOrClear(f)})()}tryRedirectSignIn(i){var s=this;return(0,v.Z)(function*(){let l=null;try{l=yield s._popupRedirectResolver._completeRedirectFn(s,i,!0)}catch{yield s._setRedirectUser(null)}return l})()}reloadAndSetCurrentUserOrClear(i){var s=this;return(0,v.Z)(function*(){try{yield Tn(i)}catch(l){if("auth/network-request-failed"!==l?.code)return s.directlySetCurrentUser(null)}return s.directlySetCurrentUser(i)})()}useDeviceLanguage(){this.languageCode=function uc(){if(typeof navigator>"u")return null;const a=navigator;return a.languages&&a.languages[0]||a.language||null}()}_delete(){var i=this;return(0,v.Z)(function*(){i._deleted=!0})()}updateCurrentUser(i){var s=this;return(0,v.Z)(function*(){const l=i?(0,w.m9)(i):null;return l&&A(l.auth.config.apiKey===s.config.apiKey,s,"invalid-user-token"),s._updateCurrentUser(l&&l._clone(s))})()}_updateCurrentUser(i,s=!1){var l=this;return(0,v.Z)(function*(){if(!l._deleted)return i&&A(l.tenantId===i.tenantId,l,"tenant-id-mismatch"),s||(yield l.beforeStateQueue.runMiddleware(i)),l.queue((0,v.Z)(function*(){yield l.directlySetCurrentUser(i),l.notifyAuthListeners()}))})()}signOut(){var i=this;return(0,v.Z)(function*(){return yield i.beforeStateQueue.runMiddleware(null),(i.redirectPersistenceManager||i._popupRedirectResolver)&&(yield i._setRedirectUser(null)),i._updateCurrentUser(null,!0)})()}setPersistence(i){var s=this;return this.queue((0,v.Z)(function*(){yield s.assertedPersistence.setPersistence(ue(i))}))}initializeRecaptchaConfig(){var i=this;return(0,v.Z)(function*(){const s=yield Ci(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),l=new kt(s);null==i.tenantId?i._agentRecaptchaConfig=l:i._tenantRecaptchaConfigs[i.tenantId]=l,l.emailPasswordEnabled&&new xo(i).verify()})()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(i){this._errorFactory=new w.LL("auth","Firebase",i())}onAuthStateChanged(i,s,l){return this.registerStateListener(this.authStateSubscription,i,s,l)}beforeAuthStateChanged(i,s){return this.beforeStateQueue.pushCallback(i,s)}onIdTokenChanged(i,s,l){return this.registerStateListener(this.idTokenSubscription,i,s,l)}toJSON(){var i;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(i=this._currentUser)||void 0===i?void 0:i.toJSON()}}_setRedirectUser(i,s){var l=this;return(0,v.Z)(function*(){const d=yield l.getOrInitRedirectPersistenceManager(s);return null===i?d.removeCurrentUser():d.setCurrentUser(i)})()}getOrInitRedirectPersistenceManager(i){var s=this;return(0,v.Z)(function*(){if(!s.redirectPersistenceManager){const l=i&&ue(i)||s._popupRedirectResolver;A(l,s,"argument-error"),s.redirectPersistenceManager=yield Rt.create(s,[ue(l._redirectPersistence)],"redirectUser"),s.redirectUser=yield s.redirectPersistenceManager.getCurrentUser()}return s.redirectPersistenceManager})()}_redirectUserForId(i){var s=this;return(0,v.Z)(function*(){var l,d;return s._isInitialized&&(yield s.queue((0,v.Z)(function*(){}))),(null===(l=s._currentUser)||void 0===l?void 0:l._redirectEventId)===i?s._currentUser:(null===(d=s.redirectUser)||void 0===d?void 0:d._redirectEventId)===i?s.redirectUser:null})()}_persistUserIfCurrent(i){var s=this;return(0,v.Z)(function*(){if(i===s.currentUser)return s.queue((0,v.Z)(function*(){return s.directlySetCurrentUser(i)}))})()}_notifyListenersIfCurrent(i){i===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var i,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=null!==(s=null===(i=this.currentUser)||void 0===i?void 0:i.uid)&&void 0!==s?s:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(i,s,l,d){if(this._deleted)return()=>{};const f="function"==typeof s?s:s.next.bind(s),m=this._isInitialized?Promise.resolve():this._initializationPromise;return A(m,this,"internal-error"),m.then(()=>f(this.currentUser)),"function"==typeof s?i.addObserver(s,l,d):i.addObserver(s)}directlySetCurrentUser(i){var s=this;return(0,v.Z)(function*(){s.currentUser&&s.currentUser!==i&&s._currentUser._stopProactiveRefresh(),i&&s.isProactiveRefreshEnabled&&i._startProactiveRefresh(),s.currentUser=i,i?yield s.assertedPersistence.setCurrentUser(i):yield s.assertedPersistence.removeCurrentUser()})()}queue(i){return this.operations=this.operations.then(i,i),this.operations}get assertedPersistence(){return A(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(i){!i||this.frameworks.includes(i)||(this.frameworks.push(i),this.frameworks.sort(),this.clientVersion=zr(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var i=this;return(0,v.Z)(function*(){var s;const l={"X-Client-Version":i.clientVersion};i.app.options.appId&&(l["X-Firebase-gmpid"]=i.app.options.appId);const d=yield null===(s=i.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===s?void 0:s.getHeartbeatsHeader();d&&(l["X-Firebase-Client"]=d);const f=yield i._getAppCheckToken();return f&&(l["X-Firebase-AppCheck"]=f),l})()}_getAppCheckToken(){var i=this;return(0,v.Z)(function*(){var s;const l=yield null===(s=i.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===s?void 0:s.getToken();return l?.error&&function Te(a,...i){ci.logLevel<=ui.in.WARN&&ci.warn(`Auth (${de.SDK_VERSION}): ${a}`,...i)}(`Error while retrieving App Check token: ${l.error}`),l?.token})()}}function K(a){return(0,w.m9)(a)}class qr{constructor(i){this.auth=i,this.observer=null,this.addObserver=(0,w.ne)(s=>this.observer=s)}get next(){return A(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Mo(a){const i=a.indexOf(":");return i<0?"":a.substr(0,i+1)}function Qr(a){if(!a)return null;const i=Number(a);return isNaN(i)?null:i}class bt{constructor(i,s){this.providerId=i,this.signInMethod=s}toJSON(){return ve("not implemented")}_getIdTokenResponse(i){return ve("not implemented")}_linkToIdToken(i,s){return ve("not implemented")}_getReauthenticationResolver(i){return ve("not implemented")}}function Jr(a,i){return Wo.apply(this,arguments)}function Wo(){return(Wo=(0,v.Z)(function*(a,i){return Z(a,"POST","/v1/accounts:resetPassword",q(a,i))})).apply(this,arguments)}function Vo(a,i){return Ho.apply(this,arguments)}function Ho(){return(Ho=(0,v.Z)(function*(a,i){return Z(a,"POST","/v1/accounts:update",i)})).apply(this,arguments)}function kn(){return(kn=(0,v.Z)(function*(a,i){return Z(a,"POST","/v1/accounts:update",q(a,i))})).apply(this,arguments)}function Bo(a,i){return Go.apply(this,arguments)}function Go(){return(Go=(0,v.Z)(function*(a,i){return Ce(a,"POST","/v1/accounts:signInWithPassword",q(a,i))})).apply(this,arguments)}function Ri(a,i){return Si.apply(this,arguments)}function Si(){return(Si=(0,v.Z)(function*(a,i){return Z(a,"POST","/v1/accounts:sendOobCode",q(a,i))})).apply(this,arguments)}function ki(){return(ki=(0,v.Z)(function*(a,i){return Ri(a,i)})).apply(this,arguments)}function bn(a,i){return Pn.apply(this,arguments)}function Pn(){return(Pn=(0,v.Z)(function*(a,i){return Ri(a,i)})).apply(this,arguments)}function zo(a,i){return Nn.apply(this,arguments)}function Nn(){return(Nn=(0,v.Z)(function*(a,i){return Ri(a,i)})).apply(this,arguments)}function Xr(){return(Xr=(0,v.Z)(function*(a,i){return Ri(a,i)})).apply(this,arguments)}function es(){return(es=(0,v.Z)(function*(a,i){return Ce(a,"POST","/v1/accounts:signInWithEmailLink",q(a,i))})).apply(this,arguments)}function Zo(){return(Zo=(0,v.Z)(function*(a,i){return Ce(a,"POST","/v1/accounts:signInWithEmailLink",q(a,i))})).apply(this,arguments)}class bi extends bt{constructor(i,s,l,d=null){super("password",l),this._email=i,this._password=s,this._tenantId=d}static _fromEmailAndPassword(i,s){return new bi(i,s,"password")}static _fromEmailAndCode(i,s,l=null){return new bi(i,s,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(i){const s="string"==typeof i?JSON.parse(i):i;if(s?.email&&s?.password){if("password"===s.signInMethod)return this._fromEmailAndPassword(s.email,s.password);if("emailLink"===s.signInMethod)return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}_getIdTokenResponse(i){var s=this;return(0,v.Z)(function*(){var l;switch(s.signInMethod){case"password":const d={returnSecureToken:!0,email:s._email,password:s._password,clientType:"CLIENT_TYPE_WEB"};if(null!==(l=i._getRecaptchaConfig())&&void 0!==l&&l.emailPasswordEnabled){const f=yield it(i,d,"signInWithPassword");return Bo(i,f)}return Bo(i,d).catch(function(){var f=(0,v.Z)(function*(m){if("auth/missing-recaptcha-token"===m.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const y=yield it(i,d,"signInWithPassword");return Bo(i,y)}return Promise.reject(m)});return function(m){return f.apply(this,arguments)}}());case"emailLink":return function _c(a,i){return es.apply(this,arguments)}(i,{email:s._email,oobCode:s._password});default:ne(i,"internal-error")}})()}_linkToIdToken(i,s){var l=this;return(0,v.Z)(function*(){switch(l.signInMethod){case"password":return Vo(i,{idToken:s,returnSecureToken:!0,email:l._email,password:l._password});case"emailLink":return function Ll(a,i){return Zo.apply(this,arguments)}(i,{idToken:s,email:l._email,oobCode:l._password});default:ne(i,"internal-error")}})()}_getReauthenticationResolver(i){return this._getIdTokenResponse(i)}}function Ge(a,i){return Ko.apply(this,arguments)}function Ko(){return(Ko=(0,v.Z)(function*(a,i){return Ce(a,"POST","/v1/accounts:signInWithIdp",q(a,i))})).apply(this,arguments)}class ze extends bt{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(i){const s=new ze(i.providerId,i.signInMethod);return i.idToken||i.accessToken?(i.idToken&&(s.idToken=i.idToken),i.accessToken&&(s.accessToken=i.accessToken),i.nonce&&!i.pendingToken&&(s.nonce=i.nonce),i.pendingToken&&(s.pendingToken=i.pendingToken)):i.oauthToken&&i.oauthTokenSecret?(s.accessToken=i.oauthToken,s.secret=i.oauthTokenSecret):ne("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(i){const s="string"==typeof i?JSON.parse(i):i,{providerId:l,signInMethod:d}=s,f=(0,gn._T)(s,["providerId","signInMethod"]);if(!l||!d)return null;const m=new ze(l,d);return m.idToken=f.idToken||void 0,m.accessToken=f.accessToken||void 0,m.secret=f.secret,m.nonce=f.nonce,m.pendingToken=f.pendingToken||null,m}_getIdTokenResponse(i){return Ge(i,this.buildRequest())}_linkToIdToken(i,s){const l=this.buildRequest();return l.idToken=s,Ge(i,l)}_getReauthenticationResolver(i){const s=this.buildRequest();return s.autoCreate=!1,Ge(i,s)}buildRequest(){const i={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)i.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),i.postBody=(0,w.xO)(s)}return i}}function $o(){return($o=(0,v.Z)(function*(a,i){return Z(a,"POST","/v1/accounts:sendVerificationCode",q(a,i))})).apply(this,arguments)}function ts(){return(ts=(0,v.Z)(function*(a,i){return Ce(a,"POST","/v1/accounts:signInWithPhoneNumber",q(a,i))})).apply(this,arguments)}function Pi(){return(Pi=(0,v.Z)(function*(a,i){const s=yield Ce(a,"POST","/v1/accounts:signInWithPhoneNumber",q(a,i));if(s.temporaryProof)throw yn(a,"account-exists-with-different-credential",s);return s})).apply(this,arguments)}const qo={USER_NOT_FOUND:"user-not-found"};function Ni(){return(Ni=(0,v.Z)(function*(a,i){return Ce(a,"POST","/v1/accounts:signInWithPhoneNumber",q(a,Object.assign(Object.assign({},i),{operation:"REAUTH"})),qo)})).apply(this,arguments)}class rt extends bt{constructor(i){super("phone","phone"),this.params=i}static _fromVerification(i,s){return new rt({verificationId:i,verificationCode:s})}static _fromTokenResponse(i,s){return new rt({phoneNumber:i,temporaryProof:s})}_getIdTokenResponse(i){return function vc(a,i){return ts.apply(this,arguments)}(i,this._makeVerificationRequest())}_linkToIdToken(i,s){return function jo(a,i){return Pi.apply(this,arguments)}(i,Object.assign({idToken:s},this._makeVerificationRequest()))}_getReauthenticationResolver(i){return function Yo(a,i){return Ni.apply(this,arguments)}(i,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:i,phoneNumber:s,verificationId:l,verificationCode:d}=this.params;return i&&s?{temporaryProof:i,phoneNumber:s}:{sessionInfo:l,code:d}}toJSON(){const i={providerId:this.providerId};return this.params.phoneNumber&&(i.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(i.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(i.verificationCode=this.params.verificationCode),this.params.verificationId&&(i.verificationId=this.params.verificationId),i}static fromJSON(i){"string"==typeof i&&(i=JSON.parse(i));const{verificationId:s,verificationCode:l,phoneNumber:d,temporaryProof:f}=i;return l||s||d||f?new rt({verificationId:s,verificationCode:l,phoneNumber:d,temporaryProof:f}):null}}class Oi{constructor(i){var s,l,d,f,m,y;const C=(0,w.zd)((0,w.pd)(i)),R=null!==(s=C.apiKey)&&void 0!==s?s:null,k=null!==(l=C.oobCode)&&void 0!==l?l:null,S=function Qo(a){switch(a){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(d=C.mode)&&void 0!==d?d:null);A(R&&k&&S,"argument-error"),this.apiKey=R,this.operation=S,this.code=k,this.continueUrl=null!==(f=C.continueUrl)&&void 0!==f?f:null,this.languageCode=null!==(m=C.languageCode)&&void 0!==m?m:null,this.tenantId=null!==(y=C.tenantId)&&void 0!==y?y:null}static parseLink(i){const s=function ns(a){const i=(0,w.zd)((0,w.pd)(a)).link,s=i?(0,w.zd)((0,w.pd)(i)).deep_link_id:null,l=(0,w.zd)((0,w.pd)(a)).deep_link_id;return(l?(0,w.zd)((0,w.pd)(l)).link:null)||l||s||i||a}(i);try{return new Oi(s)}catch{return null}}}let Di=(()=>{class a{constructor(){this.providerId=a.PROVIDER_ID}static credential(s,l){return bi._fromEmailAndPassword(s,l)}static credentialWithLink(s,l){const d=Oi.parseLink(l);return A(d,"argument-error"),bi._fromEmailAndCode(s,d.code,d.tenantId)}}return a.PROVIDER_ID="password",a.EMAIL_PASSWORD_SIGN_IN_METHOD="password",a.EMAIL_LINK_SIGN_IN_METHOD="emailLink",a})();class Ze{constructor(i){this.providerId=i,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(i){this.defaultLanguageCode=i}setCustomParameters(i){return this.customParameters=i,this}getCustomParameters(){return this.customParameters}}class Pt extends Ze{constructor(){super(...arguments),this.scopes=[]}addScope(i){return this.scopes.includes(i)||this.scopes.push(i),this}getScopes(){return[...this.scopes]}}class st extends Pt{static credentialFromJSON(i){const s="string"==typeof i?JSON.parse(i):i;return A("providerId"in s&&"signInMethod"in s,"argument-error"),ze._fromParams(s)}credential(i){return this._credential(Object.assign(Object.assign({},i),{nonce:i.rawNonce}))}_credential(i){return A(i.idToken||i.accessToken,"argument-error"),ze._fromParams(Object.assign(Object.assign({},i),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(i){return st.oauthCredentialFromTaggedObject(i)}static credentialFromError(i){return st.oauthCredentialFromTaggedObject(i.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:i}){if(!i)return null;const{oauthIdToken:s,oauthAccessToken:l,oauthTokenSecret:d,pendingToken:f,nonce:m,providerId:y}=i;if(!l&&!d&&!s&&!f||!y)return null;try{return new st(y)._credential({idToken:s,accessToken:l,nonce:m,pendingToken:f})}catch{return null}}}let Jo=(()=>{class a extends Pt{constructor(){super("facebook.com")}static credential(s){return ze._fromParams({providerId:a.PROVIDER_ID,signInMethod:a.FACEBOOK_SIGN_IN_METHOD,accessToken:s})}static credentialFromResult(s){return a.credentialFromTaggedObject(s)}static credentialFromError(s){return a.credentialFromTaggedObject(s.customData||{})}static credentialFromTaggedObject({_tokenResponse:s}){if(!s||!("oauthAccessToken"in s)||!s.oauthAccessToken)return null;try{return a.credential(s.oauthAccessToken)}catch{return null}}}return a.FACEBOOK_SIGN_IN_METHOD="facebook.com",a.PROVIDER_ID="facebook.com",a})(),Xo=(()=>{class a extends Pt{constructor(){super("google.com"),this.addScope("profile")}static credential(s,l){return ze._fromParams({providerId:a.PROVIDER_ID,signInMethod:a.GOOGLE_SIGN_IN_METHOD,idToken:s,accessToken:l})}static credentialFromResult(s){return a.credentialFromTaggedObject(s)}static credentialFromError(s){return a.credentialFromTaggedObject(s.customData||{})}static credentialFromTaggedObject({_tokenResponse:s}){if(!s)return null;const{oauthIdToken:l,oauthAccessToken:d}=s;if(!l&&!d)return null;try{return a.credential(l,d)}catch{return null}}}return a.GOOGLE_SIGN_IN_METHOD="google.com",a.PROVIDER_ID="google.com",a})(),ea=(()=>{class a extends Pt{constructor(){super("github.com")}static credential(s){return ze._fromParams({providerId:a.PROVIDER_ID,signInMethod:a.GITHUB_SIGN_IN_METHOD,accessToken:s})}static credentialFromResult(s){return a.credentialFromTaggedObject(s)}static credentialFromError(s){return a.credentialFromTaggedObject(s.customData||{})}static credentialFromTaggedObject({_tokenResponse:s}){if(!s||!("oauthAccessToken"in s)||!s.oauthAccessToken)return null;try{return a.credential(s.oauthAccessToken)}catch{return null}}}return a.GITHUB_SIGN_IN_METHOD="github.com",a.PROVIDER_ID="github.com",a})();class jt extends bt{constructor(i,s){super(i,i),this.pendingToken=s}_getIdTokenResponse(i){return Ge(i,this.buildRequest())}_linkToIdToken(i,s){const l=this.buildRequest();return l.idToken=s,Ge(i,l)}_getReauthenticationResolver(i){const s=this.buildRequest();return s.autoCreate=!1,Ge(i,s)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(i){const s="string"==typeof i?JSON.parse(i):i,{providerId:l,signInMethod:d,pendingToken:f}=s;return l&&d&&f&&l===d?new jt(l,f):null}static _create(i,s){return new jt(i,s)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class is extends Ze{constructor(i){A(i.startsWith("saml."),"argument-error"),super(i)}static credentialFromResult(i){return is.samlCredentialFromTaggedObject(i)}static credentialFromError(i){return is.samlCredentialFromTaggedObject(i.customData||{})}static credentialFromJSON(i){const s=jt.fromJSON(i);return A(s,"argument-error"),s}static samlCredentialFromTaggedObject({_tokenResponse:i}){if(!i)return null;const{pendingToken:s,providerId:l}=i;if(!s||!l)return null;try{return jt._create(l,s)}catch{return null}}}let ta=(()=>{class a extends Pt{constructor(){super("twitter.com")}static credential(s,l){return ze._fromParams({providerId:a.PROVIDER_ID,signInMethod:a.TWITTER_SIGN_IN_METHOD,oauthToken:s,oauthTokenSecret:l})}static credentialFromResult(s){return a.credentialFromTaggedObject(s)}static credentialFromError(s){return a.credentialFromTaggedObject(s.customData||{})}static credentialFromTaggedObject({_tokenResponse:s}){if(!s)return null;const{oauthAccessToken:l,oauthTokenSecret:d}=s;if(!l||!d)return null;try{return a.credential(l,d)}catch{return null}}}return a.TWITTER_SIGN_IN_METHOD="twitter.com",a.PROVIDER_ID="twitter.com",a})();function Nt(a,i){return xi.apply(this,arguments)}function xi(){return(xi=(0,v.Z)(function*(a,i){return Ce(a,"POST","/v1/accounts:signUp",q(a,i))})).apply(this,arguments)}class pe{constructor(i){this.user=i.user,this.providerId=i.providerId,this._tokenResponse=i._tokenResponse,this.operationType=i.operationType}static _fromIdTokenResponse(i,s,l,d=!1){return(0,v.Z)(function*(){const f=yield wt._fromIdTokenResponse(i,l,d),m=Li(l);return new pe({user:f,providerId:m,_tokenResponse:l,operationType:s})})()}static _forOperation(i,s,l){return(0,v.Z)(function*(){yield i._updateTokensIfNecessary(l,!0);const d=Li(l);return new pe({user:i,providerId:d,_tokenResponse:l,operationType:s})})()}}function Li(a){return a.providerId?a.providerId:"phoneNumber"in a?"phone":null}function rs(){return(rs=(0,v.Z)(function*(a){var i;const s=K(a);if(yield s._initializationPromise,null!==(i=s.currentUser)&&void 0!==i&&i.isAnonymous)return new pe({user:s.currentUser,providerId:null,operationType:"signIn"});const l=yield Nt(s,{returnSecureToken:!0}),d=yield pe._fromIdTokenResponse(s,"signIn",l,!0);return yield s._updateCurrentUser(d.user),d})).apply(this,arguments)}class Mi extends w.ZR{constructor(i,s,l,d){var f;super(s.code,s.message),this.operationType=l,this.user=d,Object.setPrototypeOf(this,Mi.prototype),this.customData={appName:i.name,tenantId:null!==(f=i.tenantId)&&void 0!==f?f:void 0,_serverResponse:s.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(i,s,l,d){return new Mi(i,s,l,d)}}function ss(a,i,s,l){return("reauthenticate"===i?s._getReauthenticationResolver(a):s._getIdTokenResponse(a)).catch(f=>{throw"auth/multi-factor-auth-required"===f.code?Mi._fromErrorAndOperation(a,f,i,l):f})}function ot(a){return new Set(a.map(({providerId:i})=>i).filter(i=>!!i))}function at(){return at=(0,v.Z)(function*(a,i){const s=(0,w.m9)(a);yield lt(!0,s,i);const{providerUserInfo:l}=yield function Tl(a,i){return Ur.apply(this,arguments)}(s.auth,{idToken:yield s.getIdToken(),deleteProvider:[i]}),d=ot(l||[]);return s.providerData=s.providerData.filter(f=>d.has(f.providerId)),d.has("phone")||(s.phoneNumber=null),yield s.auth._persistUserIfCurrent(s),s}),at.apply(this,arguments)}function Fi(a,i){return Ui.apply(this,arguments)}function Ui(){return(Ui=(0,v.Z)(function*(a,i,s=!1){const l=yield we(a,i._linkToIdToken(a.auth,yield a.getIdToken()),s);return pe._forOperation(a,"link",l)})).apply(this,arguments)}function lt(a,i,s){return Ke.apply(this,arguments)}function Ke(){return(Ke=(0,v.Z)(function*(a,i,s){yield Tn(i);const d=!1===a?"provider-already-linked":"no-such-provider";A(ot(i.providerData).has(s)===a,i.auth,d)})).apply(this,arguments)}function as(a,i){return Wi.apply(this,arguments)}function Wi(){return(Wi=(0,v.Z)(function*(a,i,s=!1){const{auth:l}=a,d="reauthenticate";try{const f=yield we(a,ss(l,d,i,a),s);A(f.idToken,l,"internal-error");const m=Ct(f.idToken);A(m,l,"internal-error");const{sub:y}=m;return A(a.uid===y,l,"user-mismatch"),pe._forOperation(a,d,f)}catch(f){throw"auth/user-not-found"===f?.code&&ne(l,"user-mismatch"),f}})).apply(this,arguments)}function ee(a,i){return Ot.apply(this,arguments)}function Ot(){return(Ot=(0,v.Z)(function*(a,i,s=!1){const l="signIn",d=yield ss(a,l,i),f=yield pe._fromIdTokenResponse(a,l,d);return s||(yield a._updateCurrentUser(f.user)),f})).apply(this,arguments)}function qt(a,i){return ye.apply(this,arguments)}function ye(){return(ye=(0,v.Z)(function*(a,i){return ee(K(a),i)})).apply(this,arguments)}function se(a,i){return ls.apply(this,arguments)}function ls(){return(ls=(0,v.Z)(function*(a,i){const s=(0,w.m9)(a);return yield lt(!1,s,i.providerId),Fi(s,i)})).apply(this,arguments)}function On(a,i){return us.apply(this,arguments)}function us(){return(us=(0,v.Z)(function*(a,i){return as((0,w.m9)(a),i)})).apply(this,arguments)}function Ae(){return(Ae=(0,v.Z)(function*(a,i){return Ce(a,"POST","/v1/accounts:signInWithCustomToken",q(a,i))})).apply(this,arguments)}function cs(){return cs=(0,v.Z)(function*(a,i){const s=K(a),l=yield function ut(a,i){return Ae.apply(this,arguments)}(s,{token:i,returnSecureToken:!0}),d=yield pe._fromIdTokenResponse(s,"signIn",l);return yield s._updateCurrentUser(d.user),d}),cs.apply(this,arguments)}class $e{constructor(i,s){this.factorId=i,this.uid=s.mfaEnrollmentId,this.enrollmentTime=new Date(s.enrolledAt).toUTCString(),this.displayName=s.displayName}static _fromServerResponse(i,s){return"phoneInfo"in s?Dn._fromServerResponse(i,s):"totpInfo"in s?Vi._fromServerResponse(i,s):ne(i,"internal-error")}}class Dn extends $e{constructor(i){super("phone",i),this.phoneNumber=i.phoneInfo}static _fromServerResponse(i,s){return new Dn(s)}}class Vi extends $e{constructor(i){super("totp",i)}static _fromServerResponse(i,s){return new Vi(s)}}function $(a,i,s){var l;A((null===(l=s.url)||void 0===l?void 0:l.length)>0,a,"invalid-continue-uri"),A(typeof s.dynamicLinkDomain>"u"||s.dynamicLinkDomain.length>0,a,"invalid-dynamic-link-domain"),i.continueUrl=s.url,i.dynamicLinkDomain=s.dynamicLinkDomain,i.canHandleCodeInApp=s.handleCodeInApp,s.iOS&&(A(s.iOS.bundleId.length>0,a,"missing-ios-bundle-id"),i.iOSBundleId=s.iOS.bundleId),s.android&&(A(s.android.packageName.length>0,a,"missing-android-pkg-name"),i.androidInstallApp=s.android.installApp,i.androidMinimumVersionCode=s.android.minimumVersion,i.androidPackageName=s.android.packageName)}function ds(){return ds=(0,v.Z)(function*(a,i,s){var l;const d=K(a),f={requestType:"PASSWORD_RESET",email:i,clientType:"CLIENT_TYPE_WEB"};if(null!==(l=d._getRecaptchaConfig())&&void 0!==l&&l.emailPasswordEnabled){const m=yield it(d,f,"getOobCode",!0);s&&$(d,m,s),yield bn(d,m)}else s&&$(d,f,s),yield bn(d,f).catch(function(){var m=(0,v.Z)(function*(y){if("auth/missing-recaptcha-token"!==y.code)return Promise.reject(y);{console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");const C=yield it(d,f,"getOobCode",!0);s&&$(d,C,s),yield bn(d,C)}});return function(y){return m.apply(this,arguments)}}())}),ds.apply(this,arguments)}function hs(){return(hs=(0,v.Z)(function*(a,i,s){yield Jr((0,w.m9)(a),{oobCode:i,newPassword:s})})).apply(this,arguments)}function fs(){return fs=(0,v.Z)(function*(a,i){yield function fc(a,i){return kn.apply(this,arguments)}((0,w.m9)(a),{oobCode:i})}),fs.apply(this,arguments)}function ra(a,i){return Hi.apply(this,arguments)}function Hi(){return(Hi=(0,v.Z)(function*(a,i){const s=(0,w.m9)(a),l=yield Jr(s,{oobCode:i}),d=l.requestType;switch(A(d,s,"internal-error"),d){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":A(l.newEmail,s,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":A(l.mfaInfo,s,"internal-error");default:A(l.email,s,"internal-error")}let f=null;return l.mfaInfo&&(f=$e._fromServerResponse(K(s),l.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.newEmail:l.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.email:l.newEmail)||null,multiFactorInfo:f},operation:d}})).apply(this,arguments)}function ps(){return(ps=(0,v.Z)(function*(a,i){const{data:s}=yield ra((0,w.m9)(a),i);return s.email})).apply(this,arguments)}function _s(){return _s=(0,v.Z)(function*(a,i,s){var l;const d=K(a),f={returnSecureToken:!0,email:i,password:s,clientType:"CLIENT_TYPE_WEB"};let m;if(null!==(l=d._getRecaptchaConfig())&&void 0!==l&&l.emailPasswordEnabled){const R=yield it(d,f,"signUpPassword");m=Nt(d,R)}else m=Nt(d,f).catch(function(){var R=(0,v.Z)(function*(k){if("auth/missing-recaptcha-token"===k.code){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const S=yield it(d,f,"signUpPassword");return Nt(d,S)}return Promise.reject(k)});return function(k){return R.apply(this,arguments)}}());const y=yield m.catch(R=>Promise.reject(R)),C=yield pe._fromIdTokenResponse(d,"signIn",y);return yield d._updateCurrentUser(C.user),C}),_s.apply(this,arguments)}function Qt(){return Qt=(0,v.Z)(function*(a,i,s){var l;const d=K(a),f={requestType:"EMAIL_SIGNIN",email:i,clientType:"CLIENT_TYPE_WEB"};function m(y,C){A(C.handleCodeInApp,d,"argument-error"),C&&$(d,y,C)}if(null!==(l=d._getRecaptchaConfig())&&void 0!==l&&l.emailPasswordEnabled){const y=yield it(d,f,"getOobCode",!0);m(y,s),yield zo(d,y)}else m(f,s),yield zo(d,f).catch(function(){var y=(0,v.Z)(function*(C){if("auth/missing-recaptcha-token"!==C.code)return Promise.reject(C);{console.log("Email link sign-in is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const R=yield it(d,f,"getOobCode",!0);m(R,s),yield zo(d,R)}});return function(C){return y.apply(this,arguments)}}())}),Qt.apply(this,arguments)}function Bi(){return(Bi=(0,v.Z)(function*(a,i,s){const l=(0,w.m9)(a),d=Di.credentialWithLink(i,s||di());return A(d._tenantId===(l.tenantId||null),l,"tenant-id-mismatch"),qt(l,d)})).apply(this,arguments)}function Gi(){return(Gi=(0,v.Z)(function*(a,i){return Z(a,"POST","/v1/accounts:createAuthUri",q(a,i))})).apply(this,arguments)}function zi(){return zi=(0,v.Z)(function*(a,i){const l={identifier:i,continueUri:Fr()?di():"http://localhost"},{signinMethods:d}=yield function aa(a,i){return Gi.apply(this,arguments)}((0,w.m9)(a),l);return d||[]}),zi.apply(this,arguments)}function Zi(){return Zi=(0,v.Z)(function*(a,i){const s=(0,w.m9)(a),d={requestType:"VERIFY_EMAIL",idToken:yield a.getIdToken()};i&&$(s.auth,d,i);const{email:f}=yield function xl(a,i){return ki.apply(this,arguments)}(s.auth,d);f!==a.email&&(yield a.reload())}),Zi.apply(this,arguments)}function Mn(){return Mn=(0,v.Z)(function*(a,i,s){const l=(0,w.m9)(a),f={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield a.getIdToken(),newEmail:i};s&&$(l.auth,f,s);const{email:m}=yield function pc(a,i){return Xr.apply(this,arguments)}(l.auth,f);m!==a.email&&(yield a.reload())}),Mn.apply(this,arguments)}function Ki(){return(Ki=(0,v.Z)(function*(a,i){return Z(a,"POST","/v1/accounts:update",i)})).apply(this,arguments)}function Fn(){return Fn=(0,v.Z)(function*(a,{displayName:i,photoURL:s}){if(void 0===i&&void 0===s)return;const l=(0,w.m9)(a),f={idToken:yield l.getIdToken(),displayName:i,photoUrl:s,returnSecureToken:!0},m=yield we(l,function Hl(a,i){return Ki.apply(this,arguments)}(l.auth,f));l.displayName=m.displayName||null,l.photoURL=m.photoUrl||null;const y=l.providerData.find(({providerId:C})=>"password"===C);y&&(y.displayName=l.displayName,y.photoURL=l.photoURL),yield l._updateTokensIfNecessary(m)}),Fn.apply(this,arguments)}function ca(a,i,s){return ys.apply(this,arguments)}function ys(){return(ys=(0,v.Z)(function*(a,i,s){const{auth:l}=a,f={idToken:yield a.getIdToken(),returnSecureToken:!0};i&&(f.email=i),s&&(f.password=s);const m=yield we(a,Vo(l,f));yield a._updateTokensIfNecessary(m,!0)})).apply(this,arguments)}class Jt{constructor(i,s,l={}){this.isNewUser=i,this.providerId=s,this.profile=l}}class ha extends Jt{constructor(i,s,l,d){super(i,s,l),this.username=d}}class Gl extends Jt{constructor(i,s){super(i,"facebook.com",s)}}class fa extends ha{constructor(i,s){super(i,"github.com",s,"string"==typeof s?.login?s?.login:null)}}class pa extends Jt{constructor(i,s){super(i,"google.com",s)}}class _a extends ha{constructor(i,s,l){super(i,"twitter.com",s,l)}}function zl(a){const{user:i,_tokenResponse:s}=a;return i.isAnonymous&&!s?{providerId:null,isNewUser:!1,profile:null}:function da(a){var i,s;if(!a)return null;const{providerId:l}=a,d=a.rawUserInfo?JSON.parse(a.rawUserInfo):{},f=a.isNewUser||"identitytoolkit#SignupNewUserResponse"===a.kind;if(!l&&a?.idToken){const m=null===(s=null===(i=Ct(a.idToken))||void 0===i?void 0:i.firebase)||void 0===s?void 0:s.sign_in_provider;if(m)return new Jt(f,"anonymous"!==m&&"custom"!==m?m:null)}if(!l)return null;switch(l){case"facebook.com":return new Gl(f,d);case"github.com":return new fa(f,d);case"google.com":return new pa(f,d);case"twitter.com":return new _a(f,d,a.screenName||null);case"custom":case"anonymous":return new Jt(f,null);default:return new Jt(f,l,d)}}(s)}class je{constructor(i,s,l){this.type=i,this.credential=s,this.auth=l}static _fromIdtoken(i,s){return new je("enroll",i,s)}static _fromMfaPendingCredential(i){return new je("signin",i)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(i){var s,l;if(i?.multiFactorSession){if(null!==(s=i.multiFactorSession)&&void 0!==s&&s.pendingCredential)return je._fromMfaPendingCredential(i.multiFactorSession.pendingCredential);if(null!==(l=i.multiFactorSession)&&void 0!==l&&l.idToken)return je._fromIdtoken(i.multiFactorSession.idToken)}return null}}class Is{constructor(i,s,l){this.session=i,this.hints=s,this.signInResolver=l}static _fromError(i,s){const l=K(i),d=s.customData._serverResponse,f=(d.mfaInfo||[]).map(y=>$e._fromServerResponse(l,y));A(d.mfaPendingCredential,l,"internal-error");const m=je._fromMfaPendingCredential(d.mfaPendingCredential);return new Is(m,f,function(){var y=(0,v.Z)(function*(C){const R=yield C._process(l,m);delete d.mfaInfo,delete d.mfaPendingCredential;const k=Object.assign(Object.assign({},d),{idToken:R.idToken,refreshToken:R.refreshToken});switch(s.operationType){case"signIn":const S=yield pe._fromIdTokenResponse(l,s.operationType,k);return yield l._updateCurrentUser(S.user),S;case"reauthenticate":return A(s.user,l,"internal-error"),pe._forOperation(s.user,s.operationType,k);default:ne(l,"internal-error")}});return function(C){return y.apply(this,arguments)}}())}resolveSignIn(i){var s=this;return(0,v.Z)(function*(){return s.signInResolver(i)})()}}class Es{constructor(i){this.user=i,this.enrolledFactors=[],i._onReload(s=>{s.mfaInfo&&(this.enrolledFactors=s.mfaInfo.map(l=>$e._fromServerResponse(i.auth,l)))})}static _fromUser(i){return new Es(i)}getSession(){var i=this;return(0,v.Z)(function*(){return je._fromIdtoken(yield i.user.getIdToken(),i.user.auth)})()}enroll(i,s){var l=this;return(0,v.Z)(function*(){const d=i,f=yield l.getSession(),m=yield we(l.user,d._process(l.user.auth,f,s));return yield l.user._updateTokensIfNecessary(m),l.user.reload()})()}unenroll(i){var s=this;return(0,v.Z)(function*(){const l="string"==typeof i?i:i.uid,d=yield s.user.getIdToken();try{const f=yield we(s.user,function Jl(a,i){return Z(a,"POST","/v2/accounts/mfaEnrollment:withdraw",q(a,i))}(s.user.auth,{idToken:d,mfaEnrollmentId:l}));s.enrolledFactors=s.enrolledFactors.filter(({uid:m})=>m!==l),yield s.user._updateTokensIfNecessary(f),yield s.user.reload()}catch(f){throw f}})()}}const Ts=new WeakMap,Un="__sak";class ga{constructor(i,s){this.storageRetriever=i,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(Un,"1"),this.storage.removeItem(Un),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(i,s){return this.storage.setItem(i,JSON.stringify(s)),Promise.resolve()}_get(i){const s=this.storage.getItem(i);return Promise.resolve(s?JSON.parse(s):null)}_remove(i){return this.storage.removeItem(i),Promise.resolve()}get storage(){return this.storageRetriever()}}const Wn=(()=>{class a extends ga{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(s,l)=>this.onStorageEvent(s,l),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function ma(){const a=(0,w.z$)();return An(a)||nt(a)}()&&function Gr(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=Rn(),this._shouldAllowMigration=!0}forAllChangedKeys(s){for(const l of Object.keys(this.listeners)){const d=this.storage.getItem(l),f=this.localCache[l];d!==f&&s(l,f,d)}}onStorageEvent(s,l=!1){if(!s.key)return void this.forAllChangedKeys((y,C,R)=>{this.notifyListeners(y,R)});const d=s.key;if(l?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const y=this.storage.getItem(d);if(s.newValue!==y)null!==s.newValue?this.storage.setItem(d,s.newValue):this.storage.removeItem(d);else if(this.localCache[d]===s.newValue&&!l)return}const f=()=>{const y=this.storage.getItem(d);!l&&this.localCache[d]===y||this.notifyListeners(d,y)},m=this.storage.getItem(d);!function kl(){return(0,w.w1)()&&10===document.documentMode}()||m===s.newValue||s.newValue===s.oldValue?f():setTimeout(f,10)}notifyListeners(s,l){this.localCache[s]=l;const d=this.listeners[s];if(d)for(const f of Array.from(d))f(l&&JSON.parse(l))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((s,l,d)=>{this.onStorageEvent(new StorageEvent("storage",{key:s,oldValue:l,newValue:d}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(s,l){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[s]||(this.listeners[s]=new Set,this.localCache[s]=this.storage.getItem(s)),this.listeners[s].add(l)}_removeListener(s,l){this.listeners[s]&&(this.listeners[s].delete(l),0===this.listeners[s].size&&delete this.listeners[s]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(s,l){var d=()=>super._set,f=this;return(0,v.Z)(function*(){yield d().call(f,s,l),f.localCache[s]=JSON.stringify(l)})()}_get(s){var l=()=>super._get,d=this;return(0,v.Z)(function*(){const f=yield l().call(d,s);return d.localCache[s]=JSON.stringify(f),f})()}_remove(s){var l=()=>super._remove,d=this;return(0,v.Z)(function*(){yield l().call(d,s),delete d.localCache[s]})()}}return a.type="LOCAL",a})(),ct=(()=>{class a extends ga{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(s,l){}_removeListener(s,l){}}return a.type="SESSION",a})();let Ia=(()=>{class a{constructor(s){this.eventTarget=s,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(s){const l=this.receivers.find(f=>f.isListeningto(s));if(l)return l;const d=new a(s);return this.receivers.push(d),d}isListeningto(s){return this.eventTarget===s}handleEvent(s){var l=this;return(0,v.Z)(function*(){const d=s,{eventId:f,eventType:m,data:y}=d.data,C=l.handlersMap[m];if(!C?.size)return;d.ports[0].postMessage({status:"ack",eventId:f,eventType:m});const R=Array.from(C).map(function(){var S=(0,v.Z)(function*(z){return z(d.origin,y)});return function(z){return S.apply(this,arguments)}}()),k=yield function ya(a){return Promise.all(a.map(function(){var i=(0,v.Z)(function*(s){try{return{fulfilled:!0,value:yield s}}catch(l){return{fulfilled:!1,reason:l}}});return function(s){return i.apply(this,arguments)}}()))}(R);d.ports[0].postMessage({status:"done",eventId:f,eventType:m,response:k})})()}_subscribe(s,l){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[s]||(this.handlersMap[s]=new Set),this.handlersMap[s].add(l)}_unsubscribe(s,l){this.handlersMap[s]&&l&&this.handlersMap[s].delete(l),(!l||0===this.handlersMap[s].size)&&delete this.handlersMap[s],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return a.receivers=[],a})();function en(a="",i=10){let s="";for(let l=0;l<i;l++)s+=Math.floor(10*Math.random());return a+s}class ji{constructor(i){this.target=i,this.handlers=new Set}removeMessageHandler(i){i.messageChannel&&(i.messageChannel.port1.removeEventListener("message",i.onMessage),i.messageChannel.port1.close()),this.handlers.delete(i)}_send(i,s,l=50){var d=this;return(0,v.Z)(function*(){const f=typeof MessageChannel<"u"?new MessageChannel:null;if(!f)throw new Error("connection_unavailable");let m,y;return new Promise((C,R)=>{const k=en("",20);f.port1.start();const S=setTimeout(()=>{R(new Error("unsupported_event"))},l);y={messageChannel:f,onMessage(z){const Ie=z;if(Ie.data.eventId===k)switch(Ie.data.status){case"ack":clearTimeout(S),m=setTimeout(()=>{R(new Error("timeout"))},3e3);break;case"done":clearTimeout(m),C(Ie.data.response);break;default:clearTimeout(S),clearTimeout(m),R(new Error("invalid_response"))}}},d.handlers.add(y),f.port1.addEventListener("message",y.onMessage),d.target.postMessage({eventType:i,eventId:k,data:s},[f.port2])}).finally(()=>{y&&d.removeMessageHandler(y)})})()}}function J(){return window}function U(){return typeof J().WorkerGlobalScope<"u"&&"function"==typeof J().importScripts}function L(){return(L=(0,v.Z)(function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const qi="firebaseLocalStorageDb",ht="firebaseLocalStorage",ws="fbase_key";class V{constructor(i){this.request=i}toPromise(){return new Promise((i,s)=>{this.request.addEventListener("success",()=>{i(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function x(a,i){return a.transaction([ht],i?"readwrite":"readonly").objectStore(ht)}function As(){const a=indexedDB.open(qi,1);return new Promise((i,s)=>{a.addEventListener("error",()=>{s(a.error)}),a.addEventListener("upgradeneeded",()=>{const l=a.result;try{l.createObjectStore(ht,{keyPath:ws})}catch(d){s(d)}}),a.addEventListener("success",(0,v.Z)(function*(){const l=a.result;l.objectStoreNames.contains(ht)?i(l):(l.close(),yield function oe(){const a=indexedDB.deleteDatabase(qi);return new V(a).toPromise()}(),i(yield As()))}))})}function Yi(a,i,s){return ce.apply(this,arguments)}function ce(){return(ce=(0,v.Z)(function*(a,i,s){const l=x(a,!0).put({[ws]:i,value:s});return new V(l).toPromise()})).apply(this,arguments)}function Rs(){return(Rs=(0,v.Z)(function*(a,i){const s=x(a,!1).get(i),l=yield new V(s).toPromise();return void 0===l?null:l.value})).apply(this,arguments)}function Ta(a,i){const s=x(a,!0).delete(i);return new V(s).toPromise()}const xe=(()=>{class a{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var s=this;return(0,v.Z)(function*(){return s.db||(s.db=yield As()),s.db})()}_withRetries(s){var l=this;return(0,v.Z)(function*(){let d=0;for(;;)try{const f=yield l._openDb();return yield s(f)}catch(f){if(d++>3)throw f;l.db&&(l.db.close(),l.db=void 0)}})()}initializeServiceWorkerMessaging(){var s=this;return(0,v.Z)(function*(){return U()?s.initializeReceiver():s.initializeSender()})()}initializeReceiver(){var s=this;return(0,v.Z)(function*(){s.receiver=Ia._getInstance(function B(){return U()?self:null}()),s.receiver._subscribe("keyChanged",function(){var l=(0,v.Z)(function*(d,f){return{keyProcessed:(yield s._poll()).includes(f.key)}});return function(d,f){return l.apply(this,arguments)}}()),s.receiver._subscribe("ping",function(){var l=(0,v.Z)(function*(d,f){return["keyChanged"]});return function(d,f){return l.apply(this,arguments)}}())})()}initializeSender(){var s=this;return(0,v.Z)(function*(){var l,d;if(s.activeServiceWorker=yield function W(){return L.apply(this,arguments)}(),!s.activeServiceWorker)return;s.sender=new ji(s.activeServiceWorker);const f=yield s.sender._send("ping",{},800);f&&null!==(l=f[0])&&void 0!==l&&l.fulfilled&&null!==(d=f[0])&&void 0!==d&&d.value.includes("keyChanged")&&(s.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(s){var l=this;return(0,v.Z)(function*(){if(l.sender&&l.activeServiceWorker&&function dt(){var a;return(null===(a=navigator?.serviceWorker)||void 0===a?void 0:a.controller)||null}()===l.activeServiceWorker)try{yield l.sender._send("keyChanged",{key:s},l.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,v.Z)(function*(){try{if(!indexedDB)return!1;const s=yield As();return yield Yi(s,Un,"1"),yield Ta(s,Un),!0}catch{}return!1})()}_withPendingWrite(s){var l=this;return(0,v.Z)(function*(){l.pendingWrites++;try{yield s()}finally{l.pendingWrites--}})()}_set(s,l){var d=this;return(0,v.Z)(function*(){return d._withPendingWrite((0,v.Z)(function*(){return yield d._withRetries(f=>Yi(f,s,l)),d.localCache[s]=l,d.notifyServiceWorker(s)}))})()}_get(s){var l=this;return(0,v.Z)(function*(){const d=yield l._withRetries(f=>function iu(a,i){return Rs.apply(this,arguments)}(f,s));return l.localCache[s]=d,d})()}_remove(s){var l=this;return(0,v.Z)(function*(){return l._withPendingWrite((0,v.Z)(function*(){return yield l._withRetries(d=>Ta(d,s)),delete l.localCache[s],l.notifyServiceWorker(s)}))})()}_poll(){var s=this;return(0,v.Z)(function*(){const l=yield s._withRetries(m=>{const y=x(m,!1).getAll();return new V(y).toPromise()});if(!l)return[];if(0!==s.pendingWrites)return[];const d=[],f=new Set;for(const{fbase_key:m,value:y}of l)f.add(m),JSON.stringify(s.localCache[m])!==JSON.stringify(y)&&(s.notifyListeners(m,y),d.push(m));for(const m of Object.keys(s.localCache))s.localCache[m]&&!f.has(m)&&(s.notifyListeners(m,null),d.push(m));return d})()}notifyListeners(s,l){this.localCache[s]=l;const d=this.listeners[s];if(d)for(const f of Array.from(d))f(l)}startPolling(){var s=this;this.stopPolling(),this.pollTimer=setInterval((0,v.Z)(function*(){return s._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(s,l){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[s]||(this.listeners[s]=new Set,this._get(s)),this.listeners[s].add(l)}_removeListener(s,l){this.listeners[s]&&(this.listeners[s].delete(l),0===this.listeners[s].size&&delete this.listeners[s]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return a.type="LOCAL",a})(),Vn=1e12;class Lt{constructor(i){this.auth=i,this.counter=Vn,this._widgets=new Map}render(i,s){const l=this.counter;return this._widgets.set(l,new M(i,this.auth.name,s||{})),this.counter++,l}reset(i){var s;const l=i||Vn;null===(s=this._widgets.get(l))||void 0===s||s.delete(),this._widgets.delete(l)}getResponse(i){var s;return(null===(s=this._widgets.get(i||Vn))||void 0===s?void 0:s.getResponse())||""}execute(i){var s=this;return(0,v.Z)(function*(){var l;return null===(l=s._widgets.get(i||Vn))||void 0===l||l.execute(),""})()}}class M{constructor(i,s,l){this.params=l,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const d="string"==typeof i?document.getElementById(i):i;A(d,"argument-error",{appName:s}),this.container=d,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function Qi(a){const i=[],s="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let l=0;l<a;l++)i.push(s.charAt(Math.floor(62*Math.random())));return i.join("")}(50);const{callback:i,"expired-callback":s}=this.params;if(i)try{i(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,s)try{s()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const tn=Do("rcb"),Ra=new hi(3e4,6e4);class Ji{constructor(){var i;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(i=J().grecaptcha)||void 0===i||!i.render)}load(i,s=""){return A(function Re(a){return a.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(a)}(s),i,"argument-error"),this.shouldResolveImmediately(s)&&No(J().grecaptcha)?Promise.resolve(J().grecaptcha):new Promise((l,d)=>{const f=J().setTimeout(()=>{d(ie(i,"network-request-failed"))},Ra.get());J()[tn]=()=>{J().clearTimeout(f),delete J()[tn];const y=J().grecaptcha;if(!y||!No(y))return void d(ie(i,"internal-error"));const C=y.render;y.render=(R,k)=>{const S=C(R,k);return this.counter++,S},this.hostLanguage=s,l(y)},$r(`https://www.google.com/recaptcha/api.js??${(0,w.xO)({onload:tn,render:"explicit",hl:s})}`).catch(()=>{clearTimeout(f),d(ie(i,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(i){var s;return!(null===(s=J().grecaptcha)||void 0===s||!s.render)&&(i===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class lu{load(i){return(0,v.Z)(function*(){return new Lt(i)})()}clearedOneInstance(){}}const ae="recaptcha",uu={theme:"light",type:"image"};class Ss{constructor(i,s=Object.assign({},uu),l){this.parameters=s,this.type=ae,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=K(l),this.isInvisible="invisible"===this.parameters.size,A(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const d="string"==typeof i?document.getElementById(i):i;A(d,this.auth,"argument-error"),this.container=d,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new lu:new Ji,this.validateStartingState()}verify(){var i=this;return(0,v.Z)(function*(){i.assertNotDestroyed();const s=yield i.render(),l=i.getAssertedRecaptcha();return l.getResponse(s)||new Promise(f=>{const m=y=>{y&&(i.tokenChangeListeners.delete(m),f(y))};i.tokenChangeListeners.add(m),i.isInvisible&&l.execute(s)})})()}render(){try{this.assertNotDestroyed()}catch(i){return Promise.reject(i)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(i=>{throw this.renderPromise=null,i})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(i=>{this.container.removeChild(i)})}validateStartingState(){A(!this.parameters.sitekey,this.auth,"argument-error"),A(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),A(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(i){return s=>{if(this.tokenChangeListeners.forEach(l=>l(s)),"function"==typeof i)i(s);else if("string"==typeof i){const l=J()[i];"function"==typeof l&&l(s)}}}assertNotDestroyed(){A(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var i=this;return(0,v.Z)(function*(){if(yield i.init(),!i.widgetId){let s=i.container;if(!i.isInvisible){const l=document.createElement("div");s.appendChild(l),s=l}i.widgetId=i.getAssertedRecaptcha().render(s,i.parameters)}return i.widgetId})()}init(){var i=this;return(0,v.Z)(function*(){A(Fr()&&!U(),i.auth,"internal-error"),yield function ks(){let a=null;return new Promise(i=>{"complete"!==document.readyState?(a=()=>i(),window.addEventListener("load",a)):i()}).catch(i=>{throw a&&window.removeEventListener("load",a),i})}(),i.recaptcha=yield i._recaptchaLoader.load(i.auth,i.auth.languageCode||void 0);const s=yield function Zr(a){return Sn.apply(this,arguments)}(i.auth);A(s,i.auth,"internal-error"),i.parameters.sitekey=s})()}getAssertedRecaptcha(){return A(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class bs{constructor(i,s){this.verificationId=i,this.onConfirmation=s}confirm(i){const s=rt._fromVerification(this.verificationId,i);return this.onConfirmation(s)}}function Xi(){return(Xi=(0,v.Z)(function*(a,i,s){const l=K(a),d=yield tr(l,i,(0,w.m9)(s));return new bs(d,f=>qt(l,f))})).apply(this,arguments)}function ft(){return(ft=(0,v.Z)(function*(a,i,s){const l=(0,w.m9)(a);yield lt(!1,l,"phone");const d=yield tr(l.auth,i,(0,w.m9)(s));return new bs(d,f=>se(l,f))})).apply(this,arguments)}function er(){return(er=(0,v.Z)(function*(a,i,s){const l=(0,w.m9)(a),d=yield tr(l.auth,i,(0,w.m9)(s));return new bs(d,f=>On(l,f))})).apply(this,arguments)}function tr(a,i,s){return Ps.apply(this,arguments)}function Ps(){return Ps=(0,v.Z)(function*(a,i,s){var l;const d=yield s.verify();try{let f;if(A("string"==typeof d,a,"argument-error"),A(s.type===ae,a,"argument-error"),f="string"==typeof i?{phoneNumber:i}:i,"session"in f){const m=f.session;if("phoneNumber"in f)return A("enroll"===m.type,a,"internal-error"),(yield function $i(a,i){return Z(a,"POST","/v2/accounts/mfaEnrollment:start",q(a,i))}(a,{idToken:m.credential,phoneEnrollmentInfo:{phoneNumber:f.phoneNumber,recaptchaToken:d}})).phoneSessionInfo.sessionInfo;{A("signin"===m.type,a,"internal-error");const y=(null===(l=f.multiFactorHint)||void 0===l?void 0:l.uid)||f.multiFactorUid;return A(y,a,"missing-multi-factor-info"),(yield function ru(a,i){return Z(a,"POST","/v2/accounts/mfaSignIn:start",q(a,i))}(a,{mfaPendingCredential:m.credential,mfaEnrollmentId:y,phoneSignInInfo:{recaptchaToken:d}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:m}=yield function mc(a,i){return $o.apply(this,arguments)}(a,{phoneNumber:f.phoneNumber,recaptchaToken:d});return m}}finally{s._reset()}}),Ps.apply(this,arguments)}function H(){return(H=(0,v.Z)(function*(a,i){yield Fi((0,w.m9)(a),i)})).apply(this,arguments)}let Hn=(()=>{class a{constructor(s){this.providerId=a.PROVIDER_ID,this.auth=K(s)}verifyPhoneNumber(s,l){return tr(this.auth,s,(0,w.m9)(l))}static credential(s,l){return rt._fromVerification(s,l)}static credentialFromResult(s){return a.credentialFromTaggedObject(s)}static credentialFromError(s){return a.credentialFromTaggedObject(s.customData||{})}static credentialFromTaggedObject({_tokenResponse:s}){if(!s)return null;const{phoneNumber:l,temporaryProof:d}=s;return l&&d?rt._fromTokenResponse(l,d):null}}return a.PROVIDER_ID="phone",a.PHONE_SIGN_IN_METHOD="phone",a})();function Mt(a,i){return i?ue(i):(A(a._popupRedirectResolver,a,"argument-error"),a._popupRedirectResolver)}class nn extends bt{constructor(i){super("custom","custom"),this.params=i}_getIdTokenResponse(i){return Ge(i,this._buildIdpRequest())}_linkToIdToken(i,s){return Ge(i,this._buildIdpRequest(s))}_getReauthenticationResolver(i){return Ge(i,this._buildIdpRequest())}_buildIdpRequest(i){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return i&&(s.idToken=i),s}}function Ns(a){return ee(a.auth,new nn(a),a.bypassAuthState)}function rn(a){const{auth:i,user:s}=a;return A(s,i,"internal-error"),as(s,new nn(a),a.bypassAuthState)}function qe(a){return Ft.apply(this,arguments)}function Ft(){return(Ft=(0,v.Z)(function*(a){const{auth:i,user:s}=a;return A(s,i,"internal-error"),Fi(s,new nn(a),a.bypassAuthState)})).apply(this,arguments)}class D{constructor(i,s,l,d,f=!1){this.auth=i,this.resolver=l,this.user=d,this.bypassAuthState=f,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){var i=this;return new Promise(function(){var s=(0,v.Z)(function*(l,d){i.pendingPromise={resolve:l,reject:d};try{i.eventManager=yield i.resolver._initialize(i.auth),yield i.onExecution(),i.eventManager.registerConsumer(i)}catch(f){i.reject(f)}});return function(l,d){return s.apply(this,arguments)}}())}onAuthEvent(i){var s=this;return(0,v.Z)(function*(){const{urlResponse:l,sessionId:d,postBody:f,tenantId:m,error:y,type:C}=i;if(y)return void s.reject(y);const R={auth:s.auth,requestUri:l,sessionId:d,tenantId:m||void 0,postBody:f||void 0,user:s.user,bypassAuthState:s.bypassAuthState};try{s.resolve(yield s.getIdpTask(C)(R))}catch(k){s.reject(k)}})()}onError(i){this.reject(i)}getIdpTask(i){switch(i){case"signInViaPopup":case"signInViaRedirect":return Ns;case"linkViaPopup":case"linkViaRedirect":return qe;case"reauthViaPopup":case"reauthViaRedirect":return rn;default:ne(this.auth,"internal-error")}}resolve(i){Oe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(i),this.unregisterAndCleanUp()}reject(i){Oe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(i),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const du=new hi(2e3,1e4);function Os(){return(Os=(0,v.Z)(function*(a,i,s){const l=K(a);zt(a,i,Ze);const d=Mt(l,s);return new nr(l,"signInViaPopup",i,d).executeNotNull()})).apply(this,arguments)}function Gn(){return(Gn=(0,v.Z)(function*(a,i,s){const l=(0,w.m9)(a);zt(l.auth,i,Ze);const d=Mt(l.auth,s);return new nr(l.auth,"reauthViaPopup",i,d,l).executeNotNull()})).apply(this,arguments)}function zn(){return(zn=(0,v.Z)(function*(a,i,s){const l=(0,w.m9)(a);zt(l.auth,i,Ze);const d=Mt(l.auth,s);return new nr(l.auth,"linkViaPopup",i,d,l).executeNotNull()})).apply(this,arguments)}let nr=(()=>{class a extends D{constructor(s,l,d,f,m){super(s,l,f,m),this.provider=d,this.authWindow=null,this.pollId=null,a.currentPopupAction&&a.currentPopupAction.cancel(),a.currentPopupAction=this}executeNotNull(){var s=this;return(0,v.Z)(function*(){const l=yield s.execute();return A(l,s.auth,"internal-error"),l})()}onExecution(){var s=this;return(0,v.Z)(function*(){Oe(1===s.filter.length,"Popup operations only handle one event");const l=en();s.authWindow=yield s.resolver._openPopup(s.auth,s.provider,s.filter[0],l),s.authWindow.associatedEvent=l,s.resolver._originValidation(s.auth).catch(d=>{s.reject(d)}),s.resolver._isIframeWebStorageSupported(s.auth,d=>{d||s.reject(ie(s.auth,"web-storage-unsupported"))}),s.pollUserCancellation()})()}get eventId(){var s;return(null===(s=this.authWindow)||void 0===s?void 0:s.associatedEvent)||null}cancel(){this.reject(ie(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,a.currentPopupAction=null}pollUserCancellation(){const s=()=>{var l,d;this.pollId=null!==(d=null===(l=this.authWindow)||void 0===l?void 0:l.window)&&void 0!==d&&d.closed?window.setTimeout(()=>{this.pollId=null,this.reject(ie(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(s,du.get())};s()}}return a.currentPopupAction=null,a})();const sn="pendingRedirect",Ye=new Map;class Zn extends D{constructor(i,s,l=!1){super(i,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,l),this.eventId=null}execute(){var i=()=>super.execute,s=this;return(0,v.Z)(function*(){let l=Ye.get(s.auth._key());if(!l){try{const f=(yield function fu(a,i){return Kn.apply(this,arguments)}(s.resolver,s.auth))?yield i().call(s):null;l=()=>Promise.resolve(f)}catch(d){l=()=>Promise.reject(d)}Ye.set(s.auth._key(),l)}return s.bypassAuthState||Ye.set(s.auth._key(),()=>Promise.resolve(null)),l()})()}onAuthEvent(i){var s=()=>super.onAuthEvent,l=this;return(0,v.Z)(function*(){if("signInViaRedirect"===i.type)return s().call(l,i);if("unknown"!==i.type){if(i.eventId){const d=yield l.auth._redirectUserForId(i.eventId);if(d)return l.user=d,s().call(l,i);l.resolve(null)}}else l.resolve(null)})()}onExecution(){return(0,v.Z)(function*(){})()}cleanUp(){}}function Kn(){return(Kn=(0,v.Z)(function*(a,i){const s=Na(i),l=Pa(a);if(!(yield l._isAvailable()))return!1;const d="true"===(yield l._get(s));return yield l._remove(s),d})).apply(this,arguments)}function Ut(a,i){return Ds.apply(this,arguments)}function Ds(){return(Ds=(0,v.Z)(function*(a,i){return Pa(a)._set(Na(i),"true")})).apply(this,arguments)}function xs(a,i){Ye.set(a._key(),i)}function Pa(a){return ue(a._redirectPersistence)}function Na(a){return Be(sn,a.config.apiKey,a.name)}function Ls(a,i,s){return function pu(a,i,s){return $n.apply(this,arguments)}(a,i,s)}function $n(){return($n=(0,v.Z)(function*(a,i,s){const l=K(a);zt(a,i,Ze),yield l._initializationPromise;const d=Mt(l,s);return yield Ut(d,l),d._openRedirect(l,i,"signInViaRedirect")})).apply(this,arguments)}function _u(a,i,s){return function rr(a,i,s){return sr.apply(this,arguments)}(a,i,s)}function sr(){return(sr=(0,v.Z)(function*(a,i,s){const l=(0,w.m9)(a);zt(l.auth,i,Ze),yield l.auth._initializationPromise;const d=Mt(l.auth,s);yield Ut(d,l.auth);const f=yield Da(l);return d._openRedirect(l.auth,i,"reauthViaRedirect",f)})).apply(this,arguments)}function Oa(a,i,s){return function or(a,i,s){return Ms.apply(this,arguments)}(a,i,s)}function Ms(){return(Ms=(0,v.Z)(function*(a,i,s){const l=(0,w.m9)(a);zt(l.auth,i,Ze),yield l.auth._initializationPromise;const d=Mt(l.auth,s);yield lt(!1,l,i.providerId),yield Ut(d,l.auth);const f=yield Da(l);return d._openRedirect(l.auth,i,"linkViaRedirect",f)})).apply(this,arguments)}function pt(){return(pt=(0,v.Z)(function*(a,i){return yield K(a)._initializationPromise,on(a,i,!1)})).apply(this,arguments)}function on(a,i){return jn.apply(this,arguments)}function jn(){return(jn=(0,v.Z)(function*(a,i,s=!1){const l=K(a),d=Mt(l,i),m=yield new Zn(l,d,s).execute();return m&&!s&&(delete m.user._redirectEventId,yield l._persistUserIfCurrent(m.user),yield l._setRedirectUser(null,i)),m})).apply(this,arguments)}function Da(a){return Fs.apply(this,arguments)}function Fs(){return(Fs=(0,v.Z)(function*(a){const i=en(`${a.uid}:::`);return a._redirectEventId=i,yield a.auth._setRedirectUser(a),yield a.auth._persistUserIfCurrent(a),i})).apply(this,arguments)}class La{constructor(i){this.auth=i,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(i){this.consumers.add(i),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,i)&&(this.sendToConsumer(this.queuedRedirectEvent,i),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(i){this.consumers.delete(i)}onEvent(i){if(this.hasEventBeenHandled(i))return!1;let s=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(i,l)&&(s=!0,this.sendToConsumer(i,l),this.saveEventToCache(i))}),this.hasHandledPotentialRedirect||!function Me(a){switch(a.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Fa(a);default:return!1}}(i)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=i,s=!0)),s}sendToConsumer(i,s){var l;if(i.error&&!Fa(i)){const d=(null===(l=i.error.code)||void 0===l?void 0:l.split("auth/")[1])||"internal-error";s.onError(ie(this.auth,d))}else s.onAuthEvent(i)}isEventForConsumer(i,s){const l=null===s.eventId||!!i.eventId&&i.eventId===s.eventId;return s.filter.includes(i.type)&&l}hasEventBeenHandled(i){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ma(i))}saveEventToCache(i){this.cachedEventUids.add(Ma(i)),this.lastProcessedEventTime=Date.now()}}function Ma(a){return[a.type,a.eventId,a.sessionId,a.tenantId].filter(i=>i).join("-")}function Fa({type:a,error:i}){return"unknown"===a&&"auth/no-auth-event"===i?.code}function lr(a){return qn.apply(this,arguments)}function qn(){return(qn=(0,v.Z)(function*(a,i={}){return Z(a,"GET","/v1/projects",i)})).apply(this,arguments)}const Us=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ur=/^https?/;function Qe(){return(Qe=(0,v.Z)(function*(a){if(a.config.emulator)return;const{authorizedDomains:i}=yield lr(a);for(const s of i)try{if(an(s))return}catch{}ne(a,"unauthorized-domain")})).apply(this,arguments)}function an(a){const i=di(),{protocol:s,hostname:l}=new URL(i);if(a.startsWith("chrome-extension://")){const m=new URL(a);return""===m.hostname&&""===l?"chrome-extension:"===s&&a.replace("chrome-extension://","")===i.replace("chrome-extension://",""):"chrome-extension:"===s&&m.hostname===l}if(!ur.test(s))return!1;if(Us.test(a))return l===a;const d=a.replace(/\./g,"\\.");return new RegExp("^(.+\\."+d+"|"+d+")$","i").test(l)}const _t=new hi(3e4,6e4);function Ua(){const a=J().___jsl;if(a?.H)for(const i of Object.keys(a.H))if(a.H[i].r=a.H[i].r||[],a.H[i].L=a.H[i].L||[],a.H[i].r=[...a.H[i].L],a.CP)for(let s=0;s<a.CP.length;s++)a.CP[s]=null}let gt=null;const vu=new hi(5e3,15e3),cr="__/auth/iframe",Qn="emulator/auth/iframe",Wa={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},dr=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Wt(a){const i=a.config;A(i.authDomain,a,"auth-domain-config-required");const s=i.emulator?Co(i,Qn):`https://${a.config.authDomain}/${cr}`,l={apiKey:i.apiKey,appName:a.name,v:de.SDK_VERSION},d=dr.get(a.config.apiHost);d&&(l.eid=d);const f=a._getFrameworks();return f.length&&(l.fw=f.join(",")),`${s}?${(0,w.xO)(l).slice(1)}`}function Vs(){return Vs=(0,v.Z)(function*(a){const i=yield function mu(a){return gt=gt||function gu(a){return new Promise((i,s)=>{var l,d,f;function m(){Ua(),gapi.load("gapi.iframes",{callback:()=>{i(gapi.iframes.getContext())},ontimeout:()=>{Ua(),s(ie(a,"network-request-failed"))},timeout:_t.get()})}if(null!==(d=null===(l=J().gapi)||void 0===l?void 0:l.iframes)&&void 0!==d&&d.Iframe)i(gapi.iframes.getContext());else{if(null===(f=J().gapi)||void 0===f||!f.load){const y=Do("iframefcb");return J()[y]=()=>{gapi.load?m():s(ie(a,"network-request-failed"))},$r(`https://apis.google.com/js/api.js?onload=${y}`).catch(C=>s(C))}m()}}).catch(i=>{throw gt=null,i})}(a),gt}(a),s=J().gapi;return A(s,a,"internal-error"),i.open({where:document.body,url:Wt(a),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Wa,dontclear:!0},l=>new Promise(function(){var d=(0,v.Z)(function*(f,m){yield l.restyle({setHideOnLeave:!1});const y=ie(a,"network-request-failed"),C=J().setTimeout(()=>{m(y)},vu.get());function R(){J().clearTimeout(C),f(l)}l.ping(R).then(R,()=>{m(y)})});return function(f,m){return d.apply(this,arguments)}}()))}),Vs.apply(this,arguments)}const G={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class hr{constructor(i){this.window=i,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const mt="__/auth/handler",Bs="emulator/auth/handler",ln=encodeURIComponent("fac");function fr(a,i,s,l,d,f){return un.apply(this,arguments)}function un(){return(un=(0,v.Z)(function*(a,i,s,l,d,f){A(a.config.authDomain,a,"auth-domain-config-required"),A(a.config.apiKey,a,"invalid-api-key");const m={apiKey:a.config.apiKey,appName:a.name,authType:s,redirectUrl:l,v:de.SDK_VERSION,eventId:d};if(i instanceof Ze){i.setDefaultLanguage(a.languageCode),m.providerId=i.providerId||"",(0,w.xb)(i.getCustomParameters())||(m.customParameters=JSON.stringify(i.getCustomParameters()));for(const[k,S]of Object.entries(f||{}))m[k]=S}if(i instanceof Pt){const k=i.getScopes().filter(S=>""!==S);k.length>0&&(m.scopes=k.join(","))}a.tenantId&&(m.tid=a.tenantId);const y=m;for(const k of Object.keys(y))void 0===y[k]&&delete y[k];const C=yield a._getAppCheckToken(),R=C?`#${ln}=${encodeURIComponent(C)}`:"";return`${function yu({config:a}){return a.emulator?Co(a,Bs):`https://${a.authDomain}/${mt}`}(a)}?${(0,w.xO)(y).slice(1)}${R}`})).apply(this,arguments)}const Gs="webStorageSupport",Ba=class Iu{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ct,this._completeRedirectFn=on,this._overrideRedirectResult=xs}_openPopup(i,s,l,d){var f=this;return(0,v.Z)(function*(){var m;Oe(null===(m=f.eventManagers[i._key()])||void 0===m?void 0:m.manager,"_initialize() not called before _openPopup()");const y=yield fr(i,s,l,di(),d);return function Vt(a,i,s,l=500,d=600){const f=Math.max((window.screen.availHeight-d)/2,0).toString(),m=Math.max((window.screen.availWidth-l)/2,0).toString();let y="";const C=Object.assign(Object.assign({},G),{width:l.toString(),height:d.toString(),top:f,left:m}),R=(0,w.z$)().toLowerCase();s&&(y=Ii(R)?"_blank":s),bo(R)&&(i=i||"http://localhost",C.scrollbars="yes");const k=Object.entries(C).reduce((z,[Ie,Sr])=>`${z}${Ie}=${Sr},`,"");if(function Sl(a=(0,w.z$)()){var i;return nt(a)&&!(null===(i=window.navigator)||void 0===i||!i.standalone)}(R)&&"_self"!==y)return function Ha(a,i){const s=document.createElement("a");s.href=a,s.target=i;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(l)}(i||"",y),new hr(null);const S=window.open(i||"",y,k);A(S,a,"popup-blocked");try{S.focus()}catch{}return new hr(S)}(i,y,en())})()}_openRedirect(i,s,l,d){var f=this;return(0,v.Z)(function*(){return yield f._originValidation(i),function Ea(a){J().location.href=a}(yield fr(i,s,l,di(),d)),new Promise(()=>{})})()}_initialize(i){const s=i._key();if(this.eventManagers[s]){const{manager:d,promise:f}=this.eventManagers[s];return d?Promise.resolve(d):(Oe(f,"If manager is not set, promise should be"),f)}const l=this.initAndGetManager(i);return this.eventManagers[s]={promise:l},l.catch(()=>{delete this.eventManagers[s]}),l}initAndGetManager(i){var s=this;return(0,v.Z)(function*(){const l=yield function Ws(a){return Vs.apply(this,arguments)}(i),d=new La(i);return l.register("authEvent",f=>(A(f?.authEvent,i,"invalid-auth-event"),{status:d.onEvent(f.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),s.eventManagers[i._key()]={manager:d},s.iframes[i._key()]=l,d})()}_isIframeWebStorageSupported(i,s){this.iframes[i._key()].send(Gs,{type:Gs},d=>{var f;const m=null===(f=d?.[0])||void 0===f?void 0:f[Gs];void 0!==m&&s(!!m),ne(i,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(i){const s=i._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=function Yn(a){return Qe.apply(this,arguments)}(i)),this.originValidationPromises[s]}get _shouldInitProactively(){return Rn()||An()||nt()}};class Eu{constructor(i){this.factorId=i}_process(i,s,l){switch(s.type){case"enroll":return this._finalizeEnroll(i,s.credential,l);case"signin":return this._finalizeSignIn(i,s.credential);default:return ve("unexpected MultiFactorSessionType")}}}class zs extends Eu{constructor(i){super("phone"),this.credential=i}static _fromCredential(i){return new zs(i)}_finalizeEnroll(i,s,l){return function Xt(a,i){return Z(a,"POST","/v2/accounts/mfaEnrollment:finalize",q(a,i))}(i,{idToken:s,displayName:l,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(i,s){return function Aa(a,i){return Z(a,"POST","/v2/accounts/mfaSignIn:finalize",q(a,i))}(i,{mfaPendingCredential:s,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let Tu=(()=>{class a{constructor(){}static assertion(s){return zs._fromCredential(s)}}return a.FACTOR_ID="phone",a})();var za="@firebase/auth";class wu{constructor(i){this.auth=i,this.internalListeners=new Map}getUid(){var i;return this.assertAuthConfigured(),(null===(i=this.auth.currentUser)||void 0===i?void 0:i.uid)||null}getToken(i){var s=this;return(0,v.Z)(function*(){return s.assertAuthConfigured(),yield s.auth._initializationPromise,s.auth.currentUser?{accessToken:yield s.auth.currentUser.getIdToken(i)}:null})()}addAuthTokenListener(i){if(this.assertAuthConfigured(),this.internalListeners.has(i))return;const s=this.auth.onIdTokenChanged(l=>{i(l?.stsTokenManager.accessToken||null)});this.internalListeners.set(i,s),this.updateProactiveRefresh()}removeAuthTokenListener(i){this.assertAuthConfigured();const s=this.internalListeners.get(i);s&&(this.internalListeners.delete(i),s(),this.updateProactiveRefresh())}assertAuthConfigured(){A(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function vt(){return window}(0,w.Pz)("authIdTokenMaxAge"),function gr(a){(0,de._registerComponent)(new mn.wA("auth",(i,{options:s})=>{const l=i.getProvider("app").getImmediate(),d=i.getProvider("heartbeat"),f=i.getProvider("app-check-internal"),{apiKey:m,authDomain:y}=l.options;A(m&&!m.includes(":"),"invalid-api-key",{appName:l.name});const C={apiKey:m,authDomain:y,clientPlatform:a,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:zr(a)},R=new Ai(l,d,f,C);return function Dl(a,i){const s=i?.persistence||[],l=(Array.isArray(s)?s:[s]).map(ue);i?.errorMap&&a._updateErrorMap(i.errorMap),a._initializeWithPersistence(l,i?.popupRedirectResolver)}(R,s),R},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((i,s,l)=>{i.getProvider("auth-internal").initialize()})),(0,de._registerComponent)(new mn.wA("auth-internal",i=>{const s=K(i.getProvider("auth").getImmediate());return new wu(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,de.registerVersion)(za,"0.23.2",function Au(a){switch(a){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(a)),(0,de.registerVersion)(za,"0.23.2","esm2017")}("Browser");function Ks(){return Ks=(0,v.Z)(function*(a,i,s){var l;const{BuildInfo:d}=vt();Oe(i.sessionId,"AuthEvent did not contain a session ID");const f=yield function Ya(a){return cn.apply(this,arguments)}(i.sessionId),m={};return nt()?m.ibi=d.packageName:St()?m.apn=d.packageName:ne(a,"operation-not-supported-in-this-environment"),d.displayName&&(m.appDisplayName=d.displayName),m.sessionId=f,fr(a,s,i.type,void 0,null!==(l=i.eventId)&&void 0!==l?l:void 0,m)}),Ks.apply(this,arguments)}function ei(){return(ei=(0,v.Z)(function*(a){const{BuildInfo:i}=vt(),s={};nt()?s.iosBundleId=i.packageName:St()?s.androidPackageName=i.packageName:ne(a,"operation-not-supported-in-this-environment"),yield lr(a,s)})).apply(this,arguments)}function $s(){return($s=(0,v.Z)(function*(a,i,s){const{cordova:l}=vt();let d=()=>{};try{yield new Promise((f,m)=>{let y=null;function C(){var S;f();const z=null===(S=l.plugins.browsertab)||void 0===S?void 0:S.close;"function"==typeof z&&z(),"function"==typeof s?.close&&s.close()}function R(){y||(y=window.setTimeout(()=>{m(ie(a,"redirect-cancelled-by-user"))},2e3))}function k(){"visible"===document?.visibilityState&&R()}i.addPassiveListener(C),document.addEventListener("resume",R,!1),St()&&document.addEventListener("visibilitychange",k,!1),d=()=>{i.removePassiveListener(C),document.removeEventListener("resume",R,!1),document.removeEventListener("visibilitychange",k,!1),y&&window.clearTimeout(y)}})}finally{d()}})).apply(this,arguments)}function cn(){return(cn=(0,v.Z)(function*(a){const i=function js(a){if(Oe(/[0-9a-zA-Z]+/.test(a),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(a);const i=new ArrayBuffer(a.length),s=new Uint8Array(i);for(let l=0;l<a.length;l++)s[l]=a.charCodeAt(l);return s}(a),s=yield crypto.subtle.digest("SHA-256",i);return Array.from(new Uint8Array(s)).map(d=>d.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}class Nu extends La{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(i=>{this.resolveInialized=i})}addPassiveListener(i){this.passiveListeners.add(i)}removePassiveListener(i){this.passiveListeners.delete(i)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(i){return this.resolveInialized(),this.passiveListeners.forEach(s=>s(i)),super.onEvent(i)}initialized(){var i=this;return(0,v.Z)(function*(){yield i.initPromise})()}}function Xa(a){return Ys.apply(this,arguments)}function Ys(){return(Ys=(0,v.Z)(function*(a){const i=yield Qs()._get(Js(a));return i&&(yield Qs()._remove(Js(a))),i})).apply(this,arguments)}function Du(){const a=[];for(let s=0;s<20;s++){const l=Math.floor(62*Math.random());a.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(l))}return a.join("")}function Qs(){return ue(Wn)}function Js(a){return Be("authEvent",a.config.apiKey,a.name)}function mr(a){if(!a?.includes("?"))return{};const[i,...s]=a.split("?");return(0,w.zd)(s.join("?"))}const Lu=class nl{constructor(){this._redirectPersistence=ct,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=on,this._overrideRedirectResult=xs}_initialize(i){var s=this;return(0,v.Z)(function*(){const l=i._key();let d=s.eventManagers.get(l);return d||(d=new Nu(i),s.eventManagers.set(l,d),s.attachCallbackListeners(i,d)),d})()}_openPopup(i){ne(i,"operation-not-supported-in-this-environment")}_openRedirect(i,s,l,d){var f=this;return(0,v.Z)(function*(){!function Pu(a){var i,s,l,d,f,m,y,C,R,k;const S=vt();A("function"==typeof(null===(i=S?.universalLinks)||void 0===i?void 0:i.subscribe),a,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),A(typeof(null===(s=S?.BuildInfo)||void 0===s?void 0:s.packageName)<"u",a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),A("function"==typeof(null===(f=null===(d=null===(l=S?.cordova)||void 0===l?void 0:l.plugins)||void 0===d?void 0:d.browsertab)||void 0===f?void 0:f.openUrl),a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),A("function"==typeof(null===(C=null===(y=null===(m=S?.cordova)||void 0===m?void 0:m.plugins)||void 0===y?void 0:y.browsertab)||void 0===C?void 0:C.isAvailable),a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),A("function"==typeof(null===(k=null===(R=S?.cordova)||void 0===R?void 0:R.InAppBrowser)||void 0===k?void 0:k.open),a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(i);const m=yield f._initialize(i);yield m.initialized(),m.resetRedirect(),function ir(){Ye.clear()}(),yield f._originValidation(i);const y=function Ja(a,i,s=null){return{type:i,eventId:s,urlResponse:null,sessionId:Du(),postBody:null,tenantId:a.tenantId,error:ie(a,"no-auth-event")}}(i,l,d);yield function qs(a,i){return Qs()._set(Js(a),i)}(i,y);const C=yield function Su(a,i,s){return Ks.apply(this,arguments)}(i,y,s),R=yield function ku(a){const{cordova:i}=vt();return new Promise(s=>{i.plugins.browsertab.isAvailable(l=>{let d=null;l?i.plugins.browsertab.openUrl(a):d=i.InAppBrowser.open(a,function Rl(a=(0,w.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(a)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(a)}()?"_blank":"_system","location=yes"),s(d)})})}(C);return function bu(a,i,s){return $s.apply(this,arguments)}(i,m,R)})()}_isIframeWebStorageSupported(i,s){throw new Error("Method not implemented.")}_originValidation(i){const s=i._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=function qa(a){return ei.apply(this,arguments)}(i)),this.originValidationPromises[s]}attachCallbackListeners(i,s){const{universalLinks:l,handleOpenURL:d,BuildInfo:f}=vt(),m=setTimeout((0,v.Z)(function*(){yield Xa(i),s.onEvent(Xs())}),500),y=function(){var k=(0,v.Z)(function*(S){clearTimeout(m);const z=yield Xa(i);let Ie=null;z&&S?.url&&(Ie=function Ou(a,i){var s,l;const d=function el(a){const i=mr(a),s=i.link?decodeURIComponent(i.link):void 0,l=mr(s).link,d=i.deep_link_id?decodeURIComponent(i.deep_link_id):void 0;return mr(d).link||d||l||s||a}(i);if(d.includes("/__/auth/callback")){const f=mr(d),m=f.firebaseError?function xu(a){try{return JSON.parse(a)}catch{return null}}(decodeURIComponent(f.firebaseError)):null,y=null===(l=null===(s=m?.code)||void 0===s?void 0:s.split("auth/"))||void 0===l?void 0:l[1],C=y?ie(y):null;return C?{type:a.type,eventId:a.eventId,tenantId:a.tenantId,error:C,urlResponse:null,sessionId:null,postBody:null}:{type:a.type,eventId:a.eventId,tenantId:a.tenantId,sessionId:a.sessionId,urlResponse:d,postBody:null}}return null}(z,S.url)),s.onEvent(Ie||Xs())});return function(z){return k.apply(this,arguments)}}();typeof l<"u"&&"function"==typeof l.subscribe&&l.subscribe(null,y);const C=d,R=`${f.packageName.toLowerCase()}://`;vt().handleOpenURL=function(){var k=(0,v.Z)(function*(S){if(S.toLowerCase().startsWith(R)&&y({url:S}),"function"==typeof C)try{C(S)}catch(z){console.error(z)}});return function(S){return k.apply(this,arguments)}}()}};function Xs(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:ie("no-auth-event")}}function ti(){var a;return(null===(a=self?.location)||void 0===a?void 0:a.protocol)||null}function to(a=(0,w.z$)()){return!("file:"!==ti()&&"ionic:"!==ti()&&"capacitor:"!==ti()||!a.toLowerCase().match(/iphone|ipad|ipod|android/))}function no(){try{const a=self.localStorage,i=en();if(a)return a.setItem(i,"1"),a.removeItem(i),!function yt(a=(0,w.z$)()){return function Wu(){return(0,w.w1)()&&11===document?.documentMode}()||function rl(a=(0,w.z$)()){return/Edge\/\d+/.test(a)}(a)}()||(0,w.hl)()}catch{return yr()&&(0,w.hl)()}return!1}function yr(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function Fe(){return(function eo(){return"http:"===ti()||"https:"===ti()}()||(0,w.ru)()||to())&&!function Uu(){return(0,w.b$)()||(0,w.UG)()}()&&no()&&!yr()}function ni(){return to()&&typeof document<"u"}function io(){return(io=(0,v.Z)(function*(){return!!ni()&&new Promise(a=>{const i=setTimeout(()=>{a(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(i),a(!0)})})})).apply(this,arguments)}const _e={LOCAL:"local",NONE:"none",SESSION:"session"},dn=A,Er="persistence";function Ue(a){return Ht.apply(this,arguments)}function Ht(){return(Ht=(0,v.Z)(function*(a){yield a._initializationPromise;const i=sl(),s=Be(Er,a.config.apiKey,a.name);i&&i.setItem(s,a._getPersistence())})).apply(this,arguments)}function sl(){var a;try{return(null===(a=function Vu(){return typeof window<"u"?window:null}())||void 0===a?void 0:a.sessionStorage)||null}catch{return null}}const Gu=A;class ke{constructor(){this.browserResolver=ue(Ba),this.cordovaResolver=ue(Lu),this.underlyingResolver=null,this._redirectPersistence=ct,this._completeRedirectFn=on,this._overrideRedirectResult=xs}_initialize(i){var s=this;return(0,v.Z)(function*(){return yield s.selectUnderlyingResolver(),s.assertedUnderlyingResolver._initialize(i)})()}_openPopup(i,s,l,d){var f=this;return(0,v.Z)(function*(){return yield f.selectUnderlyingResolver(),f.assertedUnderlyingResolver._openPopup(i,s,l,d)})()}_openRedirect(i,s,l,d){var f=this;return(0,v.Z)(function*(){return yield f.selectUnderlyingResolver(),f.assertedUnderlyingResolver._openRedirect(i,s,l,d)})()}_isIframeWebStorageSupported(i,s){this.assertedUnderlyingResolver._isIframeWebStorageSupported(i,s)}_originValidation(i){return this.assertedUnderlyingResolver._originValidation(i)}get _shouldInitProactively(){return ni()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Gu(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var i=this;return(0,v.Z)(function*(){if(i.underlyingResolver)return;const s=yield function Ir(){return io.apply(this,arguments)}();i.underlyingResolver=s?i.cordovaResolver:i.browserResolver})()}}function ro(a){return a.unwrap()}function so(a){return ol(a)}function ol(a){const{_tokenResponse:i}=a instanceof w.ZR?a.customData:a;if(!i)return null;if(!(a instanceof w.ZR)&&"temporaryProof"in i&&"phoneNumber"in i)return Hn.credentialFromResult(a);const s=i.providerId;if(!s||s===he.PASSWORD)return null;let l;switch(s){case he.GOOGLE:l=Xo;break;case he.FACEBOOK:l=Jo;break;case he.GITHUB:l=ea;break;case he.TWITTER:l=ta;break;default:const{oauthIdToken:d,oauthAccessToken:f,oauthTokenSecret:m,pendingToken:y,nonce:C}=i;return f||m||d||y?y?s.startsWith("saml.")?jt._create(s,y):ze._fromParams({providerId:s,signInMethod:s,pendingToken:y,idToken:d,accessToken:f}):new st(s).credential({idToken:d,accessToken:f,rawNonce:C}):null}return a instanceof w.ZR?l.credentialFromError(a):l.credentialFromResult(a)}function te(a,i){return i.catch(s=>{throw s instanceof w.ZR&&function Tr(a,i){var s;const l=null===(s=i.customData)||void 0===s?void 0:s._tokenResponse;if("auth/multi-factor-auth-required"===i?.code)i.resolver=new al(a,function ql(a,i){var s;const l=(0,w.m9)(a),d=i;return A(i.customData.operationType,l,"argument-error"),A(null===(s=d.customData._serverResponse)||void 0===s?void 0:s.mfaPendingCredential,l,"argument-error"),Is._fromError(l,d)}(a,i));else if(l){const d=ol(i),f=i;d&&(f.credential=d,f.tenantId=l.tenantId||void 0,f.email=l.email||void 0,f.phoneNumber=l.phoneNumber||void 0)}}(a,s),s}).then(s=>{const d=s.user;return{operationType:s.operationType,credential:so(s),additionalUserInfo:zl(s),user:ge.getOrCreate(d)}})}function Cr(a,i){return wr.apply(this,arguments)}function wr(){return(wr=(0,v.Z)(function*(a,i){const s=yield i;return{verificationId:s.verificationId,confirm:l=>te(a,s.confirm(l))}})).apply(this,arguments)}class al{constructor(i,s){this.resolver=s,this.auth=function zu(a){return a.wrapped()}(i)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(i){return te(ro(this.auth),this.resolver.resolveSignIn(i))}}class ge{constructor(i){this._delegate=i,this.multiFactor=function Cs(a){const i=(0,w.m9)(a);return Ts.has(i)||Ts.set(i,Es._fromUser(i)),Ts.get(i)}(i)}static getOrCreate(i){return ge.USER_MAP.has(i)||ge.USER_MAP.set(i,new ge(i)),ge.USER_MAP.get(i)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(i){return this._delegate.getIdTokenResult(i)}getIdToken(i){return this._delegate.getIdToken(i)}linkAndRetrieveDataWithCredential(i){return this.linkWithCredential(i)}linkWithCredential(i){var s=this;return(0,v.Z)(function*(){return te(s.auth,se(s._delegate,i))})()}linkWithPhoneNumber(i,s){var l=this;return(0,v.Z)(function*(){return Cr(l.auth,function ka(a,i,s){return ft.apply(this,arguments)}(l._delegate,i,s))})()}linkWithPopup(i){var s=this;return(0,v.Z)(function*(){return te(s.auth,function hu(a,i,s){return zn.apply(this,arguments)}(s._delegate,i,ke))})()}linkWithRedirect(i){var s=this;return(0,v.Z)(function*(){return yield Ue(K(s.auth)),Oa(s._delegate,i,ke)})()}reauthenticateAndRetrieveDataWithCredential(i){return this.reauthenticateWithCredential(i)}reauthenticateWithCredential(i){var s=this;return(0,v.Z)(function*(){return te(s.auth,On(s._delegate,i))})()}reauthenticateWithPhoneNumber(i,s){return Cr(this.auth,function ba(a,i,s){return er.apply(this,arguments)}(this._delegate,i,s))}reauthenticateWithPopup(i){return te(this.auth,function j(a,i,s){return Gn.apply(this,arguments)}(this._delegate,i,ke))}reauthenticateWithRedirect(i){var s=this;return(0,v.Z)(function*(){return yield Ue(K(s.auth)),_u(s._delegate,i,ke)})()}sendEmailVerification(i){return function gs(a,i){return Zi.apply(this,arguments)}(this._delegate,i)}unlink(i){var s=this;return(0,v.Z)(function*(){return yield function os(a,i){return at.apply(this,arguments)}(s._delegate,i),s})()}updateEmail(i){return function ms(a,i){return ca((0,w.m9)(a),i,null)}(this._delegate,i)}updatePassword(i){return function vs(a,i){return ca((0,w.m9)(a),null,i)}(this._delegate,i)}updatePhoneNumber(i){return function cu(a,i){return H.apply(this,arguments)}(this._delegate,i)}updateProfile(i){return function Bl(a,i){return Fn.apply(this,arguments)}(this._delegate,i)}verifyBeforeUpdateEmail(i,s){return function ua(a,i,s){return Mn.apply(this,arguments)}(this._delegate,i,s)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}ge.USER_MAP=new WeakMap;const It=A;let Ar=(()=>{class a{constructor(s,l){if(this.app=s,l.isInitialized())return this._delegate=l.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:d}=s.options;It(d,"invalid-api-key",{appName:s.name}),It(d,"invalid-api-key",{appName:s.name});const f=typeof window<"u"?ke:void 0;this._delegate=l.initialize({options:{persistence:oo(d,s.name),popupRedirectResolver:f}}),this._delegate._updateErrorMap(yl),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?ge.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(s){this._delegate.languageCode=s}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(s){this._delegate.tenantId=s}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(s,l){!function Lo(a,i,s){const l=K(a);A(l._canInitEmulator,l,"emulator-config-failed"),A(/^https?:\/\//.test(i),l,"invalid-emulator-scheme");const d=!!s?.disableWarnings,f=Mo(i),{host:m,port:y}=function Fo(a){const i=Mo(a),s=/(\/\/)?([^?#/]+)/.exec(a.substr(i.length));if(!s)return{host:"",port:null};const l=s[2].split("@").pop()||"",d=/^(\[[^\]]+\])(:|$)/.exec(l);if(d){const f=d[1];return{host:f,port:Qr(l.substr(f.length+1))}}{const[f,m]=l.split(":");return{host:f,port:Qr(m)}}}(i);l.config.emulator={url:`${f}//${m}${null===y?"":`:${y}`}/`},l.settings.appVerificationDisabledForTesting=!0,l.emulatorConfig=Object.freeze({host:m,port:y,protocol:f.replace(":",""),options:Object.freeze({disableWarnings:d})}),d||function Uo(){function a(){const i=document.createElement("p"),s=i.style;i.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",i.classList.add("firebase-emulator-warning"),document.body.appendChild(i)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",a):a())}()}(this._delegate,s,l)}applyActionCode(s){return function Wl(a,i){return fs.apply(this,arguments)}(this._delegate,s)}checkActionCode(s){return ra(this._delegate,s)}confirmPasswordReset(s,l){return function Ul(a,i,s){return hs.apply(this,arguments)}(this._delegate,s,l)}createUserWithEmailAndPassword(s,l){var d=this;return(0,v.Z)(function*(){return te(d._delegate,function xn(a,i,s){return _s.apply(this,arguments)}(d._delegate,s,l))})()}fetchProvidersForEmail(s){return this.fetchSignInMethodsForEmail(s)}fetchSignInMethodsForEmail(s){return function la(a,i){return zi.apply(this,arguments)}(this._delegate,s)}isSignInWithEmailLink(s){return function sa(a,i){const s=Oi.parseLink(i);return"EMAIL_SIGNIN"===s?.operation}(0,s)}getRedirectResult(){var s=this;return(0,v.Z)(function*(){It(Fe(),s._delegate,"operation-not-supported-in-this-environment");const l=yield function ar(a,i){return pt.apply(this,arguments)}(s._delegate,ke);return l?te(s._delegate,Promise.resolve(l)):{credential:null,user:null}})()}addFrameworkForLogging(s){!function vr(a,i){K(a)._logFramework(i)}(this._delegate,s)}onAuthStateChanged(s,l,d){const{next:f,error:m,complete:y}=Rr(s,l,d);return this._delegate.onAuthStateChanged(f,m,y)}onIdTokenChanged(s,l,d){const{next:f,error:m,complete:y}=Rr(s,l,d);return this._delegate.onIdTokenChanged(f,m,y)}sendSignInLinkToEmail(s,l){return function Ln(a,i,s){return Qt.apply(this,arguments)}(this._delegate,s,l)}sendPasswordResetEmail(s,l){return function ia(a,i,s){return ds.apply(this,arguments)}(this._delegate,s,l||void 0)}setPersistence(s){var l=this;return(0,v.Z)(function*(){let d;switch(function Hu(a,i){dn(Object.values(_e).includes(i),a,"invalid-persistence-type"),(0,w.b$)()?dn(i!==_e.SESSION,a,"unsupported-persistence-type"):(0,w.UG)()?dn(i===_e.NONE,a,"unsupported-persistence-type"):yr()?dn(i===_e.NONE||i===_e.LOCAL&&(0,w.hl)(),a,"unsupported-persistence-type"):dn(i===_e.NONE||no(),a,"unsupported-persistence-type")}(l._delegate,s),s){case _e.SESSION:d=ct;break;case _e.LOCAL:d=(yield ue(xe)._isAvailable())?xe:Wn;break;case _e.NONE:d=At;break;default:return ne("argument-error",{appName:l._delegate.name})}return l._delegate.setPersistence(d)})()}signInAndRetrieveDataWithCredential(s){return this.signInWithCredential(s)}signInAnonymously(){return te(this._delegate,function na(a){return rs.apply(this,arguments)}(this._delegate))}signInWithCredential(s){return te(this._delegate,qt(this._delegate,s))}signInWithCustomToken(s){return te(this._delegate,function Dt(a,i){return cs.apply(this,arguments)}(this._delegate,s))}signInWithEmailAndPassword(s,l){return te(this._delegate,function Vl(a,i,s){return qt((0,w.m9)(a),Di.credential(i,s))}(this._delegate,s,l))}signInWithEmailLink(s,l){return te(this._delegate,function oa(a,i,s){return Bi.apply(this,arguments)}(this._delegate,s,l))}signInWithPhoneNumber(s,l){return Cr(this._delegate,function Sa(a,i,s){return Xi.apply(this,arguments)}(this._delegate,s,l))}signInWithPopup(s){var l=this;return(0,v.Z)(function*(){return It(Fe(),l._delegate,"operation-not-supported-in-this-environment"),te(l._delegate,function Bn(a,i,s){return Os.apply(this,arguments)}(l._delegate,s,ke))})()}signInWithRedirect(s){var l=this;return(0,v.Z)(function*(){return It(Fe(),l._delegate,"operation-not-supported-in-this-environment"),yield Ue(l._delegate),Ls(l._delegate,s,ke)})()}updateCurrentUser(s){return this._delegate.updateCurrentUser(s)}verifyPasswordResetCode(s){return function Yt(a,i){return ps.apply(this,arguments)}(this._delegate,s)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return a.Persistence=_e,a})();function Rr(a,i,s){let l=a;"function"!=typeof a&&({next:l,error:i,complete:s}=a);const d=l;return{next:m=>d(m&&ge.getOrCreate(m)),error:i,complete:s}}function oo(a,i){const s=function Bu(a,i){const s=sl();if(!s)return[];const l=Be(Er,a,i);switch(s.getItem(l)){case _e.NONE:return[At];case _e.LOCAL:return[xe,ct];case _e.SESSION:return[ct];default:return[]}}(a,i);if(typeof self<"u"&&!s.includes(xe)&&s.push(xe),typeof window<"u")for(const l of[Wn,ct])s.includes(l)||s.push(l);return s.includes(At)||s.push(At),s}class ao{constructor(){this.providerId="phone",this._delegate=new Hn(ro(N.Z.auth()))}static credential(i,s){return Hn.credential(i,s)}verifyPhoneNumber(i,s){return this._delegate.verifyPhoneNumber(i,s)}unwrap(){return this._delegate}}ao.PHONE_SIGN_IN_METHOD=Hn.PHONE_SIGN_IN_METHOD,ao.PROVIDER_ID=Hn.PROVIDER_ID;const ii=A;class Zu{constructor(i,s,l=N.Z.app()){var d;ii(null===(d=l.options)||void 0===d?void 0:d.apiKey,"invalid-api-key",{appName:l.name}),this._delegate=new Ss(i,s,l.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function $u(a){a.INTERNAL.registerComponent(new mn.wA("auth-compat",i=>{const s=i.getProvider("app-compat").getImmediate(),l=i.getProvider("auth");return new Ar(s,l)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:Di,FacebookAuthProvider:Jo,GithubAuthProvider:ea,GoogleAuthProvider:Xo,OAuthProvider:st,SAMLAuthProvider:is,PhoneAuthProvider:ao,PhoneMultiFactorGenerator:Tu,RecaptchaVerifier:Zu,TwitterAuthProvider:ta,Auth:Ar,AuthCredential:bt,Error:w.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),a.registerVersion("@firebase/auth-compat","0.4.2")}(N.Z)}}]);